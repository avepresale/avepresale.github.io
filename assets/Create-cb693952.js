import{I as ge}from"./InputQty-89b6dfe4.js";import{O as Ce,S as $e}from"./OperateSuccessDialog-a3074a61.js";import{_ as ae,d as se,$ as le,r as F,o as c,m as E,l as h,b as e,t as a,c as _,j as t,a as i,z as ce,T as P,A as w,q as H,y as Y,I as K,F as T,B as q,a2 as be,N as Le,O as Ae,u as Te,g as f,f as Ve,i as Ie,M as x,n as v,a4 as b,C as Se,G as ee,E as oe,p as te,H as De,a5 as Ne,L as Ee}from"./index-2dc1edc6.js";import{B as ne}from"./bignumber-3e8dfdf6.js";const ie=C=>(Le("data-v-a98c53c2"),C=C(),Ae(),C),Fe={class:"ave-popup"},Oe={class:"title"},Be={class:"body"},Pe={class:"info"},Ue={class:"key"},Ge={class:"value"},Me={key:0,class:"token"},Re={key:1,class:"token"},We={key:2,class:"token"},qe={class:"key"},He={class:"value"},Ye={class:"item"},je=ie(()=>e("div",{class:"key"},"交易对",-1)),ze={class:"value"},Ke={class:"item"},Qe=ie(()=>e("div",{class:"key"},"锁定数量",-1)),Je={class:"value"},Xe={class:"key"},Ze={class:"value"},xe={class:"key"},eo={class:"value"},oo={class:"blue-font"},to={class:"key"},no={class:"value"},ao={class:"tips"},so={__name:"LockConfirmPopup",props:{show:Boolean,showGas:String,amount:String,unlockDate:Date,isLockV2:Boolean,positions:Object},emits:["update:show","confirm"],setup(C,{emit:p}){const r=C,$=se(),l=le();function V(){p("confirm")}return(k,L)=>{const R=F("van-button"),m=F("van-popup");return c(),E(m,{show:C.show,"onUpdate:show":L[0]||(L[0]=n=>{p("update:show",n)}),round:"",closeable:"",position:"bottom"},{default:h(()=>[e("div",Fe,[e("div",Oe,a(k.$t("lockConfirm")),1),e("div",Be,[e("ul",Pe,[r.isLockV2?(c(),_(T,{key:0},[e("li",null,[e("div",Ue,a(k.$t("lockAssets")),1),e("div",Ge,[t(l).token?t(l).token.tokenType==0?(c(),_("div",Re,[i(P,{class:"token-icon",tokenIcon:t(l).token.icon,chainIcon:t(ce)(t(l).token.chain)},null,8,["tokenIcon","chainIcon"]),w(" "+a(`${t(l).token.symbol} (${t(H)(t(l).token.address)})`),1)])):t(l).token.tokenType==1?(c(),_("div",We,[i(P,{class:"token-icon",tokenIcon:t(Y)(t(l).token.chain,t(l).token.tokenList[0].address)},null,8,["tokenIcon"]),i(P,{class:"token-icon",tokenIcon:t(Y)(t(l).token.chain,t(l).token.tokenList[1].address)},null,8,["tokenIcon"]),w(" "+a(`${t(l).token.symbol} (${t(H)(t(l).token.address)})`),1)])):K("",!0):(c(),_("div",Me," -- "))])]),e("li",null,[e("div",qe,a(k.$t("lockNumber")),1),e("div",He,a(C.amount),1)])],64)):(c(),_(T,{key:1},[e("li",Ye,[je,e("div",ze,a(r.positions?`${r.positions.token0Symbol}/${r.positions.token1Symbol}`:"--/--"),1)]),e("li",Ke,[Qe,e("div",Je,a(r.positions?r.positions.liquidity:"--"),1)])],64)),e("li",null,[e("div",Xe,a(k.$t("contractChian")),1),e("div",Ze,a(t($).chain.toUpperCase()),1)]),e("li",null,[e("div",xe,a(k.$t("unlockTime2")),1),e("div",eo,[e("span",null,a(t(q)(C.unlockDate).format("YYYY-MM-DD")),1),e("span",null,[w("("),e("span",oo,a(k.$t("dayLeft",{day:t(be)(r.unlockDate)})),1),w(")")])])]),e("li",null,[e("div",to,a(k.$t("gas")),1),e("div",no,a(C.showGas?`${C.showGas} ${t($).chainCoinSymbol.toUpperCase()}`:"--"),1)])]),e("div",ao,[e("div",null,a(k.$t("createTips1")),1),e("div",null,a(k.$t("createTips2")),1),e("div",null,a(k.$t("createTips3")),1)]),i(R,{class:"btn",type:"primary",block:"",onClick:V},{default:h(()=>[w(a(k.$t("confirmAndLock")),1)]),_:1})])])]),_:1},8,["show"])}}},lo=ae(so,[["__scopeId","data-v-a98c53c2"]]);const co={class:"body"},io={class:"tab"},uo={class:"form"},ro={class:"title token-title"},ko={key:0,class:"token-box"},vo={key:1,class:"token"},fo={class:"title token-title"},po={class:"title token-title"},mo={class:"title token-title"},yo={key:0,class:"info"},ho={class:"item"},_o={class:"key"},wo={class:"value"},go={class:"item"},Co={class:"key"},$o={class:"value"},bo={class:"title token-title"},Lo={class:"tools"},Ao={__name:"Create",setup(C){const{t:p}=Te(),r=f(!0),$=f(""),l=f(""),V=f(!1),k=f(!1),L=f(!1),R=Ve(),m=se(),n=le(),de=q().add(1,"day").endOf("day").toDate(),U=f(de),S=f(""),G=f(!1),Q=f(""),W=f(!1),M=f(""),O=f("");async function ue(){await m.connectWallet()}async function J(){if(n.token==null)return;if(n.token.address==v.wallet.MAIN_COIN_ADDRESS){V.value=!1;return}await v.wallet.isAllowanceEnough(n.tokenLockV2Address,n.token.address,m.walletAddress)?V.value=!1:V.value=!0}async function re(){if(k.value=!0,r.value)try{let o=await v.wallet.approveMaxAmount(n.token.address,n.tokenLockV2Address);console.log(o),await o.wait(),V.value=!1}catch(o){console.log(o)}finally{k.value=!1}}async function ke(){L.value=!0,M.value="";try{if(!n.token){b(p("pleaseSelectToken"));return}if(!S.value){b(p("enterAmount"));return}let o=Se[m.dappType].chainList.find(s=>s.chain==n.token.chain);if(!o){b(p("tokenChainNotSupport"));return}if(m.chain!=o.chain){b(p("switchTokenChain"));try{await v.wallet.switchNetwork(o.chainId)}catch{b(p("switchTokenChain"));return}return}if(ne(S.value).gt(ne(O.value))){b(p("balanceSlow"));return}if(await J(),V.value){b(p("approveFirst"));return}await X()}catch(o){console.log(o)}finally{L.value=!1}}async function X(){const o=await v.wallet.getGasPrice();let s;const d=q(U.value).endOf("day").unix();if(r.value){const y=n.token.address,D=await(await v.wallet.contractERC20(y)).decimals(),g=n.token.tokenType==1,u=ee(S.value,D);s=await(await v.wallet.contractTokenLockV2(n.tokenLockV2Address)).lock.estimateGas(m.walletAddress,y,g,u.toString(),d,"")}else s=await(await v.wallet.contractTokenLockV3(n.tokenLockV3Address)).lock.estimateGas(m.walletAddress,$.value,l.value,d,"");console.dir(s),Q.value=oe(s*o),G.value=!0}async function ve(){const o=te({message:"Loading...",forbidClick:!0,duration:0}),s=q(U.value).endOf("day").unix();if(r.value){const d=n.token.address,y=n.token.tokenType==1,D=await(await v.wallet.contractERC20(d)).decimals(),g=ee(S.value,D),u=await v.wallet.contractTokenLockV2(n.tokenLockV2Address);try{let N=await u.lock(m.walletAddress,d,y,g.toString(),s,"");console.dir(N),M.value=N.hash,W.value=!0,G.value=!1}catch(N){console.log(N)}finally{o.close()}}else{const d=await v.wallet.contractTokenLockV3(n.tokenLockV3Address);try{let y=await d.lock(m.walletAddress,$.value,l.value,s,"");console.dir(y),M.value=y.hash,W.value=!0,G.value=!1}catch(y){console.log(y)}finally{o.close()}}}function fe(){R.push("/lockMaster/selectToken")}async function pe(){if(!n.token)return;const o=te({message:"Loading...",forbidClick:!0,duration:0});try{if(n.token.address==v.wallet.MAIN_COIN_ADDRESS){const d=await(await v.wallet.getEthersProvider()).getBalance(m.walletAddress);O.value=oe(d)}else{const s=await v.wallet.contractERC20(n.token.address),d=await s.decimals(),y=await s.balanceOf(m.walletAddress);O.value=De(y,d)}}catch(s){console.log(s),n.token=null}finally{o.close()}}Ie(()=>{console.log("onMounted"),m.chainId>0&&m.isConnectWallet&&n.token&&(J(),pe())});const j=f(!1),I=f(null);async function me(){k.value=!0;try{await(await(await v.wallet.contractNFT($.value)).approve(n.tokenLockV3Address,l.value)).wait(),j.value=!1}catch(o){console.log(o)}finally{k.value=!1}}async function ye(){L.value=!0,M.value="";try{await X()}catch(o){console.log(o)}finally{L.value=!1}}const B=f(!1),z=f(!1);async function he(){if(!$.value||!Ne($.value)){b(p("trueTokenFormat"));return}if(!l.value){b(p("trueTokenIDFormat"));return}z.value=!0;try{const o=await v.wallet.contractNFT($.value);let s;try{s=await o.ownerOf(l.value)}catch(we){console.error(we),b(p("trueTokenAddressIDFormat"));return}if(s.toLowerCase()!=m.walletAddress){b(p("notOwnToken"));return}const d=await o.positions(l.value),y=d[2],A=d[3],g=await(await v.wallet.contractERC20(y)).symbol(),N=await(await v.wallet.contractERC20(A)).symbol();I.value={token0:d[2],token0Symbol:g,token1:d[3],token1Symbol:N,liquidity:d[7]},B.value=!0;const _e=await o.getApproved(l.value);j.value=_e.toLowerCase()!=n.tokenLockV3Address.toLowerCase()}catch(o){console.log(o)}finally{z.value=!1}}function Z(o){r.value!=o&&(r.value=o,B.value=!1,I.value=null)}return(o,s)=>{const d=F("van-divider"),y=F("van-cell"),A=F("van-cell-group"),D=F("van-field"),g=F("van-button");return c(),_(T,null,[e("div",co,[e("ul",io,[e("li",{class:x({"tab-select":r.value}),onClick:s[0]||(s[0]=u=>Z(!0))},a(o.$t("tokenOrLP(V2)")),3),e("li",{class:x({"tab-select":!r.value}),onClick:s[1]||(s[1]=u=>Z(!1))},"LP(uniV3)",2)]),i(d),e("div",uo,[r.value?(c(),_(T,{key:0},[i(A,{inset:"",class:"form-item"},{default:h(()=>[e("div",ro,a(o.$t("selectToken2")),1),i(y,{"is-link":"",class:"token-cell",onClick:fe},Ee({_:2},[t(n).token?{name:"title",fn:h(()=>[t(n).token.tokenType==0?(c(),_("div",ko,[i(P,{class:"token-icon",tokenIcon:t(n).token.icon,chainIcon:t(ce)(t(n).token.chain)},null,8,["tokenIcon","chainIcon"]),w(" "+a(`${t(n).token.symbol} (${t(H)(t(n).token.address)})`),1)])):t(n).token.tokenType==1?(c(),_("div",vo,[i(P,{class:"token-icon",tokenIcon:t(Y)(t(n).token.chain,t(n).token.tokenList[0].address)},null,8,["tokenIcon"]),i(P,{class:"token-icon",tokenIcon:t(Y)(t(n).token.chain,t(n).token.tokenList[1].address)},null,8,["tokenIcon"]),w(" "+a(`${t(n).token.symbol} (${t(H)(t(n).token.address)})`),1)])):K("",!0)]),key:"0"}:{name:"title",fn:h(()=>[e("div",{class:"token-box",style:{color:"#999999"}},a(o.$t("pleaseSelectToken")),1)]),key:"1"}]),1024)]),_:1}),i(A,{inset:"",class:"form-item"},{default:h(()=>[e("div",fo,[e("div",null,a(t(p)("setNumberOfLock")),1),e("div",null,[w(a(`${t(p)("balance")}: `),1),e("span",null,a(O.value?O.value:"--"),1)])]),e("div",null,[i(ge,{amount:S.value,"onUpdate:amount":s[2]||(s[2]=u=>S.value=u),total:O.value,decimals:t(n).token?t(n).token.decimals:0},null,8,["amount","total","decimals"])])]),_:1})],64)):(c(),_(T,{key:1},[i(A,{inset:"",class:"form-item"},{default:h(()=>[e("div",po,[e("div",null,a(o.$t("enterTokenAddress")),1)]),e("div",null,[i(D,{class:"token-cell",modelValue:$.value,"onUpdate:modelValue":s[3]||(s[3]=u=>$.value=u),placeholder:o.$t("contractAddress"),disabled:B.value},null,8,["modelValue","placeholder","disabled"])])]),_:1}),i(A,{inset:"",class:"form-item"},{default:h(()=>[e("div",mo,[e("div",null,a(o.$t("enterTokenId")),1)]),e("div",null,[i(D,{class:"token-cell",modelValue:l.value,"onUpdate:modelValue":s[4]||(s[4]=u=>l.value=u),placeholder:o.$t("forExample"),disabled:B.value},null,8,["modelValue","placeholder","disabled"]),B.value?(c(),_("ul",yo,[e("li",ho,[e("div",_o,a(o.$t("transactionPairs")),1),e("div",wo,a(I.value?`${I.value.token0Symbol}/${I.value.token1Symbol}`:"--/--"),1)]),e("li",go,[e("div",Co,a(o.$t("lockQuantity")),1),e("div",$o,a(I.value?I.value.liquidity:"--"),1)])])):K("",!0)])]),_:1})],64)),i(A,{inset:"",class:"form-item"},{default:h(()=>[e("div",bo,[e("div",null,a(o.$t("setDate")),1)]),e("div",null,[i($e,{date:U.value,"onUpdate:date":s[5]||(s[5]=u=>U.value=u),showTools:""},null,8,["date"])])]),_:1})]),i(d),e("div",Lo,[t(m).isConnectWallet?(c(),_(T,{key:0},[r.value?(c(),_(T,{key:0},[V.value?(c(),E(g,{key:0,class:"btn",type:"danger",onClick:re,block:"",loading:k.value},{default:h(()=>[w(a(o.$t("approve")),1)]),_:1},8,["loading"])):(c(),E(g,{key:1,class:"btn",color:"#3F80F7",onClick:ke,block:"",loading:L.value},{default:h(()=>[w(a(o.$t("oneKeyLock")),1)]),_:1},8,["loading"]))],64)):(c(),_(T,{key:1},[B.value?(c(),_(T,{key:1},[j.value?(c(),E(g,{key:0,class:"btn",type:"danger",onClick:me,block:"",loading:k.value},{default:h(()=>[w(a(o.$t("approve")),1)]),_:1},8,["loading"])):(c(),E(g,{key:1,class:"btn",color:"#3F80F7",onClick:ye,block:"",loading:L.value},{default:h(()=>[w(a(o.$t("oneKeyLock")),1)]),_:1},8,["loading"]))],64)):(c(),E(g,{key:0,class:"btn",color:"#3F80F7",onClick:he,block:"",loading:z.value},{default:h(()=>[w(a(o.$t("verifyToken")),1)]),_:1},8,["loading"]))],64))],64)):(c(),E(g,{key:1,class:"btn",type:"primary",onClick:ue,block:""},{default:h(()=>[w(a(o.$t("connectWallet")),1)]),_:1}))])]),i(lo,{show:G.value,"onUpdate:show":s[6]||(s[6]=u=>G.value=u),isLockV2:r.value,positions:I.value,unlockDate:U.value,amount:S.value,showGas:Q.value,onConfirm:ve},null,8,["show","isLockV2","positions","unlockDate","amount","showGas"]),i(Ce,{show:W.value,"onUpdate:show":s[7]||(s[7]=u=>W.value=u),txHash:M.value,onClose:s[8]||(s[8]=u=>t(R).push("/lockMaster"))},null,8,["show","txHash"])],64)}}},Do=ae(Ao,[["__scopeId","data-v-785b5ba8"]]);export{Do as default};
