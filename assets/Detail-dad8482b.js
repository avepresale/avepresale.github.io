import{_ as K,d as W,$ as X,u as Z,g as w,J as no,p as j,r as G,o as p,c as y,a as k,l as D,b as t,t as s,T as E,j as l,y as B,A as v,q as A,z as oo,a0 as to,F as so,n as u,H as M,a4 as Y,s as lo,E as x,G as z,h as io,i as co,m as q,I,k as J,B as R,v as Q,a2 as ro,N as uo,O as ko}from"./index-4401ac44.js";import{D as mo}from"./DelayPopup-4265f709.js";import{O as po}from"./OperateSuccessDialog-b433ec5d.js";import{I as _o}from"./InputQty-c3b213bd.js";import{B as V}from"./bignumber-3e8dfdf6.js";const ho="/assets/images/time.png",vo="/assets/images/add.png";const yo={class:"ave-popup"},wo={class:"title"},go={class:"body"},bo={class:"info"},fo={class:"key"},Lo={class:"value"},So={key:0,class:"token"},Co={key:1,class:"token"},$o={class:"key"},Io={class:"value"},Do={class:"key"},To={class:"value"},Vo={class:"key"},Ao={class:"value"},Eo={class:"key"},Bo={class:"value"},Uo={style:{}},Fo={__name:"AppendLockPopup",props:{show:Boolean,lockId:String,isLockV2:Boolean,isLpToken:Boolean,unlockDate:Number,tokenList:Array,symbol:String,address:String,chainCoinSymbol:String,amountString:String,chain:String,decimals:Number},emits:["update:show","success"],setup(C,{emit:n}){const a=C,$=W(),U=X(),{t:g}=Z(),o=w(0n),b=w(""),f=w(""),F=w(""),N=w(!1),P=w("");async function H(){const i=await(await u.wallet.contractERC20(a.address)).balanceOf($.walletAddress);if(f.value=M(i,a.decimals),console.log("value:"+f.value),i==0n)throw Y(g("balanceSlow")),n("update:show",!1),"Blance Slow"}async function r(){if(!a.isLockV2)return;const e=await u.wallet.contractTokenLockV2(U.tokenLockV2Address);o.value=await e.editFee();const i=await u.wallet.getBalance($.walletAddress);if(console.log("balance",i),i<o.value){lo(g("balanceSlow2",{chainMianCoin:$.chainCoinSymbol,amount:x(o.value)})),n("update:show",!1);return}const _=await(await u.wallet.contractERC20(a.address)).decimals(),h=M("1",_),S=V(a.amountString).plus(V(h)).toString(),T=z(S,_),eo=await u.wallet.getGasPrice();let ao=await e.editLock.estimateGas(a.lockId.toString(),T.toString(),0n,{value:o.value});F.value=x(ao*eo).toString()}async function c(){if(!a.isLockV2)return;if(!b.value){Y(g("enterAmount"));return}if(V(b.value).gt(V(f.value))){Y(g("balanceSlow"));return}const e=j({message:"Loading...",forbidClick:!0,duration:0}),i=await u.wallet.contractTokenLockV2(U.tokenLockV2Address),_=await(await u.wallet.contractERC20(a.address)).decimals(),h=V(a.amountString).plus(V(b.value)).toString();console.log(h);const S=z(h,_);try{o.value=await i.editFee();let T=await i.editLock(a.lockId.toString(),S.toString(),0n,{value:o.value});console.dir(T),P.value=T.hash,N.value=!0}catch(T){console.log(T)}finally{e.close()}}no(()=>a.show,(e,i)=>{e&&d()});async function d(){const e=j({message:"Loading...",forbidClick:!0,duration:0});try{await H(),await r()}catch(i){console.log(i)}finally{e.close()}}function m(){n("update:show",!1),n("success")}return(e,i)=>{const L=G("van-button"),_=G("van-popup");return p(),y(so,null,[k(_,{show:C.show,"onUpdate:show":i[1]||(i[1]=h=>{n("update:show",h)}),round:"",closeable:"",position:"bottom"},{default:D(()=>[t("div",yo,[t("div",wo,s(e.$t("appendLock")),1),t("div",go,[t("ul",bo,[t("li",null,[t("div",fo,s(e.$t("appendAssets")),1),t("div",Lo,[a.isLpToken?(p(),y("div",So,[k(E,{class:"token-icon",tokenIcon:l(B)(a.chain,a.tokenList[0].address)},null,8,["tokenIcon"]),k(E,{class:"token-icon",tokenIcon:l(B)(a.chain,a.tokenList[1].address)},null,8,["tokenIcon"]),v(" "+s(`${a.symbol} (${l(A)(a.address)})`),1)])):(p(),y("div",Co,[k(E,{class:"token-icon",tokenIcon:l(B)(a.chain,a.address),chainIcon:l(oo)(a.chain)},null,8,["tokenIcon","chainIcon"]),v(" "+s(`${a.symbol} (${l(A)(a.address)})`),1)]))])]),t("li",null,[t("div",$o,s(e.$t("currentAmount")),1),t("div",Io,s(a.amountString),1)]),t("li",null,[t("div",Do,s(e.$t("balance")),1),t("div",To,s(`${f.value} ${a.symbol}`),1)]),t("li",null,[t("div",Vo,s(e.$t("editFee")),1),t("div",Ao,s(`${o.value?l(to).formatEther(o.value):"--"} ${a.chainCoinSymbol}`),1)]),t("li",null,[t("div",Eo,s(e.$t("gas")),1),t("div",Bo,s(`${F.value?F.value:"--"} ${a.chainCoinSymbol}`),1)])]),t("div",Uo,[k(_o,{total:f.value,amount:b.value,"onUpdate:amount":i[0]||(i[0]=h=>b.value=h),decimals:a.decimals},null,8,["total","amount","decimals"])]),k(L,{class:"btn",type:"primary",block:"",onClick:c},{default:D(()=>[v(s(e.$t("confirmAndLock")),1)]),_:1})])])]),_:1},8,["show"]),k(po,{show:N.value,"onUpdate:show":i[2]||(i[2]=h=>N.value=h),txHash:P.value,onClose:m},null,8,["show","txHash"])],64)}}},No=K(Fo,[["__scopeId","data-v-828095f1"]]);const O=C=>(uo("data-v-ee52e554"),C=C(),ko(),C),Po={key:0,class:"body"},Ho={key:0,class:"token"},Ro={key:1,class:"token"},Yo={class:"info"},Go={class:"item"},Mo={class:"key"},qo={class:"value"},Oo={key:0,class:"item"},jo={class:"key"},xo={class:"value"},zo={class:"item"},Jo={class:"key"},Qo={class:"value"},Ko={class:"item"},Wo={class:"key"},Xo={key:0,class:"value"},Zo={key:1,class:"value"},ot={class:"item"},tt={class:"key"},st={class:"value"},et={class:"blue-font"},at={class:"item"},nt={class:"key"},lt={class:"value"},it={class:"item"},ct={class:"key"},dt={class:"value"},rt=O(()=>t("div",{class:"footer"},null,-1)),ut=O(()=>t("img",{src:ho,alt:""},null,-1)),kt=O(()=>t("img",{src:vo,alt:""},null,-1)),mt={__name:"Detail",props:{lockId:String,tokenType:String,version:String},setup(C){const n=C,{t:a}=Z(),$=W(),U=X(),g=w(!1),o=io({id:n.lockId,address:"",amountString:"",tokenList:[],lockDate:0,unlockDate:0,isLpToken:!1,symbol:"",chain:"",isExpired:!1,chainCoinSymbol:"",decimals:0}),b=w(!1),f=w(!1);async function F(){g.value=!1;let r;n.version=="V2"?r=await u.wallet.contractTokenLockV2(U.tokenLockV2Address):n.version=="V3"&&(r=await u.wallet.contractTokenLockV3(U.tokenLockV3Address)),console.dir(r);let c;try{console.log(n.lockId),c=await r.getLockById(n.lockId)}catch{Y(a("failedToGetDetail"));return}if(o.lockDate=Number(c[4]),o.unlockDate=Number(c[5]),o.tokenId=c.tokenId,o.address=c[1],o.owner=c[2],o.isExpired=R().unix()>=o.unlockDate,o.chain=$.chain,o.chainCoinSymbol=$.chainCoinSymbol,n.tokenType=="lpToken"){if(n.version=="V2")try{const d=await u.wallet.contractLP(o.address);let m=await d.decimals();o.decimals=m;let e=await d.token0(),L=await(await u.wallet.contractERC20(e)).symbol(),_=await d.token1(),S=await(await u.wallet.contractERC20(_)).symbol();o.isLpToken=!0,o.tokenList[0]={symbol:L.toUpperCase(),address:e.toLowerCase()},o.tokenList[1]={symbol:S.toUpperCase(),address:_.toLowerCase()},o.amountString=M(c[3],m),o.symbol=`${L}/${S}`}catch(d){console.log(d)}else if(n.version=="V3")try{let m=await(await u.wallet.contractNFT(o.address)).positions(o.tokenId);console.log(m.token0);let e=m.token0,L=await(await u.wallet.contractERC20(e)).symbol(),_=m.token1,S=await(await u.wallet.contractERC20(_)).symbol();o.isLpToken=!0,o.tokenList[0]={symbol:L.toUpperCase(),address:e.toLowerCase()},o.tokenList[1]={symbol:S.toUpperCase(),address:_.toLowerCase()},o.liquidity=m.liquidity,o.symbol=`${L}/${S}`}catch(d){console.log(d)}}else if(n.tokenType=="token")try{const d=await u.wallet.contractERC20(o.address);let m=await d.symbol(),e=await d.decimals();o.decimals=e,o.tokenList=[],o.isLpToken=!1,o.symbol=m.toUpperCase(),o.amountString=M(c[3],e)}catch(d){console.log(d)}g.value=!0,console.log("getDetailDone")}function N(){console.log(o),b.value=!0}function P(){f.value=!0}function H(){window.location.reload()}return co(()=>{F()}),w(!0),console.log(n.lockId),console.log(n.tokenType),(r,c)=>{const d=G("van-button"),m=G("van-action-bar");return p(),y(so,null,[g.value?(p(),y("div",Po,[o.isLpToken?(p(),y("div",Ho,[k(E,{class:"token-icon",tokenIcon:l(B)(o.chain,o.tokenList[0].address)},null,8,["tokenIcon"]),k(E,{class:"token-icon",tokenIcon:l(B)(o.chain,o.tokenList[1].address)},null,8,["tokenIcon"]),v(" "+s(`${o.symbol} (${l(A)(o.address)})`),1)])):(p(),y("div",Ro,[o.address?(p(),q(E,{key:0,class:"token-icon",tokenIcon:l(B)(o.chain,o.address.toLowerCase()),chainIcon:l(oo)(o.chain)},null,8,["tokenIcon","chainIcon"])):I("",!0),v(" "+s(`${o.symbol} (${l(A)(o.address)})`),1)])),t("ul",Yo,[t("li",Go,[t("div",Mo,s(r.$t("contractAddress")),1),t("div",qo,[v(s(l(A)(o.address))+" ",1),k(J,{class:"copy-icon",name:"copy",onClick:c[0]||(c[0]=e=>l(Q)(o.address))})])]),n.version=="V3"?(p(),y("li",Oo,[t("div",jo,s(r.$t("tokenID")),1),t("div",xo,s(n.lockId),1)])):I("",!0),t("li",zo,[t("div",Jo,s(r.$t("contractChian")),1),t("div",Qo,s(o.chain.toUpperCase()),1)]),t("li",Ko,[t("div",Wo,s(`${o.symbol} ${r.$t("lockNumber")}`),1),n.version=="V2"?(p(),y("div",Xo,s(o.amountString),1)):I("",!0),n.version=="V3"?(p(),y("div",Zo,s(l(to).formatEther(o.liquidity.toString())),1)):I("",!0)]),t("li",ot,[t("div",tt,s(r.$t("unlockTime2")),1),t("div",st,[t("span",null,s(l(R).unix(o.unlockDate).format("YYYY-MM-DD HH:mm:ss")),1),t("span",null,[v("("),t("span",et,s(o.isExpired?r.$t("expired"):r.$t("dayLeft",{day:l(ro)(l(R).unix(o.unlockDate).toDate())})),1),v(")")])])]),t("li",at,[t("div",nt,s(r.$t("lockUser")),1),t("div",lt,[v(s(l(A)(o.owner))+" ",1),k(J,{class:"copy-icon",name:"copy",onClick:c[1]||(c[1]=e=>l(Q)(o.owner))})])]),t("li",it,[t("div",ct,s(r.$t("lockTime")),1),t("div",dt,s(l(R).unix(o.lockDate).format("YYYY-MM-DD HH:mm:ss")),1)])])])):I("",!0),rt,!o.isExpired&&g.value&&l($).walletAddress&&o.owner.toLowerCase()==l($).walletAddress.toLowerCase()?(p(),q(m,{key:1,class:"tools"},{default:D(()=>[k(d,{class:"btn",color:"#9F3FF7",onClick:N},{icon:D(()=>[ut]),default:D(()=>[v(s(r.$t("delay")),1)]),_:1}),n.version=="V2"?(p(),q(d,{key:0,class:"btn",color:"#3F80F7",onClick:P},{icon:D(()=>[kt]),default:D(()=>[v(s(r.$t("append")),1)]),_:1})):I("",!0),k(mo,{show:b.value,"onUpdate:show":c[2]||(c[2]=e=>b.value=e),onSuccess:H,isLockV2:n.version=="V2",lockId:o.id,isLpToken:o.isLpToken,chain:o.chain,unlockDate:o.unlockDate,tokenList:o.tokenList,symbol:o.symbol,address:o.address,chainCoinSymbol:o.chainCoinSymbol,amountString:o.amountString,decimals:o.decimals},null,8,["show","isLockV2","lockId","isLpToken","chain","unlockDate","tokenList","symbol","address","chainCoinSymbol","amountString","decimals"]),k(No,{show:f.value,"onUpdate:show":c[3]||(c[3]=e=>f.value=e),onSuccess:H,isLockV2:n.version=="V2",lockId:o.id,isLpToken:o.isLpToken,chain:o.chain,unlockDate:o.unlockDate,tokenList:o.tokenList,symbol:o.symbol,address:o.address,chainCoinSymbol:o.chainCoinSymbol,amountString:o.amountString,decimals:o.decimals},null,8,["show","isLockV2","lockId","isLpToken","chain","unlockDate","tokenList","symbol","address","chainCoinSymbol","amountString","decimals"])]),_:1})):I("",!0)],64)}}},wt=K(mt,[["__scopeId","data-v-ee52e554"]]);export{wt as default};
