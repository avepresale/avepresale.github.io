import{_ as B,u as Y,d as H,e as O,f as z,g as $,h as P,i as q,r as g,o as c,c as p,b as n,j as s,a as i,t as r,w as A,k as u,l as m,m as b,F as L,s as E,n as N,p as G,q as F,v as S,x as J,T as K,y as Q,z as X,A as I,B as Z,C as ee}from"./index-cf9c8d3a.js";import{u as te}from"./create-4f89c3a6.js";import{D as oe}from"./DropDown-b8418366.js";const ne={class:"token-create"},se={class:"tools-bar"},ae={class:"left"},le={key:0,class:"address"},re={class:"address-text"},ie={style:{"margin-left":"6px"}},ce={class:"tools"},de={class:"token-box"},ue={class:"token"},pe={class:"title"},ve=["onClick"],fe={class:"content"},ge={class:"name"},me={class:"create-time"},ke={key:1,class:"no-data"},ye={class:"text"},he={class:"bottom-operate"},_e={class:"content"},Ce={__name:"Index",setup(we){const{t:W}=Y(),l=H(),T=O(),R=te(),D=z(),v=$(0),k=$(10),a=P({pageNumber:0,tokenList:[],loading:!1,finished:!1,error:!1,refreshing:!1}),y=$(!1);function M(){R.$reset(),D.push("/createToken/create/basicInfo")}async function x(){l.walletAddress||E(W("pleaseConnectWallet"));try{let e=await(await N.wallet.contractTokenFactory(T.tokenFactoryAddress)).totalOwnRecordsForUser(l.walletAddress);v.value=Number(e)}catch(t){console.error(t)}finally{a.refreshing=!1}}async function C(){a.loading=!0;let t=G({duration:0}),e=(a.pageNumber*k.value).toString(),h=(a.pageNumber*k.value+k.value-1).toString();try{let f=await(await N.wallet.contractTokenFactory(T.tokenFactoryAddress)).getOwnRecords(l.walletAddress,e,h);console.log(f);for(let d of f){let w={tokenAddress:d[6].toLowerCase(),createTime:Number(d[0]),symbol:d[4],name:d[3],deployerId:Number(d[5])};a.tokenList.push(w)}f.length<k.value||v.value==Number(h)+1?a.finished=!0:a.pageNumber++}catch(_){a.error=!0,console.log(_)}finally{t.close(),a.loading=!1,a.refreshing=!1}}async function U(){a.pageNumber=0,a.tokenList=[],a.finished=!1,await x(),v.value>0&&(console.log(v.value),C())}function V(t,e){D.push("/createToken/manage/"+t+"/"+e)}return q(()=>{let t=setInterval(async()=>{l.isConnectWallet&&(clearInterval(t),await x(),v.value>0&&C())},100)}),(t,e)=>{const h=g("van-list"),_=g("van-image"),f=g("van-pull-refresh"),d=g("van-button"),w=g("van-dialog");return c(),p(L,null,[n("div",ne,[n("div",se,[n("div",ae,[n("div",{onClick:e[0]||(e[0]=o=>s(l).showSelectDapp=!0)},[i(u,{class:"icon",name:"menu"})]),s(l).isConnectWallet?(c(),p("div",le,[i(oe,{class:"switch-chain",onClick:e[1]||(e[1]=o=>s(l).showSelectChainPopup=!0),error:!s(l).chainId,logo:s(l).chainIcon,value:s(l).chain.toUpperCase()},null,8,["error","logo","value"]),n("div",re,r(s(F)(s(l).walletAddress)),1),i(u,{class:"copy-icon",name:"copy",onClick:e[2]||(e[2]=A(o=>s(S)(s(l).walletAddress),["stop"]))})])):(c(),p("div",{key:1,class:"address",onClick:e[3]||(e[3]=(...o)=>s(l).connectWallet&&s(l).connectWallet(...o))},[i(u,{class:"icon",name:"wallet"}),n("div",ie,r(t.$t("pleaseConnectWallet")),1)]))]),n("div",ce,[i(u,{class:"icon",name:"language",onClick:e[4]||(e[4]=o=>s(l).showLanguagePicker=!0)}),i(u,{class:"icon",name:"help",onClick:e[5]||(e[5]=o=>y.value=!0)})])]),n("div",de,[n("div",ue,[n("div",pe,r(t.$t("myToken")),1),i(f,{modelValue:a.refreshing,"onUpdate:modelValue":e[9]||(e[9]=o=>a.refreshing=o),"pulling-text":t.$t("pulling"),"loosing-text":t.$t("loosing"),"loading-text":t.$t("loading"),onRefresh:U},{default:m(()=>[a.tokenList.length>0?(c(),b(h,{key:0,class:"token-list","loading-text":t.$t("loading"),loading:a.loading,"onUpdate:loading":e[6]||(e[6]=o=>a.loading=o),finished:a.finished,"finished-text":t.$t("noMore"),error:a.error,"onUpdate:error":e[7]||(e[7]=o=>a.error=o),"error-text":t.$t("errorText"),onLoad:e[8]||(e[8]=o=>C())},{default:m(()=>[(c(!0),p(L,null,J(a.tokenList,o=>(c(),p("div",{class:"item",onClick:j=>V(o.deployerId,o.tokenAddress)},[n("div",null,[i(K,{class:"token-icon",tokenIcon:s(Q)(s(l).chain.toLowerCase(),o.tokenAddress.toLowerCase()),chainIcon:s(X)(s(l).chain.toLowerCase())},null,8,["tokenIcon","chainIcon"]),n("div",fe,[n("div",ge,[n("span",null,r(o.symbol),1),n("span",null,"（"+r(o.name)+"）",1)]),n("div",null,[I(r(s(F)(o.tokenAddress))+" ",1),i(u,{class:"copy-icon",name:"copy",onClick:A(j=>s(S)(o.tokenAddress),["stop"])},null,8,["onClick"])]),n("div",me,r(s(Z).unix(o.createTime).format("YYYY-MM-DD HH:mm:ss")),1)])]),n("div",null,[i(u,{class:"image",name:"arrow"})])],8,ve))),256))]),_:1},8,["loading-text","loading","finished","finished-text","error","error-text"])):(c(),p("div",ke,[i(_,{class:"image",src:"/assets/images/warn.png"}),n("div",ye,r(t.$t("noToken")),1)]))]),_:1},8,["modelValue","pulling-text","loosing-text","loading-text"])])]),n("div",he,[s(l).isConnectWallet?(c(),b(d,{key:0,type:"primary",round:"",block:"",class:"btn",onClick:M},{default:m(()=>[I(r(t.$t("createToken")),1)]),_:1})):(c(),b(d,{key:1,type:"primary",round:"",block:"",class:"btn",onClick:s(l).connectWallet},{default:m(()=>[I(r(t.$t("connectWallet")),1)]),_:1},8,["onClick"]))])]),i(w,{class:"help-dialog",show:y.value,title:t.$t("rulesDescription"),"confirm-button-text":t.$t("understand"),onConfirm:e[10]||(e[10]=o=>y.value=!1),onClose:e[11]||(e[11]=o=>y.value=!1),"close-on-click-overlay":""},{default:m(()=>[n("div",_e,[n("div",null,r(t.$t("rulesDescription1",{chains:s(ee)[s(l).dappType].chainList.map(o=>o.chain.toUpperCase()).join("/")})),1),n("div",null,r(t.$t("rulesDescription2")),1),n("div",null,r(t.$t("rulesDescription3")),1),n("div",null,r(t.$t("rulesDescription4")),1),n("div",null,r(t.$t("rulesDescription5")),1)])]),_:1},8,["show","title","confirm-button-text"])],64)}}},Te=B(Ce,[["__scopeId","data-v-07aef790"]]);export{Te as default};
