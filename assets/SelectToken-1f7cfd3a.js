import{_ as J,l as K,U as Q,d as X,a0 as Y,u as Z,e as w,I as V,G as M,n as ee,r as g,o as u,c as p,a as y,b as o,E as x,t as r,F as T,z as O,f as c,w as S,a3 as te,v as m,g as U,T as N,B as ae,i as W,A,N as se,x as oe,P as ne,M as le}from"./index-80f2af42.js";import{B as I}from"./bignumber-3e8dfdf6.js";const ce={class:"body"},ie={class:"content"},re={class:"type"},de={class:"network"},ue={class:"network-list"},ke=["onClick"],he={class:"item-left"},ve={class:"left-content"},me={class:"token-name"},_e={class:"token-address"},fe={class:"token"},we={class:"left-content"},pe={class:"token-name"},Ce={class:"token-address"},ye={class:"item-right"},Le={class:"item-right-left"},be={class:"qty"},ge={class:"amount"},Te={class:"item-right-right"},B="/lockMaster/create",Ie={__name:"SelectToken",setup($e){const $=K();Q();const l=X(),L=Y(),{t:D}=Z(),C=w([]),k=w([]),n=w(""),d=w(0);async function z(){if(d.value==0)if(n.value)if(n.value.startsWith("0x")){let e=C.value.filter(s=>s.address.toLowerCase()==n.value.toLowerCase());if(e.length==0&&ne(n.value)){let s=await m.wallet.contractERC20(n.value);const i=n.value.toLowerCase(),v=await s.balanceOf(l.walletAddress),t=await s.decimals(),_=await s.name(),a=await s.symbol();let f={address:i,amount:Number(le(v.toString(),t)),chain:l.chain,chainCoinSymbol:l.chainCoinSymbol,decimals:Number(t),icon:`https://ave.s3.ap-east-1.amazonaws.com/token_icon/${l.chain}/${i}.png`,name:_,price:0,symbol:a,tokenId:`${i}-${l.chain}`,tokenType:0};e.push(f)}return e}else return C.value.filter(e=>e.symbol.toLowerCase().indexOf(n.value.toLowerCase())>-1);else return C.value;else if(d.value==1)return n.value?n.value.startsWith("0x")?k.value.filter(e=>e.address.toLowerCase()==n.value.toLowerCase()):k.value.filter(e=>e.symbol.toLowerCase().indexOf(n.value.toLowerCase())>-1):k.value;return[]}const E=w([]);V(()=>[n.value,C.value,d.value],async()=>{E.value=await z()});const b=M.chainList.filter(e=>M[l.dappType].chainList.map(s=>s.chain).some(s=>s==e.chain)),h=w(b.find(e=>e.chain==l.chain)?b.find(e=>e.chain==l.chain):b[0]);async function P(e){h.value.chain!=e.chain&&await m.wallet.switchNetwork(e.chainId)}async function F(){const e=oe({message:"Loading...",forbidClick:!0,duration:0}),s=await m.debank.getTokenList(l.walletAddress,h.value.chain);let i=[],v=[];for(let t of s.data.data){if(t.token=="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"){t.token=m.wallet.MAIN_COIN_ADDRESS;continue}if(new RegExp("^0x.*$","gi").test(t.token)&&t.value>0&&t.risk_score<60&&t.risk_level>=0&&t.flag!=="blacklist"&&t.symbol!==""){if(t.token=="0xc748673057861a797275cd8a068abb95a902e8de")continue;t.flag=="lp"?v.push({tokenList:[{address:"",symbol:""},{address:"",symbol:""}],symbol:"",address:t.token.toLowerCase(),tokenId:`${t.token}-${t.chain}`.toLowerCase(),chain:t.chain.toLowerCase(),decimals:t.decimals,amount:t.value,price:t.current_price_usd,hasTokenInfo:!1,tokenType:1,chainCoinSymbol:h.value.nativeCurrency.symbol,name:t.name}):i.push({address:t.token.toLowerCase(),tokenId:`${t.token}-${t.chain}`.toLowerCase(),chain:t.chain.toLowerCase(),symbol:t.symbol,decimals:t.decimals,icon:A(t.chain.toLowerCase(),t.token.toLowerCase()),amount:t.value,price:t.current_price_usd,tokenType:0,chainCoinSymbol:h.value.nativeCurrency.symbol,name:t.name})}}C.value=i,k.value=v,e.close()}V(()=>l.isConnectWallet,async(e,s)=>{e&&await F()});function q(e){L.token=e,L.prevPath.toLowerCase()==B.toLowerCase()?$.back():$.push(B)}function G(){$.push(B)}async function j(){console.log("init",l.isConnectWallet),l.isConnectWallet&&await F()}function R(e){d.value!=e&&(d.value=e,e===1&&H())}async function H(){if(k.value.length!=0){if(h.value.chainId!=l.chainId){te(D("switchTrueChain",{cahin:h.value.chain})),k.value=[];return}for(let e of k.value)if(e.hasTokenInfo==!1){let s=await m.wallet.contractLP(e.address),i=await s.token0(),t=await(await m.wallet.contractERC20(i)).symbol(),_=await s.token1(),f=await(await m.wallet.contractERC20(_)).symbol();e.tokenList[0]={symbol:t.toUpperCase(),address:i.toLowerCase()},e.tokenList[1]={symbol:f.toUpperCase(),address:_.toLowerCase()},e.symbol=`${t}/${f}`}}}return ee(()=>{console.log("onMounted"),j()}),(e,s)=>{const i=g("van-search"),v=g("van-icon"),t=g("van-cell"),_=g("van-list");return u(),p("div",ce,[y(i,{modelValue:n.value,"onUpdate:modelValue":s[0]||(s[0]=a=>n.value=a),shape:"round","show-action":"",placeholder:e.$t("searchTokenContractOrName"),"action-text":e.$t("cancel"),onCancel:G},null,8,["modelValue","placeholder","action-text"]),o("div",ie,[o("div",re,[o("div",{class:x({select:d.value==0}),onClick:s[1]||(s[1]=a=>R(0))},r(e.$t("myToken")),3),o("div",{class:x({select:d.value==1}),onClick:s[2]||(s[2]=a=>R(1))},r(e.$t("myLp")),3)]),o("div",de,[o("ul",ue,[(u(!0),p(T,null,O(c(b),a=>(u(),p("li",{class:x(h.value.chain==a.chain?"network-selected":""),onClick:f=>P(a)},r(a.chain.toUpperCase()),11,ke))),256))])]),o("div",null,[y(_,{"finished-text":e.$t("noMore"),class:"token-list"},{default:S(()=>[(u(!0),p(T,null,O(E.value,a=>(u(),U(t,{class:"item",key:a,onClick:f=>q(a)},{title:S(()=>[o("div",he,[d.value==0?(u(),p(T,{key:0},[y(N,{class:"token-icon-1",tokenIcon:a.icon,chainIcon:c(ae)(a.chain)},null,8,["tokenIcon","chainIcon"]),o("div",ve,[o("div",me,r(a.symbol),1),o("div",_e,r(c(W)(a.address)),1)])],64)):(u(),p(T,{key:1},[o("div",fe,[y(N,{class:"token-icon-2",tokenIcon:c(A)(a.chain,a.tokenList[0].address)},null,8,["tokenIcon"]),y(N,{class:"token-icon-2",tokenIcon:c(A)(a.chain,a.tokenList[1].address)},null,8,["tokenIcon"])]),o("div",we,[o("div",pe,r(a.symbol),1),o("div",Ce,r(c(W)(a.address)),1)])],64))])]),value:S(()=>[o("div",ye,[o("div",Le,[o("div",be,r(c(I)(a.amount).toString().indexOf(".")==-1?c(I)(a.amount):c(I)(a.amount).toFixed(6,1)),1),o("div",ge,"$"+r(c(I)(a.amount).multipliedBy(a.price).toFixed(2,1)),1)]),o("div",Te,[c(L).token&&c(L).token.address==a.address?(u(),U(v,{key:0,name:"success",color:"#3F80F7"})):se("",!0)])])]),_:2},1032,["onClick"]))),128))]),_:1},8,["finished-text"])])])])}}},Ne=J(Ie,[["__scopeId","data-v-0ebae4a5"]]);export{Ne as default};
