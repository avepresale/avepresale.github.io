import{h as b,N as k,O as g,D as f}from"./index-6e5c65ab.js";import{f as l,B as u}from"./dayjs.min-9be025a9.js";const o=b(),S=k("presaleStore",{state:()=>({tokenAddress:"",tokenName:"",presaleData:[{list:[],loading:!1,pageNo:1,finished:!1,error:!1,refreshing:!1},{list:[],loading:!1,pageNo:1,finished:!1,error:!1,refreshing:!1},{list:[],loading:!1,pageNo:1,finished:!1,error:!1,refreshing:!1},{list:[],loading:!1,pageNo:1,finished:!1,error:!1,refreshing:!1}],myPresale:{list:[],loading:!1,pageNo:1,finished:!1,error:!1,refreshing:!1}}),actions:{getJoinedContractAddresses(s){let r=g.get("joinedContractAddressMap",{});return r[s]?r[s]:[]},setJoinedContractAddresses(s,r){let t=g.get("joinedContractAddressMap",{}),e=t[s]?t[s]:[];e.includes(r)||(e.push(r),t[s]=e,g.set("joinedContractAddressMap",t))},async getPresaleList(s){if(o.chainId==-1)return;let r,t=[];if(s==0)r=1;else if(s==1){if(r=0,t=this.getJoinedContractAddresses(o.walletAddress),t.length==0){this.presaleData[s].loading=!1,this.presaleData[s].refreshing=!1;return}}else s==2?r=2:s==3&&(r=3);if(this.presaleData[s].loading)return;this.presaleData[s].error=!1,this.presaleData[s].loading=!0;let e=10,n={chain:o.chain,pageNo:this.presaleData[s].pageNo,pageSize:e,tokenAddress:this.tokenAddress,tokenName:this.tokenName};n.joinedContractAddresses=t,n.type=r;try{const i=await f.presale.getPresaleList(JSON.stringify(n));if(i.status==1){for(let a of i.data.list){let d=l(a.hardCap,Number(a.baseTokenDecimal)),m=l(a.softCap,Number(a.baseTokenDecimal)),p=u(a.salePrice).div("1000000").toString(),c=l(a.saleAmount,Number(a.baseTokenDecimal)),h=l(await f.wallet.getCumulateAmount(a.contractAddress),Number(a.tokenDecimal));console.log(h),this.presaleData[s].list.push({isMine:!1,approveStatus:a.approveStatus,chain:o.chain,status:a.status,contractAddress:a.contractAddress,tokenAddress:a.tokenAddress,tokenName:a.tokenName,tokenSymbol:a.tokenSymbol,hardCap:d,softCap:m,baseTokenAddress:a.baseTokenAddress,baseTokenName:a.baseTokenName,baseTokenSymbol:a.baseTokenSymbol,baseTokenDecimal:a.baseTokenDecimal,startTime:a.startTime,endTime:a.endTime,endSaleTime:a.endSaleTime,endSaleTxHash:a.endSaleTxHash,salePrice:p,saleAmount:c,cumulateAmount:h,progressRate:u(h).div(d).multipliedBy(100).toNumber()})}i.data.list.length<e?this.presaleData[s].finished=!0:this.presaleData[s].pageNo++}else this.presaleData[s].error=!0}catch(i){console.log(i),this.presaleData[s].error=!0}finally{this.presaleData[s].loading=!1,this.presaleData[s].refreshing=!1}},async getMyCreatedPresaleList(){if(o.chainId==-1)return;let s=10;this.myPresale.error=!1,this.myPresale.loading=!0;let r={chain:o.chain,creator:o.walletAddress,pageNo:this.myPresale.pageNo,pageSize:s};try{const t=await f.presale.getMyCreatedPresaleList(r);if(t.status==1){for(let e of t.data.list){let n=l(e.hardCap,Number(e.baseTokenDecimal)),i=l(e.softCap,Number(e.baseTokenDecimal)),a=u(e.salePrice).div("1000000").toString(),d=l(e.saleAmount,Number(e.baseTokenDecimal)),m=l(await f.wallet.getCumulateAmount(e.contractAddress),Number(e.tokenDecimal));this.myPresale.list.push({isMine:!0,approveStatus:e.approveStatus,chain:o.chain,status:e.status,contractAddress:e.contractAddress,tokenAddress:e.tokenAddress,tokenName:e.tokenName,tokenSymbol:e.tokenSymbol,hardCap:n,softCap:i,baseTokenAddress:e.baseTokenAddress,baseTokenName:e.baseTokenName,baseTokenSymbol:e.baseTokenSymbol,baseTokenDecimal:e.baseTokenDecimal,startTime:e.startTime,endTime:e.endTime,endSaleTime:e.endSaleTime,salePrice:a,saleAmount:d,cumulateAmount:m,progressRate:u(m).div(n).multipliedBy(100).toNumber()})}t.data.list.length<s?this.myPresale.finished=!0:this.myPresale.pageNo++}else this.myPresale.error=!0}catch(t){console.log(t),this.myPresale.error=!0}finally{this.myPresale.loading=!1,this.myPresale.refreshing=!1}}}});export{S as u};
