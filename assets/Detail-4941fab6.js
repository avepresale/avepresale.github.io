import{_ as Z,d as J,W as K,u as X,g as w,G as ao,p as j,r as M,o as p,c as y,a as k,l as D,b as t,t as e,T as E,j as l,y as B,A as v,q as A,z as oo,F as to,n as u,Z as H,s as lo,h as io,i as co,m as q,I,k as x,B as R,v as z,Y as ro,M as uo,N as ko}from"./index-1f7e1360.js";import{D as mo}from"./DelayPopup-af055238.js";import{O as po}from"./OperateSuccessDialog-f274e5ae.js";import{e as eo}from"./ethers-5600de00.js";import{I as _o}from"./InputQty-48778327.js";import{B as V}from"./bignumber-3e8dfdf6.js";import{f as G,b as Q,a as W}from"./units-ca4bd8ae.js";const ho="/assets/images/time.png",vo="/assets/images/add.png";const yo={class:"ave-popup"},wo={class:"title"},go={class:"body"},bo={class:"info"},fo={class:"key"},Lo={class:"value"},So={key:0,class:"token"},Co={key:1,class:"token"},$o={class:"key"},Io={class:"value"},Do={class:"key"},To={class:"value"},Vo={class:"key"},Ao={class:"value"},Eo={class:"key"},Bo={class:"value"},Uo={style:{}},Fo={__name:"AppendLockPopup",props:{show:Boolean,lockId:String,isLockV2:Boolean,isLpToken:Boolean,unlockDate:Number,tokenList:Array,symbol:String,address:String,chainCoinSymbol:String,amountString:String,chain:String,decimals:Number},emits:["update:show","success"],setup(C,{emit:a}){const n=C,$=J(),U=K(),{t:g}=X(),o=w(0n),b=w(""),f=w(""),F=w(""),N=w(!1),P=w("");async function Y(){const i=await(await u.wallet.contractERC20(n.address)).balanceOf($.walletAddress);if(f.value=G(i,n.decimals),console.log("value:"+f.value),i==0n)throw H(g("balanceSlow")),a("update:show",!1),"Blance Slow"}async function r(){if(!n.isLockV2)return;const s=await u.wallet.contractTokenLockV2(U.tokenLockV2Address);o.value=await s.editFee();const i=await u.wallet.getBalance($.walletAddress);if(console.log("balance",i),i<o.value){lo(g("balanceSlow2",{chainMianCoin:$.chainCoinSymbol,amount:Q(o.value)})),a("update:show",!1);return}const _=await(await u.wallet.contractERC20(n.address)).decimals(),h=G("1",_),S=V(n.amountString).plus(V(h)).toString(),T=W(S,_),so=await u.wallet.getGasPrice();let no=await s.editLock.estimateGas(n.lockId.toString(),T.toString(),0n,{value:o.value});F.value=Q(no*so).toString()}async function c(){if(!n.isLockV2)return;if(!b.value){H(g("enterAmount"));return}if(V(b.value).gt(V(f.value))){H(g("balanceSlow"));return}const s=j({message:"Loading...",forbidClick:!0,duration:0}),i=await u.wallet.contractTokenLockV2(U.tokenLockV2Address),_=await(await u.wallet.contractERC20(n.address)).decimals(),h=V(n.amountString).plus(V(b.value)).toString();console.log(h);const S=W(h,_);try{o.value=await i.editFee();let T=await i.editLock(n.lockId.toString(),S.toString(),0n,{value:o.value});console.dir(T),P.value=T.hash,N.value=!0}catch(T){console.log(T)}finally{s.close()}}ao(()=>n.show,(s,i)=>{s&&d()});async function d(){const s=j({message:"Loading...",forbidClick:!0,duration:0});try{await Y(),await r()}catch(i){console.log(i)}finally{s.close()}}function m(){a("update:show",!1),a("success")}return(s,i)=>{const L=M("van-button"),_=M("van-popup");return p(),y(to,null,[k(_,{show:C.show,"onUpdate:show":i[1]||(i[1]=h=>{a("update:show",h)}),round:"",closeable:"",position:"bottom"},{default:D(()=>[t("div",yo,[t("div",wo,e(s.$t("appendLock")),1),t("div",go,[t("ul",bo,[t("li",null,[t("div",fo,e(s.$t("appendAssets")),1),t("div",Lo,[n.isLpToken?(p(),y("div",So,[k(E,{class:"token-icon",tokenIcon:l(B)(n.chain,n.tokenList[0].address)},null,8,["tokenIcon"]),k(E,{class:"token-icon",tokenIcon:l(B)(n.chain,n.tokenList[1].address)},null,8,["tokenIcon"]),v(" "+e(`${n.symbol} (${l(A)(n.address)})`),1)])):(p(),y("div",Co,[k(E,{class:"token-icon",tokenIcon:l(B)(n.chain,n.address),chainIcon:l(oo)(n.chain)},null,8,["tokenIcon","chainIcon"]),v(" "+e(`${n.symbol} (${l(A)(n.address)})`),1)]))])]),t("li",null,[t("div",$o,e(s.$t("currentAmount")),1),t("div",Io,e(n.amountString),1)]),t("li",null,[t("div",Do,e(s.$t("balance")),1),t("div",To,e(`${f.value} ${n.symbol}`),1)]),t("li",null,[t("div",Vo,e(s.$t("editFee")),1),t("div",Ao,e(`${o.value?l(eo).formatEther(o.value):"--"} ${n.chainCoinSymbol}`),1)]),t("li",null,[t("div",Eo,e(s.$t("gas")),1),t("div",Bo,e(`${F.value?F.value:"--"} ${n.chainCoinSymbol}`),1)])]),t("div",Uo,[k(_o,{total:f.value,amount:b.value,"onUpdate:amount":i[0]||(i[0]=h=>b.value=h),decimals:n.decimals},null,8,["total","amount","decimals"])]),k(L,{class:"btn",type:"primary",block:"",onClick:c},{default:D(()=>[v(e(s.$t("confirmAndLock")),1)]),_:1})])])]),_:1},8,["show"]),k(po,{show:N.value,"onUpdate:show":i[2]||(i[2]=h=>N.value=h),txHash:P.value,onClose:m},null,8,["show","txHash"])],64)}}},No=Z(Fo,[["__scopeId","data-v-828095f1"]]);const O=C=>(uo("data-v-ee52e554"),C=C(),ko(),C),Po={key:0,class:"body"},Yo={key:0,class:"token"},Ro={key:1,class:"token"},Ho={class:"info"},Mo={class:"item"},Go={class:"key"},qo={class:"value"},Oo={key:0,class:"item"},jo={class:"key"},xo={class:"value"},zo={class:"item"},Qo={class:"key"},Wo={class:"value"},Zo={class:"item"},Jo={class:"key"},Ko={key:0,class:"value"},Xo={key:1,class:"value"},ot={class:"item"},tt={class:"key"},et={class:"value"},st={class:"blue-font"},nt={class:"item"},at={class:"key"},lt={class:"value"},it={class:"item"},ct={class:"key"},dt={class:"value"},rt=O(()=>t("div",{class:"footer"},null,-1)),ut=O(()=>t("img",{src:ho,alt:""},null,-1)),kt=O(()=>t("img",{src:vo,alt:""},null,-1)),mt={__name:"Detail",props:{lockId:String,tokenType:String,version:String},setup(C){const a=C,{t:n}=X(),$=J(),U=K(),g=w(!1),o=io({id:a.lockId,address:"",amountString:"",tokenList:[],lockDate:0,unlockDate:0,isLpToken:!1,symbol:"",chain:"",isExpired:!1,chainCoinSymbol:"",decimals:0}),b=w(!1),f=w(!1);async function F(){g.value=!1;let r;a.version=="V2"?r=await u.wallet.contractTokenLockV2(U.tokenLockV2Address):a.version=="V3"&&(r=await u.wallet.contractTokenLockV3(U.tokenLockV3Address)),console.dir(r);let c;try{console.log(a.lockId),c=await r.getLockById(a.lockId)}catch{H(n("failedToGetDetail"));return}if(o.lockDate=Number(c[4]),o.unlockDate=Number(c[5]),o.tokenId=c.tokenId,o.address=c[1],o.owner=c[2],o.isExpired=R().unix()>=o.unlockDate,o.chain=$.chain,o.chainCoinSymbol=$.chainCoinSymbol,a.tokenType=="lpToken"){if(a.version=="V2")try{const d=await u.wallet.contractLP(o.address);let m=await d.decimals();o.decimals=m;let s=await d.token0(),L=await(await u.wallet.contractERC20(s)).symbol(),_=await d.token1(),S=await(await u.wallet.contractERC20(_)).symbol();o.isLpToken=!0,o.tokenList[0]={symbol:L.toUpperCase(),address:s.toLowerCase()},o.tokenList[1]={symbol:S.toUpperCase(),address:_.toLowerCase()},o.amountString=G(c[3],m),o.symbol=`${L}/${S}`}catch(d){console.log(d)}else if(a.version=="V3")try{let m=await(await u.wallet.contractNFT(o.address)).positions(o.tokenId);console.log(m.token0);let s=m.token0,L=await(await u.wallet.contractERC20(s)).symbol(),_=m.token1,S=await(await u.wallet.contractERC20(_)).symbol();o.isLpToken=!0,o.tokenList[0]={symbol:L.toUpperCase(),address:s.toLowerCase()},o.tokenList[1]={symbol:S.toUpperCase(),address:_.toLowerCase()},o.liquidity=m.liquidity,o.symbol=`${L}/${S}`}catch(d){console.log(d)}}else if(a.tokenType=="token")try{const d=await u.wallet.contractERC20(o.address);let m=await d.symbol(),s=await d.decimals();o.decimals=s,o.tokenList=[],o.isLpToken=!1,o.symbol=m.toUpperCase(),o.amountString=G(c[3],s)}catch(d){console.log(d)}g.value=!0,console.log("getDetailDone")}function N(){console.log(o),b.value=!0}function P(){f.value=!0}function Y(){window.location.reload()}return co(()=>{F()}),w(!0),console.log(a.lockId),console.log(a.tokenType),(r,c)=>{const d=M("van-button"),m=M("van-action-bar");return p(),y(to,null,[g.value?(p(),y("div",Po,[o.isLpToken?(p(),y("div",Yo,[k(E,{class:"token-icon",tokenIcon:l(B)(o.chain,o.tokenList[0].address)},null,8,["tokenIcon"]),k(E,{class:"token-icon",tokenIcon:l(B)(o.chain,o.tokenList[1].address)},null,8,["tokenIcon"]),v(" "+e(`${o.symbol} (${l(A)(o.address)})`),1)])):(p(),y("div",Ro,[o.address?(p(),q(E,{key:0,class:"token-icon",tokenIcon:l(B)(o.chain,o.address.toLowerCase()),chainIcon:l(oo)(o.chain)},null,8,["tokenIcon","chainIcon"])):I("",!0),v(" "+e(`${o.symbol} (${l(A)(o.address)})`),1)])),t("ul",Ho,[t("li",Mo,[t("div",Go,e(r.$t("contractAddress")),1),t("div",qo,[v(e(l(A)(o.address))+" ",1),k(x,{class:"copy-icon",name:"copy",onClick:c[0]||(c[0]=s=>l(z)(o.address))})])]),a.version=="V3"?(p(),y("li",Oo,[t("div",jo,e(r.$t("tokenID")),1),t("div",xo,e(a.lockId),1)])):I("",!0),t("li",zo,[t("div",Qo,e(r.$t("contractChian")),1),t("div",Wo,e(o.chain.toUpperCase()),1)]),t("li",Zo,[t("div",Jo,e(`${o.symbol} ${r.$t("lockNumber")}`),1),a.version=="V2"?(p(),y("div",Ko,e(o.amountString),1)):I("",!0),a.version=="V3"?(p(),y("div",Xo,e(l(eo).formatEther(o.liquidity.toString())),1)):I("",!0)]),t("li",ot,[t("div",tt,e(r.$t("unlockTime2")),1),t("div",et,[t("span",null,e(l(R).unix(o.unlockDate).format("YYYY-MM-DD HH:mm:ss")),1),t("span",null,[v("("),t("span",st,e(o.isExpired?r.$t("expired"):r.$t("dayLeft",{day:l(ro)(l(R).unix(o.unlockDate).toDate())})),1),v(")")])])]),t("li",nt,[t("div",at,e(r.$t("lockUser")),1),t("div",lt,[v(e(l(A)(o.owner))+" ",1),k(x,{class:"copy-icon",name:"copy",onClick:c[1]||(c[1]=s=>l(z)(o.owner))})])]),t("li",it,[t("div",ct,e(r.$t("lockTime")),1),t("div",dt,e(l(R).unix(o.lockDate).format("YYYY-MM-DD HH:mm:ss")),1)])])])):I("",!0),rt,!o.isExpired&&g.value&&l($).walletAddress&&o.owner.toLowerCase()==l($).walletAddress.toLowerCase()?(p(),q(m,{key:1,class:"tools"},{default:D(()=>[k(d,{class:"btn",color:"#9F3FF7",onClick:N},{icon:D(()=>[ut]),default:D(()=>[v(e(r.$t("delay")),1)]),_:1}),a.version=="V2"?(p(),q(d,{key:0,class:"btn",color:"#3F80F7",onClick:P},{icon:D(()=>[kt]),default:D(()=>[v(e(r.$t("append")),1)]),_:1})):I("",!0),k(mo,{show:b.value,"onUpdate:show":c[2]||(c[2]=s=>b.value=s),onSuccess:Y,isLockV2:a.version=="V2",lockId:o.id,isLpToken:o.isLpToken,chain:o.chain,unlockDate:o.unlockDate,tokenList:o.tokenList,symbol:o.symbol,address:o.address,chainCoinSymbol:o.chainCoinSymbol,amountString:o.amountString,decimals:o.decimals},null,8,["show","isLockV2","lockId","isLpToken","chain","unlockDate","tokenList","symbol","address","chainCoinSymbol","amountString","decimals"]),k(No,{show:f.value,"onUpdate:show":c[3]||(c[3]=s=>f.value=s),onSuccess:Y,isLockV2:a.version=="V2",lockId:o.id,isLpToken:o.isLpToken,chain:o.chain,unlockDate:o.unlockDate,tokenList:o.tokenList,symbol:o.symbol,address:o.address,chainCoinSymbol:o.chainCoinSymbol,amountString:o.amountString,decimals:o.decimals},null,8,["show","isLockV2","lockId","isLpToken","chain","unlockDate","tokenList","symbol","address","chainCoinSymbol","amountString","decimals"])]),_:1})):I("",!0)],64)}}},bt=Z(mt,[["__scopeId","data-v-ee52e554"]]);export{bt as default};
