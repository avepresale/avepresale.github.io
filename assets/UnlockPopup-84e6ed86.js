import{_ as z,d as J,Z as W,u as Z,g as p,B as D,G as K,r as P,o as $,c as C,a as v,l as x,b as a,t as e,T as F,j as c,y as U,A as b,q as O,z as Q,Y as eo,J as j,F as X,s as L,p as Y,n as d}from"./index-1a0706b1.js";import{S as no,O as oo}from"./OperateSuccessDialog-b6fe2a38.js";import{e as ao}from"./ethers-c8739654.js";import{B as M}from"./bignumber-3e8dfdf6.js";import{a as q,f as so,b as E}from"./units-59394150.js";const lo={class:"ave-popup"},co={class:"title"},io={class:"body"},uo={key:0,class:"info"},ro={class:"key"},ko={class:"value"},vo={key:0,class:"token"},ho={key:1,class:"token"},wo={class:"key"},mo={class:"value"},po={class:"blue-font"},_o={class:"key"},fo={class:"value"},go={class:"key"},yo={class:"value"},bo={class:"select-date"},So={class:"key"},Lo={key:1,class:"change-amount"},$o={class:"key"},Co={__name:"EditPopup",props:{show:Boolean,lockId:String,isLockV2:Boolean,isLpToken:Boolean,unlockDate:Number,tokenList:Array,symbol:String,address:String,chainCoinSymbol:String,amountString:String,chain:String,decimals:Number},emits:["update:show","success"],setup(A,{emit:h}){const o=A,I=J(),S=W(),{t:w}=Z(),t=p(0n),_=p(D.unix(o.unlockDate).toDate()),u=p(o.amountString),V=p(""),T=p(""),B=p(!1),G=p("");async function R(){const i=await(await d.wallet.contractERC20(o.address)).balanceOf(I.walletAddress);V.value=so(i,o.decimals),console.log("value:"+V.value),i==0n&&(L(w("balanceSlow")),h("update:show",!1))}async function l(){console.log("estimateGas");const s=D.unix(o.unlockDate).add(1,"day").unix(),i=await d.wallet.getGasPrice(),m=await d.wallet.getBalance(I.walletAddress);console.log("balance",m);let k;if(o.isLockV2){const y=await d.wallet.contractTokenLockV2(S.tokenLockV2Address),H=await(await d.wallet.contractERC20(o.address)).decimals(),to=q(o.amountString,H);if(t.value=await y.editFee(),m<t.value){L(w("balanceSlow2",{chainMianCoin:I.chainCoinSymbol,amount:E(t.value)})),h("update:show",!1);return}k=await y.editLock.estimateGas(o.lockId,to.toString(),s,{value:t.value})}else{const y=await d.wallet.contractTokenLockV3(S.tokenLockV3Address);if(t.value=await y.editFee(),m<t.value){L(w("balanceSlow2",{chainMianCoin:I.chainCoinSymbol,amount:E(t.value)})),h("update:show",!1);return}k=await y.editLock.estimateGas(o.lockId,s,{value:t.value})}console.dir(k),T.value=E(k*i).toString(),console.log(T.value)}function n(){(M(u.value).lt(o.amountString)||!u.value)&&(u.value=o.amountString)}async function r(){if(!_.value){L(w("selectUnlockTime"));return}if(M(u.value).lt(o.amountString)||!u.value){L(w("newLockedAmountLimit"));return}if(M(u.value).minus(o.amountString).gt(M(V.value))){L(o.symbol+w("balanceSlow"));return}const s=Y({message:"Loading...",forbidClick:!0,duration:0}),i=D(_.value).unix();if(o.isLockV2){const m=await d.wallet.contractTokenLockV2(S.tokenLockV2Address);try{const y=await(await d.wallet.contractERC20(o.address)).decimals(),f=q(u.value,y);t.value=await m.editFee();let H=await m.editLock(o.lockId.toString(),f.toString(),i,{value:t.value});console.dir(H),G.value=H.hash,B.value=!0}catch(k){console.log(k)}finally{s.close()}}else{const m=await d.wallet.contractTokenLockV3(S.tokenLockV3Address);try{t.value=await m.editFee();let k=await m.editLock(o.lockId.toString(),i,{value:t.value});console.dir(k),G.value=k.hash,B.value=!0}catch(k){console.log(k)}finally{s.close()}}}async function g(){const s=Y({message:"Loading...",forbidClick:!0,duration:0});_.value=D.unix(o.unlockDate).add(1,"day").endOf("day").toDate(),u.value=o.amountString,await R(),await l(),s.close()}K(()=>o.show,(s,i)=>{s&&g()});function N(){h("update:show",!1),h("success")}return(s,i)=>{const m=P("van-field"),k=P("van-button"),y=P("van-popup");return $(),C(X,null,[v(y,{show:A.show,"onUpdate:show":i[2]||(i[2]=f=>{h("update:show",f)}),round:"",closeable:"",position:"bottom"},{default:x(()=>[a("div",lo,[a("div",co,e(s.$t("editLock")),1),a("div",io,[o.chain?($(),C("ul",uo,[a("li",null,[a("div",ro,e(s.$t("lockAssets")),1),a("div",ko,[o.isLpToken?($(),C("div",vo,[v(F,{class:"token-icon",tokenIcon:c(U)(o.chain,o.tokenList[0].address)},null,8,["tokenIcon"]),v(F,{class:"token-icon",tokenIcon:c(U)(o.chain,o.tokenList[1].address)},null,8,["tokenIcon"]),b(" "+e(`${o.symbol} (${c(O)(o.address)})`),1)])):($(),C("div",ho,[v(F,{class:"token-icon",tokenIcon:c(U)(o.chain,o.address),chainIcon:c(Q)(o.chain)},null,8,["tokenIcon","chainIcon"]),b(" "+e(`${o.symbol} (${c(O)(o.address)})`),1)]))])]),a("li",null,[a("div",wo,e(s.$t("unlockTime")),1),a("div",mo,[a("span",null,e(c(D).unix(o.unlockDate).format("YYYY-MM-DD HH:mm:ss")),1),a("span",null,[b("("),a("span",po,e(s.$t("dayLeft",{day:c(eo)(c(D).unix(o.unlockDate).toDate())})),1),b(")")])])]),a("li",null,[a("div",_o,e(s.$t("editFee")),1),a("div",fo,e(`${t.value?c(ao).formatEther(t.value):"--"} ${o.chainCoinSymbol}`),1)]),a("li",null,[a("div",go,e(s.$t("gas")),1),a("div",yo,e(`${T.value?T.value:"--"} ${o.chainCoinSymbol}`),1)])])):j("",!0),a("div",bo,[a("div",So,e(s.$t("setDelayDate")),1),v(no,{date:_.value,"onUpdate:date":i[0]||(i[0]=f=>_.value=f),"min-date":c(D).unix(o.unlockDate).add(1,"day").endOf("day").toDate()},null,8,["date","min-date"])]),o.isLockV2?($(),C("div",Lo,[a("div",$o,e(s.$t("newLockedAmount")),1),v(m,{class:"amount",type:"number",modelValue:u.value,"onUpdate:modelValue":i[1]||(i[1]=f=>u.value=f),onBlur:n,placeholder:s.$t("pleaseEnter")},null,8,["modelValue","placeholder"])])):j("",!0),v(k,{class:"btn",type:"primary",block:"",onClick:r},{default:x(()=>[b(e(s.$t("confirmAndLock")),1)]),_:1})])])]),_:1},8,["show"]),v(oo,{show:B.value,"onUpdate:show":i[3]||(i[3]=f=>B.value=f),txHash:G.value,onClose:N},null,8,["show","txHash"])],64)}}},zo=z(Co,[["__scopeId","data-v-6c7c7f08"]]);const Io={class:"ave-popup"},Vo={class:"title"},Do={class:"body"},Ao={class:"info"},To={class:"key"},Bo={class:"value"},Fo={key:0,class:"token"},Uo={key:1,class:"token"},Eo={class:"key"},Go={class:"value"},No={class:"key"},Po={class:"value"},Ho={class:"key"},Mo={class:"value"},xo={__name:"UnlockPopup",props:{show:Boolean,lockId:String,isLockV2:Boolean,isLpToken:Boolean,unlockDate:Number,tokenList:Array,symbol:String,address:String,chainCoinSymbol:String,amountString:String,chain:String,decimals:Number},emits:["update:show","success"],setup(A,{emit:h}){const o=A,{t:I}=Z(),S=J(),w=W(),t=p(0n),_=p(0),u=p(!1),V=p("");async function T(){const l=await d.wallet.getGasPrice(),n=await d.wallet.getBalance(S.walletAddress);console.log("balance",n);let r;if(o.isLockV2){const g=await d.wallet.contractTokenLockV2(w.tokenLockV2Address);if(t.value=await g.withdrawFee(),n<t.value){L(I("balanceSlow2",{chainMianCoin:S.chainCoinSymbol,amount:E(t.value)})),h("update:show",!1);return}r=await g.unlock.estimateGas(o.lockId,{value:t.value})}else{const g=await d.wallet.contractTokenLockV3(w.tokenLockV3Address);if(t.value=await g.withdrawFee(),n<t.value){L(I("balanceSlow2",{chainMianCoin:S.chainCoinSymbol,amount:E(t.value)})),h("update:show",!1);return}r=await g.unlock.estimateGas(o.lockId,{value:t.value})}console.dir(r),_.value=E(r*l).toString(),console.log(_.value)}async function B(){const l=Y({message:"Loading...",forbidClick:!0,duration:0});if(o.isLockV2)try{const n=await d.wallet.contractTokenLockV2(w.tokenLockV2Address);t.value=await n.withdrawFee();let r=await n.unlock(o.lockId,{value:t.value});console.dir(r),V.value=r.hash,u.value=!0}catch(n){console.log(n)}finally{l.close()}else try{const n=await d.wallet.contractTokenLockV3(w.tokenLockV3Address);t.value=await n.withdrawFee();let r=await n.unlock(o.lockId,{value:t.value});console.dir(r),V.value=r.hash,u.value=!0}catch(n){console.log(n)}finally{l.close()}}async function G(){const l=Y({message:"Loading...",forbidClick:!0,duration:0});await T(),l.close()}K(()=>o.show,(l,n)=>{l&&G()});function R(){h("update:show",!1),h("success")}return(l,n)=>{const r=P("van-button"),g=P("van-popup");return $(),C(X,null,[v(g,{show:A.show,"onUpdate:show":n[0]||(n[0]=N=>{h("update:show",N)}),round:"",closeable:"",position:"bottom"},{default:x(()=>[a("div",Io,[a("div",Vo,e(l.$t("withdraw")),1),a("div",Do,[a("ul",Ao,[a("li",null,[a("div",To,e(l.$t("withdrawAssets")),1),a("div",Bo,[o.isLpToken?($(),C("div",Fo,[v(F,{class:"token-icon",tokenIcon:c(U)(o.chain,o.tokenList[0].address)},null,8,["tokenIcon"]),v(F,{class:"token-icon",tokenIcon:c(U)(o.chain,o.tokenList[1].address)},null,8,["tokenIcon"]),b(" "+e(`${o.symbol} (${c(O)(o.address)})`),1)])):($(),C("div",Uo,[v(F,{class:"token-icon",tokenIcon:c(U)(o.chain,o.address),chainIcon:c(Q)(o.chain)},null,8,["tokenIcon","chainIcon"]),b(" "+e(`${o.symbol} (${c(O)(o.address)})`),1)]))])]),a("li",null,[a("div",Eo,e(l.$t("withdrawNumber")),1),a("div",Go,[a("span",null,e(l.$t("toBeWithdrawNumber")+": "),1),b(e(A.amountString),1)])]),a("li",null,[a("div",No,e(l.$t("withdrawFee")),1),a("div",Po,e(`${t.value?c(ao).formatEther(t.value):"--"} ${o.chainCoinSymbol}`),1)]),a("li",null,[a("div",Ho,e(l.$t("gas")),1),a("div",Mo,e(`${_.value?_.value:"--"} ${o.chainCoinSymbol}`),1)])]),v(r,{class:"btn",type:"primary",block:"",onClick:B},{default:x(()=>[b(e(l.$t("withdraw")),1)]),_:1})])])]),_:1},8,["show"]),v(oo,{show:u.value,"onUpdate:show":n[1]||(n[1]=N=>u.value=N),txHash:V.value,onClose:R},null,8,["show","txHash"])],64)}}},Jo=z(xo,[["__scopeId","data-v-a8c33234"]]);export{zo as E,Jo as U};
