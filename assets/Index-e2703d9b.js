import{D as M}from"./Dialog-a3d10ac1.js";import{u as P,f as $,d as R,e as D,g as C,E as H,G as U,r as v,o as K,c as O,a as y,l as I,j as V,s as o,H as N,n as w,b as p,t as k,k as G,A as J,D as j,I as m,p as X,J as q}from"./index-25ac7233.js";import{u as z}from"./create-f963dd4c.js";import{B as i}from"./bignumber-3e8dfdf6.js";/* empty css                                                       */const Q={class:"create"},Y=p("div",{class:"van-dialog__header"},null,-1),Z={class:"van-dialog__content"},ee={class:"van-dialog__message van-dialog__message--has-title"},ae=p("div",{style:{paddingTop:"20px"}},null,-1),te={class:"create-success-title"},ne={class:"create-success-text"},se={class:"create-success-text"},de={__name:"Index",setup(oe){const{t:n}=P(),T=$(),u=R(),L=D(),e=z(),S=C(!1),_=C(!1),g=C(!1),x=C(!1);H(()=>e.deployerId,t=>{const l=j.createToken.chainList.find(a=>a.chain==u.chain);if(!l){e.baseFee=-1;return}console.dir(l);const r=l.deployerList.find(a=>a.deployerId==e.deployerId);if(!r){e.baseFee=-1;return}e.baseFee=r.baseFee});async function B(){console.log("createTokenClick");const t=/^0x[0-9a-fA-F]{40}(,\d*\.?\d+)?$/;if(u.chainId==-1){u.netErrorDialogShow=!0;return}if(e.deployerId===0||e.deployerId===1||e.deployerId===2){if(!e.name){o(n("pleaseEnterName"));return}if(!e.symbol){o(n("pleaseEnterSymbol"));return}if(!e.totalSupply){o(n("pleaseEnterTotal"));return}if(!e.decimals){o(n("pleaseEnterDecimals"));return}}if(e.deployerId===1||e.deployerId==2){if(!e.token){o(n("pleaseSelectCurrency"));return}if(!e.chainSwap){o(n("pleaseSelectSwap"));return}if(e.deployerId===1){if(i(e.buyFundFee).plus(e.buyBurnFee).plus(e.buyLPFee).plus(e.sellFundFee).plus(e.sellBurnFee).plus(e.sellLPFee).lte(0)){o(n("taxMustGt0"));return}}else if(e.deployerId===2){if(i(e.buyFundFee).plus(e.buyLPFee).plus(e.sellFundFee).plus(e.sellLPFee).lte(0)){o(n("taxlimit2"));return}}else if(e.deployerId===3){if(!e.rewardToken){o(n("dividendTokenError"));return}if(!t.test(e.rewardToken)){o(n("pleaseEnterTrueAddress"));return}if(i(e.buyFundFee).plus(e.buyLPFee).plus(e.buyRewardFee).plus(e.sellFundFee).plus(e.sellLPFee).plus(e.sellRewardFee).lte(0)){o(n("taxMustGt0"));return}}if((Number(e.buyFundFee)>0||Number(e.sellFundFee)>0)&&!e.fundAddress){o(n("pleaseEnterMarketingAddress"));return}if(e.fundAddress&&!t.test(e.fundAddress)){o(n("pleaseEnterTrueAddress"));return}if(e.enableKillBlock&&(!e.killBlock||Number(e.killBlock)<=0)){o(n("pleaseEnterKillBlockNumber"));return}if(e.enableWalletLimit&&(!e.maxWalletAmount||Number(e.maxWalletAmount)<=0)){o(n("pleaseEnterMaxWalletLimit"));return}if(e.enableSwapLimit&&(!e.maxSwapAmount||Number(e.maxSwapAmount)<=0)){o(n("pleaseEnterMaxSwapLimit"));return}}if(g.value=!0,e.baseFee<0)return;const l=N(e.baseFee.toString()),r=await w.wallet.getBalance(u.walletAddress);if(console.log("balance",r),r<l){o(n("balanceSlow2",{chainMianCoin:u.chainCoinSymbol,amount:e.baseFee})),g.value=!1;return}S.value=!0,g.value=!1}async function E(){x.value=!0;try{const t=await w.wallet.contractTokenFactory(L.tokenFactoryAddress),l=[],r=[],a=[],s=[];if(e.deployerId==0)l[0]=e.name,l[1]=e.symbol,a[0]=parseInt(e.decimals),a[1]=m(e.totalSupply,parseInt(e.decimals)),s[0]=e.canMint;else if(e.deployerId==1){l[0]=e.name,l[1]=e.symbol;let c=e.token.tokenAddress,d=!1;c==="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"&&(c=(await(await w.wallet.contractSwap(e.chainSwap.routerAddress)).WETH()).toLowerCase(),d=!0),r[0]=c,r[1]=e.chainSwap.routerAddress,r[2]=u.walletAddress,r[3]=e.fundAddress?e.fundAddress:"0x0000000000000000000000000000000000000000",a[0]=parseInt(e.decimals),a[1]=m(e.totalSupply,parseInt(e.decimals)),a[2]=i(e.buyFundFee).times(100).toNumber(),a[3]=i(e.buyBurnFee).times(100).toNumber(),a[4]=i(e.buyLPFee).times(100).toNumber(),a[5]=i(e.sellFundFee).times(100).toNumber(),a[6]=i(e.sellBurnFee).times(100).toNumber(),a[7]=i(e.sellLPFee).times(100).toNumber(),a[8]=e.killBlock?i(e.killBlock).toNumber():0,a[9]=e.maxSwapAmount?m(e.maxSwapAmount,parseInt(e.decimals)):0n,a[10]=e.maxWalletAmount?m(e.maxWalletAmount,parseInt(e.decimals)):0n,s[0]=e.canMint,s[1]=d,s[2]=e.enableManualStartTrade,s[3]=e.enableKillBlock,s[4]=e.enableSwapLimit,s[5]=e.enableWalletLimit,s[6]=e.enableChangeTax,s[7]=e.enableWhiteList}else if(e.deployerId==2){l[0]=e.name,l[1]=e.symbol;let c=e.token.tokenAddress,d=!1;c==="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"&&(c=(await(await w.wallet.contractSwap(e.chainSwap.routerAddress)).WETH()).toLowerCase(),d=!0),r[0]=c,r[1]=e.chainSwap.routerAddress,r[2]=u.walletAddress,r[3]=e.fundAddress?e.fundAddress:"0x0000000000000000000000000000000000000000",a[0]=parseInt(e.decimals),a[1]=m(e.totalSupply,parseInt(e.decimals)),a[2]=i(e.buyFundFee).times(100).toNumber(),a[3]=i(e.buyRewardFee).times(100).toNumber(),a[4]=i(e.buyLPFee).times(100).toNumber(),a[5]=i(e.sellFundFee).times(100).toNumber(),a[6]=i(e.sellRewardFee).times(100).toNumber(),a[7]=i(e.sellLPFee).times(100).toNumber(),a[8]=e.killBlock?i(e.killBlock).toNumber():0,a[9]=e.maxSwapAmount?m(e.maxSwapAmount,parseInt(e.decimals)):0n,a[10]=e.maxWalletAmount?m(e.maxWalletAmount,parseInt(e.decimals)):0n,s[0]=d,s[1]=e.enableManualStartTrade,s[2]=e.enableKillBlock,s[3]=e.enableSwapLimit,s[4]=e.enableWalletLimit,s[5]=e.enableChangeTax,s[6]=e.enableWhiteList}else if(e.deployerId==3){l[0]=e.name,l[1]=e.symbol;let c=e.token.tokenAddress,d=!1;c==="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"&&(c=(await(await w.wallet.contractSwap(e.chainSwap.routerAddress)).WETH()).toLowerCase(),d=!0),r[0]=c,r[1]=e.chainSwap.routerAddress,r[2]=u.walletAddress,r[3]=e.fundAddress?e.fundAddress:"0x0000000000000000000000000000000000000000",r[4]=e.rewardToken,a[0]=parseInt(e.decimals),a[1]=m(e.totalSupply,parseInt(e.decimals)),a[2]=i(e.buyFundFee).times(100).toNumber(),a[3]=i(e.buyRewardFee).times(100).toNumber(),a[4]=i(e.buyLPFee).times(100).toNumber(),a[5]=i(e.sellFundFee).times(100).toNumber(),a[6]=i(e.sellRewardFee).times(100).toNumber(),a[7]=i(e.sellLPFee).times(100).toNumber(),a[8]=e.killBlock?i(e.killBlock).toNumber():0,a[9]=e.maxSwapAmount?m(e.maxSwapAmount,parseInt(e.decimals)):0n,a[10]=e.maxWalletAmount?m(e.maxWalletAmount,parseInt(e.decimals)):0n,s[0]=d,s[1]=e.enableManualStartTrade,s[2]=e.enableKillBlock,s[3]=e.enableSwapLimit,s[4]=e.enableWalletLimit,s[5]=e.enableChangeTax,s[6]=e.enableWhiteList,s[7]=e.canMint}console.log(e.deployerId,l,r,a,s);const A=N(e.baseFee.toString()),f=await t.tokenCreate(e.deployerId,l,r,a,s,{value:A});console.dir(f),e.txHash=f.hash;let h;u.chain=="core"&&(h=X({duration:0,forbidClick:!0,message:n("upChainNow")})),f.wait().then(async c=>{if(console.log("upChainSuccessfully"),console.log(c),c.status===1&&(o({type:"success",message:n("upChainSuccessfully")}),u.chain=="core")){h&&(h.message=n("verityContractNow")),console.log(c.logs);const d=c.logs.find(b=>b.fragment&&b.fragment.name=="TokenCreated");console.log(d);const F=d.args[1];console.log(F);try{const b=await w.coredao.verifysourcecode(e.deployerId,l,r,a,s,F);await w.coredao.checkverifystatus(b),o({type:"success",message:n("verityContractSuccess")})}catch{o(n("verityContractFail"))}finally{h&&h.close()}}}),_.value=!0}catch(t){if(console.log(JSON.stringify(t)),t.info&&t.info.error&&t.info.error.code===4001)o(n("userCancelOperate"));else if(t.error&&t.error.message&&t.error.message=="Canceled")o(n("userCancelOperate"));else if(t.data&&t.data.code==-32e3){const l=t.data.message.match(/(\d+) want (\d+)/)[2];o(n("balanceSlow2",{chainMianCoin:lmStore.token.chainCoinSymbol,amount:q(l)}))}else t.code==="INSUFFICIENT_FUNDS"?o(n("balanceSlow")):t.info&&t.info.error&&t.info.error.code==-32603&&t.info.error.data.message.endsWith("transfer amount exceeds balance")?o(n("balanceSlow2",{chainMianCoin:u.chainCoinSymbol,amount:e.baseFee})):t.code=="CALL_EXCEPTION"&&t.info.error.message.endsWith("transfer amount exceeds balance")?o(n("balanceSlow2",{chainMianCoin:u.chainCoinSymbol,amount:e.baseFee})):o(n("unkonwError"))}finally{S.value=!1,x.value=!1}}function W(){window.open(u.txBlockExplorerUrl+e.txHash,"_blank")}return e.init(),U(()=>{console.log("create before mounted"),e.token&&e.token.chain!=u.chain&&(e.token=null),e.chainSwap&&e.chainSwap.chain!=u.chain&&(e.chainSwap=null)}),(t,l)=>{const r=v("router-view"),a=v("van-action-bar-button"),s=v("van-action-bar"),A=v("van-popup");return K(),O("div",Q,[y(r,{onCreateTokenClick:B,createTokenLoading:g.value},null,8,["createTokenLoading"]),y(A,{show:S.value,"onUpdate:show":l[0]||(l[0]=f=>S.value=f),round:"",closeable:"",class:"van-dialog van-dialog--round-button","close-on-click-overlay":!1},{default:I(()=>[Y,p("div",Z,[p("div",ee,[p("div",null,k(t.$t("createConfirmInfo")),1),ae])]),y(s,{class:"van-dialog__footer"},{default:I(()=>[y(a,{type:"danger",loading:x.value,color:"#3F80F7",text:t.$t("confirmAndCreate"),class:"van-dialog__confirm",onClick:E},null,8,["loading","text"])]),_:1})]),_:1},8,["show"]),y(M,{show:_.value,"onUpdate:show":l[1]||(l[1]=f=>_.value=f),theme:"round-button",showCancelButton:!1,confirmButtonText:t.$t("enterTokenManagement"),onOnConfirm:l[2]||(l[2]=f=>V(T).push("/createToken"))},{default:I(()=>[p("div",null,[y(G,{name:"createSuccess",style:{width:"48px",height:"48px"}})]),p("div",te,k(t.$t("createdSubmitted")),1),p("div",ne,[J(k(t.$t("inBrowser")),1),p("span",{class:"show",onClick:W},k(t.$t("view")),1)]),p("div",se,k(t.$t("waitToView")),1)]),_:1},8,["show","confirmButtonText"])])}}};export{de as default};
