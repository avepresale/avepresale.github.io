import{D as P}from"./Dialog-4990feff.js";import{u as M,f as R,d as $,e as H,g as C,G as D,H as U,r as v,o as K,c as O,a as y,l as _,j as V,s as i,n as w,b as p,t as k,k as G,A as j,D as J,p as X,I as q}from"./index-be4bd9f5.js";import{u as z}from"./create-bb5296b1.js";import{B as s}from"./bignumber-3e8dfdf6.js";import{p as I,a as d,f as Q}from"./units-c9e15f7d.js";/* empty css                                                       */const Y={class:"create"},Z=p("div",{class:"van-dialog__header"},null,-1),ee={class:"van-dialog__content"},ae={class:"van-dialog__message van-dialog__message--has-title"},te=p("div",{style:{paddingTop:"20px"}},null,-1),se={class:"create-success-title"},ne={class:"create-success-text"},oe={class:"create-success-text"},pe={__name:"Index",setup(le){const{t:o}=M(),L=R(),c=$(),T=H(),e=z(),S=C(!1),x=C(!1),g=C(!1),A=C(!1);D(()=>e.deployerId,n=>{const l=J.createToken.chainList.find(a=>a.chain==c.chain);if(!l){e.baseFee=-1;return}console.dir(l);const r=l.deployerList.find(a=>a.deployerId==e.deployerId);if(!r){e.baseFee=-1;return}e.baseFee=r.baseFee});async function B(){console.log("createTokenClick");const n=/^0x[0-9a-fA-F]{40}(,\d*\.?\d+)?$/;if(c.chainId==-1){c.netErrorDialogShow=!0;return}if(e.deployerId===0||e.deployerId===1||e.deployerId===2){if(!e.name){i(o("pleaseEnterName"));return}if(!e.symbol){i(o("pleaseEnterSymbol"));return}if(!e.totalSupply){i(o("pleaseEnterTotal"));return}if(!e.decimals){i(o("pleaseEnterDecimals"));return}}if(e.deployerId===1||e.deployerId==2){if(!e.token){i(o("pleaseSelectCurrency"));return}if(!e.chainSwap){i(o("pleaseSelectSwap"));return}if(e.deployerId===1){if(s(e.buyFundFee).plus(e.buyBurnFee).plus(e.buyLPFee).plus(e.sellFundFee).plus(e.sellBurnFee).plus(e.sellLPFee).lte(0)){i(o("taxMustGt0"));return}}else if(e.deployerId===2){if(s(e.buyFundFee).plus(e.buyLPFee).plus(e.sellFundFee).plus(e.sellLPFee).lte(0)){i(o("taxlimit2"));return}}else if(e.deployerId===3){if(!e.rewardToken){i(o("dividendTokenError"));return}if(!n.test(e.rewardToken)){i(o("pleaseEnterTrueAddress"));return}if(s(e.buyFundFee).plus(e.buyLPFee).plus(e.buyRewardFee).plus(e.sellFundFee).plus(e.sellLPFee).plus(e.sellRewardFee).lte(0)){i(o("taxMustGt0"));return}}if((Number(e.buyFundFee)>0||Number(e.sellFundFee)>0)&&!e.fundAddress){i(o("pleaseEnterMarketingAddress"));return}if(e.fundAddress&&!n.test(e.fundAddress)){i(o("pleaseEnterTrueAddress"));return}if(e.enableKillBlock&&(!e.killBlock||Number(e.killBlock)<=0)){i(o("pleaseEnterKillBlockNumber"));return}if(e.enableWalletLimit&&(!e.maxWalletAmount||Number(e.maxWalletAmount)<=0)){i(o("pleaseEnterMaxWalletLimit"));return}if(e.enableSwapLimit&&(!e.maxSwapAmount||Number(e.maxSwapAmount)<=0)){i(o("pleaseEnterMaxSwapLimit"));return}}if(g.value=!0,e.baseFee<0)return;const l=I(e.baseFee.toString()),r=await w.wallet.getBalance(c.walletAddress);if(console.log("balance",r),r<l){i(o("balanceSlow2",{chainMianCoin:c.chainCoinSymbol,amount:e.baseFee})),g.value=!1;return}S.value=!0,g.value=!1}async function E(){A.value=!0;try{const n=await w.wallet.contractTokenFactory(T.tokenFactoryAddress),l=[],r=[],a=[],t=[];if(e.deployerId==0)l[0]=e.name,l[1]=e.symbol,a[0]=parseInt(e.decimals),a[1]=d(e.totalSupply,parseInt(e.decimals)),t[0]=e.canMint;else if(e.deployerId==1){l[0]=e.name,l[1]=e.symbol;let u=e.token.tokenAddress,m=!1;u==="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"&&(u=(await(await w.wallet.contractSwap(e.chainSwap.routerAddress)).WETH()).toLowerCase(),m=!0),r[0]=u,r[1]=e.chainSwap.routerAddress,r[2]=c.walletAddress,r[3]=e.fundAddress?e.fundAddress:"0x0000000000000000000000000000000000000000",a[0]=parseInt(e.decimals),a[1]=d(e.totalSupply,parseInt(e.decimals)),a[2]=s(e.buyFundFee).times(100).toNumber(),a[3]=s(e.buyBurnFee).times(100).toNumber(),a[4]=s(e.buyLPFee).times(100).toNumber(),a[5]=s(e.sellFundFee).times(100).toNumber(),a[6]=s(e.sellBurnFee).times(100).toNumber(),a[7]=s(e.sellLPFee).times(100).toNumber(),a[8]=e.killBlock?s(e.killBlock).toNumber():0,a[9]=e.maxSwapAmount?d(e.maxSwapAmount,parseInt(e.decimals)):0n,a[10]=e.maxWalletAmount?d(e.maxWalletAmount,parseInt(e.decimals)):0n,t[0]=e.canMint,t[1]=m,t[2]=e.enableManualStartTrade,t[3]=e.enableKillBlock,t[4]=e.enableSwapLimit,t[5]=e.enableWalletLimit,t[6]=e.enableChangeTax,t[7]=e.enableWhiteList}else if(e.deployerId==2){l[0]=e.name,l[1]=e.symbol;let u=e.token.tokenAddress,m=!1;u==="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"&&(u=(await(await w.wallet.contractSwap(e.chainSwap.routerAddress)).WETH()).toLowerCase(),m=!0),r[0]=u,r[1]=e.chainSwap.routerAddress,r[2]=c.walletAddress,r[3]=e.fundAddress?e.fundAddress:"0x0000000000000000000000000000000000000000",a[0]=parseInt(e.decimals),a[1]=d(e.totalSupply,parseInt(e.decimals)),a[2]=s(e.buyFundFee).times(100).toNumber(),a[3]=s(e.buyRewardFee).times(100).toNumber(),a[4]=s(e.buyLPFee).times(100).toNumber(),a[5]=s(e.sellFundFee).times(100).toNumber(),a[6]=s(e.sellRewardFee).times(100).toNumber(),a[7]=s(e.sellLPFee).times(100).toNumber(),a[8]=e.killBlock?s(e.killBlock).toNumber():0,a[9]=e.maxSwapAmount?d(e.maxSwapAmount,parseInt(e.decimals)):0n,a[10]=e.maxWalletAmount?d(e.maxWalletAmount,parseInt(e.decimals)):0n,t[0]=m,t[1]=e.enableManualStartTrade,t[2]=e.enableKillBlock,t[3]=e.enableSwapLimit,t[4]=e.enableWalletLimit,t[5]=e.enableChangeTax,t[6]=e.enableWhiteList}else if(e.deployerId==3){l[0]=e.name,l[1]=e.symbol;let u=e.token.tokenAddress,m=!1;u==="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"&&(u=(await(await w.wallet.contractSwap(e.chainSwap.routerAddress)).WETH()).toLowerCase(),m=!0),r[0]=u,r[1]=e.chainSwap.routerAddress,r[2]=c.walletAddress,r[3]=e.fundAddress?e.fundAddress:"0x0000000000000000000000000000000000000000",r[4]=e.rewardToken,a[0]=parseInt(e.decimals),a[1]=d(e.totalSupply,parseInt(e.decimals)),a[2]=s(e.buyFundFee).times(100).toNumber(),a[3]=s(e.buyRewardFee).times(100).toNumber(),a[4]=s(e.buyLPFee).times(100).toNumber(),a[5]=s(e.sellFundFee).times(100).toNumber(),a[6]=s(e.sellRewardFee).times(100).toNumber(),a[7]=s(e.sellLPFee).times(100).toNumber(),a[8]=e.killBlock?s(e.killBlock).toNumber():0,a[9]=e.maxSwapAmount?d(e.maxSwapAmount,parseInt(e.decimals)):0n,a[10]=e.maxWalletAmount?d(e.maxWalletAmount,parseInt(e.decimals)):0n,t[0]=m,t[1]=e.enableManualStartTrade,t[2]=e.enableKillBlock,t[3]=e.enableSwapLimit,t[4]=e.enableWalletLimit,t[5]=e.enableChangeTax,t[6]=e.enableWhiteList,t[7]=e.canMint}else e.deployerId==4&&(l[0]=e.name,l[1]=e.symbol,r[0]=e.fundAddress?e.fundAddress:"0x0000000000000000000000000000000000000000",r[1]=e.rewardToken,r[2]=e.chainSwap.routerAddress,a[0]=e.maxSwapAmount?d(e.maxSwapAmount,parseInt(e.decimals)):0n,a[1]=e.maxWalletAmount?d(e.maxWalletAmount,parseInt(e.decimals)):0n,a[2]=s(e.buyFundFee).times(100).toNumber(),a[3]=s(e.buyLPFee).times(100).toNumber(),a[4]=s(e.buyRewardFee).times(100).toNumber(),a[5]=s(e.buyBurnFee).times(100).toNumber(),a[6]=s(e.sellFundFee).times(100).toNumber(),a[7]=s(e.sellLPFee).times(100).toNumber(),a[8]=s(e.sellRewardFee).times(100).toNumber(),a[9]=s(e.sellBurnFee).times(100).toNumber(),a[10]=d(e.totalSupply,parseInt(e.decimals)),a[11]=e.mustHoldNum?d(e.mustHoldNum,parseInt(e.decimals)):0n,a[12]=e.killBlock?s(e.killBlock).toNumber():0,t[0]=e.enableManualStartTrade,t[1]=e.enableKillBlock,t[2]=e.enableSwapLimit,t[3]=e.enableWalletLimit,t[4]=e.enableChangeTax,t[5]=e.enableWhiteList);console.log(e.deployerId,l,r,a,t);const N=I(e.baseFee.toString()),b=await n.tokenCreate(e.deployerId,l,r,a,t,{value:N});console.dir(b),e.txHash=b.hash;let h;c.chain=="core"&&e.deployerId!=4&&(h=X({duration:0,forbidClick:!0,message:o("upChainNow")})),b.wait().then(async u=>{if(console.log("upChainSuccessfully"),console.log(u),u.status===1&&(i({type:"success",message:o("upChainSuccessfully")}),c.chain=="core"&&e.deployerId!=4)){h&&(h.message=o("verityContractNow")),console.log(u.logs);const m=u.logs.find(f=>f.fragment&&f.fragment.name=="TokenCreated");console.log(m);const F=m.args[1];console.log(F);try{const f=await w.coredao.verifysourcecode(e.deployerId,l,r,a,t,F);await q(500),await w.coredao.checkverifystatus(f),i({type:"success",message:o("verityContractSuccess")})}catch{i(o("verityContractFail"))}finally{h&&h.close()}}}),x.value=!0}catch(n){if(console.log(JSON.stringify(n)),n.info&&n.info.error&&n.info.error.code===4001)i(o("userCancelOperate"));else if(n.error&&n.error.message&&n.error.message=="Canceled")i(o("userCancelOperate"));else if(n.data&&n.data.code==-32e3){const l=n.data.message.match(/(\d+) want (\d+)/)[2];i(o("balanceSlow2",{chainMianCoin:lmStore.token.chainCoinSymbol,amount:Q(l)}))}else n.code==="INSUFFICIENT_FUNDS"?i(o("balanceSlow")):n.info&&n.info.error&&n.info.error.code==-32603&&n.info.error.data.message.endsWith("transfer amount exceeds balance")?i(o("balanceSlow2",{chainMianCoin:c.chainCoinSymbol,amount:e.baseFee})):n.code=="CALL_EXCEPTION"&&n.info.error.message.endsWith("transfer amount exceeds balance")?i(o("balanceSlow2",{chainMianCoin:c.chainCoinSymbol,amount:e.baseFee})):i(o("unkonwError"))}finally{S.value=!1,A.value=!1}}function W(){window.open(c.txBlockExplorerUrl+e.txHash,"_blank")}return e.init(),U(()=>{console.log("create before mounted"),e.token&&e.token.chain!=c.chain&&(e.token=null),e.chainSwap&&e.chainSwap.chain!=c.chain&&(e.chainSwap=null)}),(n,l)=>{const r=v("router-view"),a=v("van-action-bar-button"),t=v("van-action-bar"),N=v("van-popup");return K(),O("div",Y,[y(r,{onCreateTokenClick:B,createTokenLoading:g.value},null,8,["createTokenLoading"]),y(N,{show:S.value,"onUpdate:show":l[0]||(l[0]=b=>S.value=b),round:"",closeable:"",class:"van-dialog van-dialog--round-button","close-on-click-overlay":!1},{default:_(()=>[Z,p("div",ee,[p("div",ae,[p("div",null,k(n.$t("createConfirmInfo")),1),te])]),y(t,{class:"van-dialog__footer"},{default:_(()=>[y(a,{type:"danger",loading:A.value,color:"#3F80F7",text:n.$t("confirmAndCreate"),class:"van-dialog__confirm",onClick:E},null,8,["loading","text"])]),_:1})]),_:1},8,["show"]),y(P,{show:x.value,"onUpdate:show":l[1]||(l[1]=b=>x.value=b),theme:"round-button",showCancelButton:!1,confirmButtonText:n.$t("enterTokenManagement"),onOnConfirm:l[2]||(l[2]=b=>V(L).push("/createToken"))},{default:_(()=>[p("div",null,[y(G,{name:"createSuccess",style:{width:"48px",height:"48px"}})]),p("div",se,k(n.$t("createdSubmitted")),1),p("div",ne,[j(k(n.$t("inBrowser")),1),p("span",{class:"show",onClick:W},k(n.$t("view")),1)]),p("div",oe,k(n.$t("waitToView")),1)]),_:1},8,["show","confirmButtonText"])])}}};export{pe as default};
