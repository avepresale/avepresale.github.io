import{D}from"./Dialog-f4cdcdc2.js";import{u as O,f as H,d as K,e as V,g as f,D as G,r as _,o as L,c as j,a as C,l as B,j as J,s as n,n as b,E as I,b as d,t as y,m as W,k as X,A as q,M as z,G as m}from"./index-1733633f.js";import{u as Q}from"./create-2a77ee86.js";import{B as r}from"./bignumber-3e8dfdf6.js";/* empty css                                                       */const Y={class:"create"},Z={class:"van-dialog__header"},ee={class:"van-dialog__content"},ae={class:"van-dialog__message van-dialog__message--has-title"},te={style:{paddingTop:"20px"}},se={class:"create-success-title"},oe={class:"create-success-text"},ne={class:"create-success-text"},me={__name:"Index",setup(le){const{t:o}=O(),M=H(),p=K(),v=V(),e=Q(),S=f(!1),x=f(!1),g=f(!1),T=f(!1),A=f(!1),N=f(!1),h=f(""),F=f("");async function P(){T.value=!0;try{let l=await(await b.wallet.contractTokenFactory(v.tokenFactoryAddress)).baseFeeToken();console.log("baseFeeTokenAddress",l),(await(await(await b.wallet.contractERC20(l)).approve(v.tokenFactoryAddress,z)).wait()).status===1&&(n({type:"success",message:o("upChainSuccessfully")}),g.value=!1)}catch(t){console.log(t),t.info&&t.info.error&&t.info.error.code===4001?n(o("userCancelOperate")):t.error&&t.error.message&&t.error.message=="Canceled"?n(o("userCancelOperate")):n(o("unkonwError"))}finally{T.value=!1}}async function $(){console.log("createTokenClick");const t=/^0x[0-9a-fA-F]{40}(,\d*\.?\d+)?$/;if(p.chainId==-1){p.netErrorDialogShow=!0;return}if(e.deployerId===0||e.deployerId===1||e.deployerId===2){if(!e.name){n(o("pleaseEnterName"));return}if(!e.symbol){n(o("pleaseEnterSymbol"));return}if(!e.totalSupply){n(o("pleaseEnterTotal"));return}}if(e.deployerId===1||e.deployerId==2){if(!e.token){n(o("pleaseSelectCurrency"));return}if(!e.chainSwap){n(o("pleaseSelectSwap"));return}if(e.deployerId===1){if(r(e.buyFundFee).plus(e.buyBurnFee).plus(e.buyLPFee).plus(e.sellFundFee).plus(e.sellBurnFee).plus(e.sellLPFee).lte(0)){n(o("taxMustGt0"));return}}else if(e.deployerId===2){if(r(e.buyFundFee).plus(e.buyLPFee).plus(e.sellFundFee).plus(e.sellLPFee).lte(0)){n(o("taxlimit2"));return}}else if(e.deployerId===3){if(!e.rewardToken){n(o("dividendTokenError"));return}if(!t.test(e.rewardToken)){n(o("pleaseEnterTrueAddress"));return}if(r(e.buyFundFee).plus(e.buyLPFee).plus(e.buyRewardFee).plus(e.sellFundFee).plus(e.sellLPFee).plus(e.sellRewardFee).lte(0)){n(o("taxMustGt0"));return}}if((Number(e.buyFundFee)>0||Number(e.sellFundFee)>0)&&!e.fundAddress){n(o("pleaseEnterMarketingAddress"));return}if(e.fundAddress&&!t.test(e.fundAddress)){n(o("pleaseEnterTrueAddress"));return}if(e.enableKillBlock&&(!e.killBlock||Number(e.killBlock)<=0)){n(o("pleaseEnterKillBlockNumber"));return}if(e.enableWalletLimit&&(!e.maxWalletAmount||Number(e.maxWalletAmount)<=0)){n(o("pleaseEnterMaxWalletLimit"));return}if(e.enableSwapLimit&&(!e.maxSwapAmount||Number(e.maxSwapAmount)<=0)){n(o("pleaseEnterMaxSwapLimit"));return}}A.value=!0;const l=await b.wallet.contractTokenFactory(v.tokenFactoryAddress);let i=await l.baseFee();console.log("baseFee",i);let a=await l.baseFeeToken();console.log("baseFeeTokenAddress",a);const s=await b.wallet.contractERC20(a),w=await s.decimals();if(a.toLowerCase()==="0x9ebab27608bd64aff36f027049aecc69102a0d1e")F.value="USDT-lfgbridge";else{let k=await s.symbol();F.value=k.toUpperCase()}h.value=I(i,w);const c=await s.balanceOf(p.walletAddress);if(console.log("baseFeeTokenBalance",c),c<i){n(o("balanceSlow2",{chainMianCoin:F.value,amount:h.value})),A.value=!1;return}const u=await s.allowance(p.walletAddress,v.tokenFactoryAddress);console.log("allowance",u),u<i?g.value=!0:g.value=!1,S.value=!0,A.value=!1}async function R(){N.value=!0;try{const t=await b.wallet.contractTokenFactory(v.tokenFactoryAddress),l=[],i=[],a=[],s=[];if(e.deployerId==0)l[0]=e.name,l[1]=e.symbol,a[0]=e.decimals,a[1]=m(e.totalSupply,e.decimals),s[0]=e.canMint;else if(e.deployerId==1){l[0]=e.name,l[1]=e.symbol;let c=e.token.tokenAddress,u=!1;c==="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"&&(c=(await(await b.wallet.contractSwap(e.chainSwap.routerAddress)).WETH()).toLowerCase(),u=!0),i[0]=c,i[1]=e.chainSwap.routerAddress,i[2]=p.walletAddress,i[3]=e.fundAddress?e.fundAddress:"0x0000000000000000000000000000000000000000",a[0]=e.decimals,a[1]=m(e.totalSupply,e.decimals),a[2]=r(e.buyFundFee).times(100).toNumber(),a[3]=r(e.buyBurnFee).times(100).toNumber(),a[4]=r(e.buyLPFee).times(100).toNumber(),a[5]=r(e.sellFundFee).times(100).toNumber(),a[6]=r(e.sellBurnFee).times(100).toNumber(),a[7]=r(e.sellLPFee).times(100).toNumber(),a[8]=e.killBlock?r(e.killBlock).toNumber():0,a[9]=e.maxSwapAmount?m(e.maxSwapAmount,e.decimals):0n,a[10]=e.maxWalletAmount?m(e.maxWalletAmount,e.decimals):0n,s[0]=e.canMint,s[1]=u,s[2]=e.enableManualStartTrade,s[3]=e.enableKillBlock,s[4]=e.enableSwapLimit,s[5]=e.enableWalletLimit,s[6]=e.enableChangeTax,s[7]=e.enableWhiteList}else if(e.deployerId==2){l[0]=e.name,l[1]=e.symbol;let c=e.token.tokenAddress,u=!1;c==="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"&&(c=(await(await b.wallet.contractSwap(e.chainSwap.routerAddress)).WETH()).toLowerCase(),u=!0),i[0]=c,i[1]=e.chainSwap.routerAddress,i[2]=p.walletAddress,i[3]=e.fundAddress?e.fundAddress:"0x0000000000000000000000000000000000000000",a[0]=e.decimals,a[1]=m(e.totalSupply,e.decimals),a[2]=r(e.buyFundFee).times(100).toNumber(),a[3]=r(e.buyRewardFee).times(100).toNumber(),a[4]=r(e.buyLPFee).times(100).toNumber(),a[5]=r(e.sellFundFee).times(100).toNumber(),a[6]=r(e.sellRewardFee).times(100).toNumber(),a[7]=r(e.sellLPFee).times(100).toNumber(),a[8]=e.killBlock?r(e.killBlock).toNumber():0,a[9]=e.maxSwapAmount?m(e.maxSwapAmount,e.decimals):0n,a[10]=e.maxWalletAmount?m(e.maxWalletAmount,e.decimals):0n,s[0]=u,s[1]=e.enableManualStartTrade,s[2]=e.enableKillBlock,s[3]=e.enableSwapLimit,s[4]=e.enableWalletLimit,s[5]=e.enableChangeTax,s[6]=e.enableWhiteList}else if(e.deployerId==3){l[0]=e.name,l[1]=e.symbol;let c=e.token.tokenAddress,u=!1;c==="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"&&(c=(await(await b.wallet.contractSwap(e.chainSwap.routerAddress)).WETH()).toLowerCase(),u=!0),i[0]=c,i[1]=e.chainSwap.routerAddress,i[2]=p.walletAddress,i[3]=e.fundAddress?e.fundAddress:"0x0000000000000000000000000000000000000000",i[4]=e.rewardToken,a[0]=e.decimals,a[1]=m(e.totalSupply,e.decimals),a[2]=r(e.buyFundFee).times(100).toNumber(),a[3]=r(e.buyRewardFee).times(100).toNumber(),a[4]=r(e.buyLPFee).times(100).toNumber(),a[5]=r(e.sellFundFee).times(100).toNumber(),a[6]=r(e.sellRewardFee).times(100).toNumber(),a[7]=r(e.sellLPFee).times(100).toNumber(),a[8]=e.killBlock?r(e.killBlock).toNumber():0,a[9]=e.maxSwapAmount?m(e.maxSwapAmount,e.decimals):0n,a[10]=e.maxWalletAmount?m(e.maxWalletAmount,e.decimals):0n,s[0]=u,s[1]=e.enableManualStartTrade,s[2]=e.enableKillBlock,s[3]=e.enableSwapLimit,s[4]=e.enableWalletLimit,s[5]=e.enableChangeTax,s[6]=e.enableWhiteList,s[7]=e.canMint}console.log(e.deployerId,l,i,a,s);const w=await t.tokenCreate(e.deployerId,l,i,a,s);console.dir(w),e.txHash=w.hash,w.wait().then(async c=>{c.status===1&&n({type:"success",message:o("upChainSuccessfully")})}),x.value=!0}catch(t){if(console.log(JSON.stringify(t)),t.info&&t.info.error&&t.info.error.code===4001)n(o("userCancelOperate"));else if(t.error&&t.error.message&&t.error.message=="Canceled")n(o("userCancelOperate"));else if(t.data&&t.data.code==-32e3){const l=t.data.message.match(/(\d+) want (\d+)/)[2];n(o("balanceSlow2",{chainMianCoin:lmStore.token.chainCoinSymbol,amount:I(l)}))}else t.code==="INSUFFICIENT_FUNDS"?n(o("balanceSlow")):t.info&&t.info.error&&t.info.error.code==-32603&&t.info.error.data.message.endsWith("transfer amount exceeds balance")?n(o("balanceSlow2",{chainMianCoin:F.value,amount:h.value})):t.code=="CALL_EXCEPTION"&&t.info.error.message.endsWith("transfer amount exceeds balance")?n(o("balanceSlow2",{chainMianCoin:F.value,amount:h.value})):n(o("unkonwError"))}finally{S.value=!1,N.value=!1}}function U(){window.open(p.txBlockExplorerUrl+e.txHash,"_blank")}return G(()=>{console.log("create before mounted")}),(t,l)=>{const i=_("router-view"),a=_("van-action-bar-button"),s=_("van-action-bar"),w=_("van-popup");return L(),j("div",Y,[C(i,{onCreateTokenClick:$,createTokenLoading:A.value},null,8,["createTokenLoading"]),C(w,{show:S.value,"onUpdate:show":l[0]||(l[0]=c=>S.value=c),round:"",closeable:"",class:"van-dialog van-dialog--round-button","close-on-click-overlay":!1},{default:B(()=>[d("div",Z,y(t.$t("tokenCreationSoon")),1),d("div",ee,[d("div",ae,[d("div",null,y(t.$t("createConfirmInfo")),1),d("div",te,y(t.$t("serviceFeeCreation",{baseFeeAmount:h.value,baseFeeSymbol:F.value})),1)])]),C(s,{class:"van-dialog__footer"},{default:B(()=>[g.value?(L(),W(a,{key:0,type:"danger",text:t.$t("approveFirst"),class:"van-dialog__confirm",loading:T.value,onClick:P},null,8,["text","loading"])):(L(),W(a,{key:1,type:"danger",loading:N.value,color:"#3F80F7",text:t.$t("confirmAndCreate"),class:"van-dialog__confirm",onClick:R},null,8,["loading","text"]))]),_:1})]),_:1},8,["show"]),C(D,{show:x.value,"onUpdate:show":l[1]||(l[1]=c=>x.value=c),theme:"round-button",showCancelButton:!1,confirmButtonText:t.$t("enterTokenManagement"),onOnConfirm:l[2]||(l[2]=c=>J(M).push("/createToken"))},{default:B(()=>[d("div",null,[C(X,{name:"createSuccess",style:{width:"48px",height:"48px"}})]),d("div",se,y(t.$t("createdSubmitted")),1),d("div",oe,[q(y(t.$t("inBrowser")),1),d("span",{class:"show",onClick:U},y(t.$t("view")),1)]),d("div",ne,y(t.$t("waitToView")),1)]),_:1},8,["show","confirmButtonText"])])}}};export{me as default};
