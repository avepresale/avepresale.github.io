import{_ as P,d as M,a1 as O,u as Y,e as h,D as u,I as E,r as T,o as f,c as g,a as r,w as V,b as o,t as n,T as b,f as d,A as S,C as p,i as x,B as U,a4 as j,a2 as Q,N as q,F as z,x as A,v as k,s as B,Q as C}from"./index-a59c7a36.js";import{S as J,O as K}from"./OperateSuccessDialog-650b3f53.js";const R={class:"ave-popup"},W={class:"title"},X={class:"body"},Z={key:0,class:"info"},ee={class:"key"},oe={class:"value"},ae={key:0,class:"token"},te={key:1,class:"token"},se={class:"key"},ne={class:"value"},le={class:"blue-font"},ce={class:"key"},ie={class:"value"},de={class:"key"},ue={class:"value"},re={class:"select-date"},ke={class:"key"},ve={__name:"DelayPopup",props:{show:Boolean,lockId:String,isLockV2:Boolean,isLpToken:Boolean,unlockDate:Number,tokenList:Array,symbol:String,address:String,chainCoinSymbol:String,amountString:String,chain:String,decimals:Number},emits:["update:show","success"],setup(I,{emit:v}){const e=I,D=M(),m=O(),{t:$}=Y(),s=h(0n),_=h(u.unix(e.unlockDate).toDate()),y=h(""),w=h(!1),L=h("");async function F(){console.log("estimateGas");const a=u.unix(e.unlockDate).add(1,"day").unix(),l=await k.wallet.getGasPrice(),c=await k.wallet.getBalance(D.walletAddress);console.log("balance",c);let t;if(e.isLockV2){const i=await k.wallet.contractTokenLockV2(m.tokenLockV2Address);if(s.value=await i.editFee(),c<s.value){B($("balanceSlow2",{chainMianCoin:D.chainCoinSymbol,amount:C(s.value)})),v("update:show",!1);return}t=await i.editLock.estimateGas(e.lockId,0n,a,{value:s.value})}else{const i=await k.wallet.contractTokenLockV3(m.tokenLockV3Address);if(s.value=await i.editFee(),c<s.value){B($("balanceSlow2",{chainMianCoin:D.chainCoinSymbol,amount:C(s.value)})),v("update:show",!1);return}t=await i.editLock.estimateGas(e.lockId,a,{value:s.value})}console.dir(t),y.value=C(t*l).toString(),console.log(y.value)}async function N(){const a=A({message:"Loading...",forbidClick:!0,duration:0}),l=u(_.value).unix();if(e.isLockV2){const c=await k.wallet.contractTokenLockV2(m.tokenLockV2Address);try{s.value=await c.editFee();let t=await c.editLock(e.lockId.toString(),0n,l,{value:s.value});console.dir(t),L.value=t.hash,w.value=!0}catch(t){console.log(t)}finally{a.close()}}else{const c=await k.wallet.contractTokenLockV3(m.tokenLockV3Address);try{s.value=await c.editFee();let t=await c.editLock(e.lockId.toString(),l,{value:s.value});console.dir(t),L.value=t.hash,w.value=!0}catch(t){console.log(t)}finally{a.close()}}}async function G(){const a=A({message:"Loading...",forbidClick:!0,duration:0});_.value=u.unix(e.unlockDate).add(1,"day").endOf("day").toDate(),await F(),a.close()}E(()=>e.show,(a,l)=>{a&&G()});function H(){v("update:show",!1),v("success")}return(a,l)=>{const c=T("van-button"),t=T("van-popup");return f(),g(z,null,[r(t,{show:I.show,"onUpdate:show":l[1]||(l[1]=i=>{v("update:show",i)}),round:"",closeable:"",position:"bottom"},{default:V(()=>[o("div",R,[o("div",W,n(a.$t("delayLock")),1),o("div",X,[e.chain?(f(),g("ul",Z,[o("li",null,[o("div",ee,n(a.$t("lockAssets")),1),o("div",oe,[e.isLpToken?(f(),g("div",ae,[r(b,{class:"token-icon",tokenIcon:d(S)(e.chain,e.tokenList[0].address)},null,8,["tokenIcon"]),r(b,{class:"token-icon",tokenIcon:d(S)(e.chain,e.tokenList[1].address)},null,8,["tokenIcon"]),p(" "+n(`${e.symbol} (${d(x)(e.address)})`),1)])):(f(),g("div",te,[r(b,{class:"token-icon",tokenIcon:d(S)(e.chain,e.address),chainIcon:d(U)(e.chain)},null,8,["tokenIcon","chainIcon"]),p(" "+n(`${e.symbol} (${d(x)(e.address)})`),1)]))])]),o("li",null,[o("div",se,n(a.$t("unlockTime")),1),o("div",ne,[o("span",null,n(d(u).unix(e.unlockDate).format("YYYY-MM-DD HH:mm:ss")),1),o("span",null,[p("("),o("span",le,n(a.$t("dayLeft",{day:d(j)(d(u).unix(e.unlockDate).toDate())})),1),p(")")])])]),o("li",null,[o("div",ce,n(a.$t("editFee")),1),o("div",ie,n(`${s.value?d(Q).formatEther(s.value):"--"} ${e.chainCoinSymbol}`),1)]),o("li",null,[o("div",de,n(a.$t("gas")),1),o("div",ue,n(`${y.value?y.value:"--"} ${e.chainCoinSymbol}`),1)])])):q("",!0),o("div",re,[o("div",ke,n(a.$t("setDelayDate")),1),r(J,{date:_.value,"onUpdate:date":l[0]||(l[0]=i=>_.value=i),"min-date":d(u).unix(e.unlockDate).add(1,"day").endOf("day").toDate()},null,8,["date","min-date"])]),r(c,{class:"btn",type:"primary",block:"",onClick:N},{default:V(()=>[p(n(a.$t("confirmAndLock")),1)]),_:1})])])]),_:1},8,["show"]),r(K,{show:w.value,"onUpdate:show":l[2]||(l[2]=i=>w.value=i),txHash:L.value,onClose:H},null,8,["show","txHash"])],64)}}},me=P(ve,[["__scopeId","data-v-1a4d7746"]]);export{me as D};
