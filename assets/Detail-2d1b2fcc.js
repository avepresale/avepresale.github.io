import{_ as K,d as W,a1 as X,u as Z,e as w,I as no,x as O,r as M,o as p,c as y,a as k,w as D,b as t,t as e,T as E,f as l,A as B,C as v,i as A,B as oo,a2 as to,F as eo,v as u,M as G,a6 as H,s as lo,Q as j,L as Q,m as io,n as co,g as q,N as I,h as z,D as Y,y as J,a4 as ro,p as uo,j as ko}from"./index-a59c7a36.js";import{D as mo}from"./DelayPopup-09ff03ef.js";import{O as po}from"./OperateSuccessDialog-650b3f53.js";import{I as _o}from"./InputQty-2ed7c9e9.js";import{B as V}from"./bignumber-3e8dfdf6.js";const ho="/assets/images/time.png",vo="/assets/images/add.png";const yo={class:"ave-popup"},wo={class:"title"},go={class:"body"},bo={class:"info"},fo={class:"key"},Lo={class:"value"},So={key:0,class:"token"},Co={key:1,class:"token"},$o={class:"key"},Io={class:"value"},Do={class:"key"},To={class:"value"},Vo={class:"key"},Ao={class:"value"},Eo={class:"key"},Bo={class:"value"},Uo={style:{}},Fo={__name:"AppendLockPopup",props:{show:Boolean,lockId:String,isLockV2:Boolean,isLpToken:Boolean,unlockDate:Number,tokenList:Array,symbol:String,address:String,chainCoinSymbol:String,amountString:String,chain:String,decimals:Number},emits:["update:show","success"],setup(C,{emit:n}){const a=C,$=W(),U=X(),{t:g}=Z(),o=w(0n),b=w(""),f=w(""),F=w(""),N=w(!1),P=w("");async function R(){const i=await(await u.wallet.contractERC20(a.address)).balanceOf($.walletAddress);if(f.value=G(i,a.decimals),console.log("value:"+f.value),i==0n)throw H(g("balanceSlow")),n("update:show",!1),"Blance Slow"}async function r(){if(!a.isLockV2)return;const s=await u.wallet.contractTokenLockV2(U.tokenLockV2Address);o.value=await s.editFee();const i=await u.wallet.getBalance($.walletAddress);if(console.log("balance",i),i<o.value){lo(g("balanceSlow2",{chainMianCoin:$.chainCoinSymbol,amount:j(o.value)})),n("update:show",!1);return}const _=await(await u.wallet.contractERC20(a.address)).decimals(),h=G("1",_),S=V(a.amountString).plus(V(h)).toString(),T=Q(S,_),so=await u.wallet.getGasPrice();let ao=await s.editLock.estimateGas(a.lockId.toString(),T.toString(),0n,{value:o.value});F.value=j(ao*so).toString()}async function c(){if(!a.isLockV2)return;if(!b.value){H(g("enterAmount"));return}if(V(b.value).gt(V(f.value))){H(g("balanceSlow"));return}const s=O({message:"Loading...",forbidClick:!0,duration:0}),i=await u.wallet.contractTokenLockV2(U.tokenLockV2Address),_=await(await u.wallet.contractERC20(a.address)).decimals(),h=V(a.amountString).plus(V(b.value)).toString();console.log(h);const S=Q(h,_);try{o.value=await i.editFee();let T=await i.editLock(a.lockId.toString(),S.toString(),0n,{value:o.value});console.dir(T),P.value=T.hash,N.value=!0}catch(T){console.log(T)}finally{s.close()}}no(()=>a.show,(s,i)=>{s&&d()});async function d(){const s=O({message:"Loading...",forbidClick:!0,duration:0});try{await R(),await r()}catch(i){console.log(i)}finally{s.close()}}function m(){n("update:show",!1),n("success")}return(s,i)=>{const L=M("van-button"),_=M("van-popup");return p(),y(eo,null,[k(_,{show:C.show,"onUpdate:show":i[1]||(i[1]=h=>{n("update:show",h)}),round:"",closeable:"",position:"bottom"},{default:D(()=>[t("div",yo,[t("div",wo,e(s.$t("appendLock")),1),t("div",go,[t("ul",bo,[t("li",null,[t("div",fo,e(s.$t("appendAssets")),1),t("div",Lo,[a.isLpToken?(p(),y("div",So,[k(E,{class:"token-icon",tokenIcon:l(B)(a.chain,a.tokenList[0].address)},null,8,["tokenIcon"]),k(E,{class:"token-icon",tokenIcon:l(B)(a.chain,a.tokenList[1].address)},null,8,["tokenIcon"]),v(" "+e(`${a.symbol} (${l(A)(a.address)})`),1)])):(p(),y("div",Co,[k(E,{class:"token-icon",tokenIcon:l(B)(a.chain,a.address),chainIcon:l(oo)(a.chain)},null,8,["tokenIcon","chainIcon"]),v(" "+e(`${a.symbol} (${l(A)(a.address)})`),1)]))])]),t("li",null,[t("div",$o,e(s.$t("currentAmount")),1),t("div",Io,e(a.amountString),1)]),t("li",null,[t("div",Do,e(s.$t("balance")),1),t("div",To,e(`${f.value} ${a.symbol}`),1)]),t("li",null,[t("div",Vo,e(s.$t("editFee")),1),t("div",Ao,e(`${o.value?l(to).formatEther(o.value):"--"} ${a.chainCoinSymbol}`),1)]),t("li",null,[t("div",Eo,e(s.$t("gas")),1),t("div",Bo,e(`${F.value?F.value:"--"} ${a.chainCoinSymbol}`),1)])]),t("div",Uo,[k(_o,{total:f.value,amount:b.value,"onUpdate:amount":i[0]||(i[0]=h=>b.value=h),decimals:a.decimals},null,8,["total","amount","decimals"])]),k(L,{class:"btn",type:"primary",block:"",onClick:c},{default:D(()=>[v(e(s.$t("confirmAndLock")),1)]),_:1})])])]),_:1},8,["show"]),k(po,{show:N.value,"onUpdate:show":i[2]||(i[2]=h=>N.value=h),txHash:P.value,onClose:m},null,8,["show","txHash"])],64)}}},No=K(Fo,[["__scopeId","data-v-828095f1"]]);const x=C=>(uo("data-v-ee52e554"),C=C(),ko(),C),Po={key:0,class:"body"},Ro={key:0,class:"token"},Yo={key:1,class:"token"},Ho={class:"info"},Mo={class:"item"},Go={class:"key"},qo={class:"value"},xo={key:0,class:"item"},Oo={class:"key"},jo={class:"value"},Qo={class:"item"},zo={class:"key"},Jo={class:"value"},Ko={class:"item"},Wo={class:"key"},Xo={key:0,class:"value"},Zo={key:1,class:"value"},ot={class:"item"},tt={class:"key"},et={class:"value"},st={class:"blue-font"},at={class:"item"},nt={class:"key"},lt={class:"value"},it={class:"item"},ct={class:"key"},dt={class:"value"},rt=x(()=>t("div",{class:"footer"},null,-1)),ut=x(()=>t("img",{src:ho,alt:""},null,-1)),kt=x(()=>t("img",{src:vo,alt:""},null,-1)),mt={__name:"Detail",props:{lockId:String,tokenType:String,version:String},setup(C){const n=C,{t:a}=Z(),$=W(),U=X(),g=w(!1),o=io({id:n.lockId,address:"",amountString:"",tokenList:[],lockDate:0,unlockDate:0,isLpToken:!1,symbol:"",chain:"",isExpired:!1,chainCoinSymbol:"",decimals:0}),b=w(!1),f=w(!1);async function F(){g.value=!1;let r;n.version=="V2"?r=await u.wallet.contractTokenLockV2(U.tokenLockV2Address):n.version=="V3"&&(r=await u.wallet.contractTokenLockV3(U.tokenLockV3Address)),console.dir(r);let c;try{console.log(n.lockId),c=await r.getLockById(n.lockId)}catch{H(a("failedToGetDetail"));return}if(o.lockDate=Number(c[4]),o.unlockDate=Number(c[5]),o.tokenId=c.tokenId,o.address=c[1],o.owner=c[2],o.isExpired=Y().unix()>=o.unlockDate,o.chain=$.chain,o.chainCoinSymbol=$.chainCoinSymbol,n.tokenType=="lpToken"){if(n.version=="V2")try{const d=await u.wallet.contractLP(o.address);let m=await d.decimals();o.decimals=m;let s=await d.token0(),L=await(await u.wallet.contractERC20(s)).symbol(),_=await d.token1(),S=await(await u.wallet.contractERC20(_)).symbol();o.isLpToken=!0,o.tokenList[0]={symbol:L.toUpperCase(),address:s.toLowerCase()},o.tokenList[1]={symbol:S.toUpperCase(),address:_.toLowerCase()},o.amountString=G(c[3],m),o.symbol=`${L}/${S}`}catch(d){console.log(d)}else if(n.version=="V3")try{let m=await(await u.wallet.contractNFT(o.address)).positions(o.tokenId);console.log(m.token0);let s=m.token0,L=await(await u.wallet.contractERC20(s)).symbol(),_=m.token1,S=await(await u.wallet.contractERC20(_)).symbol();o.isLpToken=!0,o.tokenList[0]={symbol:L.toUpperCase(),address:s.toLowerCase()},o.tokenList[1]={symbol:S.toUpperCase(),address:_.toLowerCase()},o.liquidity=m.liquidity,o.symbol=`${L}/${S}`}catch(d){console.log(d)}}else if(n.tokenType=="token")try{const d=await u.wallet.contractERC20(o.address);let m=await d.symbol(),s=await d.decimals();o.decimals=s,o.tokenList=[],o.isLpToken=!1,o.symbol=m.toUpperCase(),o.amountString=G(c[3],s)}catch(d){console.log(d)}g.value=!0,console.log("getDetailDone")}function N(){console.log(o),b.value=!0}function P(){f.value=!0}function R(){window.location.reload()}return co(()=>{F()}),w(!0),console.log(n.lockId),console.log(n.tokenType),(r,c)=>{const d=M("van-button"),m=M("van-action-bar");return p(),y(eo,null,[g.value?(p(),y("div",Po,[o.isLpToken?(p(),y("div",Ro,[k(E,{class:"token-icon",tokenIcon:l(B)(o.chain,o.tokenList[0].address)},null,8,["tokenIcon"]),k(E,{class:"token-icon",tokenIcon:l(B)(o.chain,o.tokenList[1].address)},null,8,["tokenIcon"]),v(" "+e(`${o.symbol} (${l(A)(o.address)})`),1)])):(p(),y("div",Yo,[o.address?(p(),q(E,{key:0,class:"token-icon",tokenIcon:l(B)(o.chain,o.address.toLowerCase()),chainIcon:l(oo)(o.chain)},null,8,["tokenIcon","chainIcon"])):I("",!0),v(" "+e(`${o.symbol} (${l(A)(o.address)})`),1)])),t("ul",Ho,[t("li",Mo,[t("div",Go,e(r.$t("contractAddress")),1),t("div",qo,[v(e(l(A)(o.address))+" ",1),k(z,{class:"copy-icon",name:"copy",onClick:c[0]||(c[0]=s=>l(J)(o.address))})])]),n.version=="V3"?(p(),y("li",xo,[t("div",Oo,e(r.$t("tokenID")),1),t("div",jo,e(n.lockId),1)])):I("",!0),t("li",Qo,[t("div",zo,e(r.$t("contractChian")),1),t("div",Jo,e(o.chain.toUpperCase()),1)]),t("li",Ko,[t("div",Wo,e(`${o.symbol} ${r.$t("lockNumber")}`),1),n.version=="V2"?(p(),y("div",Xo,e(o.amountString),1)):I("",!0),n.version=="V3"?(p(),y("div",Zo,e(l(to).formatEther(o.liquidity.toString())),1)):I("",!0)]),t("li",ot,[t("div",tt,e(r.$t("unlockTime2")),1),t("div",et,[t("span",null,e(l(Y).unix(o.unlockDate).format("YYYY-MM-DD HH:mm:ss")),1),t("span",null,[v("("),t("span",st,e(o.isExpired?r.$t("expired"):r.$t("dayLeft",{day:l(ro)(l(Y).unix(o.unlockDate).toDate())})),1),v(")")])])]),t("li",at,[t("div",nt,e(r.$t("lockUser")),1),t("div",lt,[v(e(l(A)(o.owner))+" ",1),k(z,{class:"copy-icon",name:"copy",onClick:c[1]||(c[1]=s=>l(J)(o.owner))})])]),t("li",it,[t("div",ct,e(r.$t("lockTime")),1),t("div",dt,e(l(Y).unix(o.lockDate).format("YYYY-MM-DD HH:mm:ss")),1)])])])):I("",!0),rt,!o.isExpired&&g.value&&l($).walletAddress&&o.owner.toLowerCase()==l($).walletAddress.toLowerCase()?(p(),q(m,{key:1,class:"tools"},{default:D(()=>[k(d,{class:"btn",color:"#9F3FF7",onClick:N},{icon:D(()=>[ut]),default:D(()=>[v(e(r.$t("delay")),1)]),_:1}),n.version=="V2"?(p(),q(d,{key:0,class:"btn",color:"#3F80F7",onClick:P},{icon:D(()=>[kt]),default:D(()=>[v(e(r.$t("append")),1)]),_:1})):I("",!0),k(mo,{show:b.value,"onUpdate:show":c[2]||(c[2]=s=>b.value=s),onSuccess:R,isLockV2:n.version=="V2",lockId:o.id,isLpToken:o.isLpToken,chain:o.chain,unlockDate:o.unlockDate,tokenList:o.tokenList,symbol:o.symbol,address:o.address,chainCoinSymbol:o.chainCoinSymbol,amountString:o.amountString,decimals:o.decimals},null,8,["show","isLockV2","lockId","isLpToken","chain","unlockDate","tokenList","symbol","address","chainCoinSymbol","amountString","decimals"]),k(No,{show:f.value,"onUpdate:show":c[3]||(c[3]=s=>f.value=s),onSuccess:R,isLockV2:n.version=="V2",lockId:o.id,isLpToken:o.isLpToken,chain:o.chain,unlockDate:o.unlockDate,tokenList:o.tokenList,symbol:o.symbol,address:o.address,chainCoinSymbol:o.chainCoinSymbol,amountString:o.amountString,decimals:o.decimals},null,8,["show","isLockV2","lockId","isLpToken","chain","unlockDate","tokenList","symbol","address","chainCoinSymbol","amountString","decimals"])]),_:1})):I("",!0)],64)}}},wt=K(mt,[["__scopeId","data-v-ee52e554"]]);export{wt as default};
