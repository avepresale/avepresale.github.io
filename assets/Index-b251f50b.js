import{D as $}from"./Dialog-dd430114.js";import{u as R,f as D,d as H,e as U,g,E as K,D as E,r as N,o as O,c as V,a as h,l as I,j as G,s as n,n as y,G as j,b as f,t as S,k as J,A as X,H as p,p as q,I as z}from"./index-f1dc9d5c.js";import{u as Q}from"./create-364fdc3d.js";import{B as l}from"./bignumber-3e8dfdf6.js";/* empty css                                                       */const Y={class:"create"},Z=f("div",{class:"van-dialog__header"},null,-1),ee={class:"van-dialog__content"},ae={class:"van-dialog__message van-dialog__message--has-title"},te=f("div",{style:{paddingTop:"20px"}},null,-1),oe={class:"create-success-title"},se={class:"create-success-text"},ne={class:"create-success-text"},me={__name:"Index",setup(le){const{t:s}=R(),v=D(),c=H(),B=U(),e=Q(),C=g(!1),L=g(!1),_=g(!1),T=g(!1),A=g("");async function W(){console.log("createTokenClick");const t=/^0x[0-9a-fA-F]{40}(,\d*\.?\d+)?$/;if(c.chainId==-1){c.netErrorDialogShow=!0;return}if(e.deployerId===0||e.deployerId===1||e.deployerId===2){if(!e.name){n(s("pleaseEnterName"));return}if(!e.symbol){n(s("pleaseEnterSymbol"));return}if(!e.totalSupply){n(s("pleaseEnterTotal"));return}}if(e.deployerId===1||e.deployerId==2){if(!e.token){n(s("pleaseSelectCurrency"));return}if(!e.chainSwap){n(s("pleaseSelectSwap"));return}if(e.deployerId===1){if(l(e.buyFundFee).plus(e.buyBurnFee).plus(e.buyLPFee).plus(e.sellFundFee).plus(e.sellBurnFee).plus(e.sellLPFee).lte(0)){n(s("taxMustGt0"));return}}else if(e.deployerId===2){if(l(e.buyFundFee).plus(e.buyLPFee).plus(e.sellFundFee).plus(e.sellLPFee).lte(0)){n(s("taxlimit2"));return}}else if(e.deployerId===3){if(!e.rewardToken){n(s("dividendTokenError"));return}if(!t.test(e.rewardToken)){n(s("pleaseEnterTrueAddress"));return}if(l(e.buyFundFee).plus(e.buyLPFee).plus(e.buyRewardFee).plus(e.sellFundFee).plus(e.sellLPFee).plus(e.sellRewardFee).lte(0)){n(s("taxMustGt0"));return}}if((Number(e.buyFundFee)>0||Number(e.sellFundFee)>0)&&!e.fundAddress){n(s("pleaseEnterMarketingAddress"));return}if(e.fundAddress&&!t.test(e.fundAddress)){n(s("pleaseEnterTrueAddress"));return}if(e.enableKillBlock&&(!e.killBlock||Number(e.killBlock)<=0)){n(s("pleaseEnterKillBlockNumber"));return}if(e.enableWalletLimit&&(!e.maxWalletAmount||Number(e.maxWalletAmount)<=0)){n(s("pleaseEnterMaxWalletLimit"));return}if(e.enableSwapLimit&&(!e.maxSwapAmount||Number(e.maxSwapAmount)<=0)){n(s("pleaseEnterMaxSwapLimit"));return}}_.value=!0;let i=await(await y.wallet.contractTokenFactory(B.tokenFactoryAddress)).baseFee();console.log("baseFee",i),A.value=j(i);const r=await y.wallet.getBalance(c.walletAddress);if(console.log("balance",r),r<i){n(s("balanceSlow2",{chainMianCoin:c.chainCoinSymbol,amount:A.value})),_.value=!1;return}C.value=!0,_.value=!1}async function M(){T.value=!0;try{const t=await y.wallet.contractTokenFactory(B.tokenFactoryAddress);let u=await t.baseFee();const i=[],r=[],a=[],o=[];if(e.deployerId==0)i[0]=e.name,i[1]=e.symbol,a[0]=e.decimals,a[1]=p(e.totalSupply,e.decimals),o[0]=e.canMint;else if(e.deployerId==1){i[0]=e.name,i[1]=e.symbol;let d=e.token.tokenAddress,m=!1;d==="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"&&(d=(await(await y.wallet.contractSwap(e.chainSwap.routerAddress)).WETH()).toLowerCase(),m=!0),r[0]=d,r[1]=e.chainSwap.routerAddress,r[2]=c.walletAddress,r[3]=e.fundAddress?e.fundAddress:"0x0000000000000000000000000000000000000000",a[0]=e.decimals,a[1]=p(e.totalSupply,e.decimals),a[2]=l(e.buyFundFee).times(100).toNumber(),a[3]=l(e.buyBurnFee).times(100).toNumber(),a[4]=l(e.buyLPFee).times(100).toNumber(),a[5]=l(e.sellFundFee).times(100).toNumber(),a[6]=l(e.sellBurnFee).times(100).toNumber(),a[7]=l(e.sellLPFee).times(100).toNumber(),a[8]=e.killBlock?l(e.killBlock).toNumber():0,a[9]=e.maxSwapAmount?p(e.maxSwapAmount,e.decimals):0n,a[10]=e.maxWalletAmount?p(e.maxWalletAmount,e.decimals):0n,o[0]=e.canMint,o[1]=m,o[2]=e.enableManualStartTrade,o[3]=e.enableKillBlock,o[4]=e.enableSwapLimit,o[5]=e.enableWalletLimit,o[6]=e.enableChangeTax,o[7]=e.enableWhiteList}else if(e.deployerId==2){i[0]=e.name,i[1]=e.symbol;let d=e.token.tokenAddress,m=!1;d==="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"&&(d=(await(await y.wallet.contractSwap(e.chainSwap.routerAddress)).WETH()).toLowerCase(),m=!0),r[0]=d,r[1]=e.chainSwap.routerAddress,r[2]=c.walletAddress,r[3]=e.fundAddress?e.fundAddress:"0x0000000000000000000000000000000000000000",a[0]=e.decimals,a[1]=p(e.totalSupply,e.decimals),a[2]=l(e.buyFundFee).times(100).toNumber(),a[3]=l(e.buyRewardFee).times(100).toNumber(),a[4]=l(e.buyLPFee).times(100).toNumber(),a[5]=l(e.sellFundFee).times(100).toNumber(),a[6]=l(e.sellRewardFee).times(100).toNumber(),a[7]=l(e.sellLPFee).times(100).toNumber(),a[8]=e.killBlock?l(e.killBlock).toNumber():0,a[9]=e.maxSwapAmount?p(e.maxSwapAmount,e.decimals):0n,a[10]=e.maxWalletAmount?p(e.maxWalletAmount,e.decimals):0n,o[0]=m,o[1]=e.enableManualStartTrade,o[2]=e.enableKillBlock,o[3]=e.enableSwapLimit,o[4]=e.enableWalletLimit,o[5]=e.enableChangeTax,o[6]=e.enableWhiteList}else if(e.deployerId==3){i[0]=e.name,i[1]=e.symbol;let d=e.token.tokenAddress,m=!1;d==="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"&&(d=(await(await y.wallet.contractSwap(e.chainSwap.routerAddress)).WETH()).toLowerCase(),m=!0),r[0]=d,r[1]=e.chainSwap.routerAddress,r[2]=c.walletAddress,r[3]=e.fundAddress?e.fundAddress:"0x0000000000000000000000000000000000000000",r[4]=e.rewardToken,a[0]=e.decimals,a[1]=p(e.totalSupply,e.decimals),a[2]=l(e.buyFundFee).times(100).toNumber(),a[3]=l(e.buyRewardFee).times(100).toNumber(),a[4]=l(e.buyLPFee).times(100).toNumber(),a[5]=l(e.sellFundFee).times(100).toNumber(),a[6]=l(e.sellRewardFee).times(100).toNumber(),a[7]=l(e.sellLPFee).times(100).toNumber(),a[8]=e.killBlock?l(e.killBlock).toNumber():0,a[9]=e.maxSwapAmount?p(e.maxSwapAmount,e.decimals):0n,a[10]=e.maxWalletAmount?p(e.maxWalletAmount,e.decimals):0n,o[0]=m,o[1]=e.enableManualStartTrade,o[2]=e.enableKillBlock,o[3]=e.enableSwapLimit,o[4]=e.enableWalletLimit,o[5]=e.enableChangeTax,o[6]=e.enableWhiteList,o[7]=e.canMint}console.log(e.deployerId,i,r,a,o);const w=await t.tokenCreate(e.deployerId,i,r,a,o,{value:u});console.dir(w),e.txHash=w.hash;let k;c.chain=="core"&&(k=q({duration:0,forbidClick:!0,message:s("upChainNow")})),w.wait().then(async d=>{if(console.log("upChainSuccessfully"),console.log(d),d.status===1&&(n({type:"success",message:s("upChainSuccessfully")}),c.chain=="core")){k&&(k.message=s("verityContractNow")),console.log(d.logs);const m=d.logs.find(b=>b.fragment&&b.fragment.name=="TokenCreated");console.log(m);const F=m.args[1];console.log(F);try{const b=await y.coredao.verifysourcecode(e.deployerId,i,r,a,o,F);await y.coredao.checkverifystatus(b),n({type:"success",message:s("verityContractSuccess")})}catch{n(s("verityContractFail"))}finally{k&&k.close()}}}),L.value=!0}catch(t){if(console.log(JSON.stringify(t)),t.info&&t.info.error&&t.info.error.code===4001)n(s("userCancelOperate"));else if(t.error&&t.error.message&&t.error.message=="Canceled")n(s("userCancelOperate"));else if(t.data&&t.data.code==-32e3){const u=t.data.message.match(/(\d+) want (\d+)/)[2];n(s("balanceSlow2",{chainMianCoin:lmStore.token.chainCoinSymbol,amount:z(u)}))}else t.code==="INSUFFICIENT_FUNDS"?n(s("balanceSlow")):t.info&&t.info.error&&t.info.error.code==-32603&&t.info.error.data.message.endsWith("transfer amount exceeds balance")?n(s("balanceSlow2",{chainMianCoin:c.chainCoinSymbol,amount:A.value})):t.code=="CALL_EXCEPTION"&&t.info.error.message.endsWith("transfer amount exceeds balance")?n(s("balanceSlow2",{chainMianCoin:c.chainCoinSymbol,amount:A.value})):n(s("unkonwError"))}finally{C.value=!1,T.value=!1}}function P(){window.open(c.txBlockExplorerUrl+e.txHash,"_blank")}K(()=>{console.log("create before mounted"),e.token&&e.token.chain!=c.chain&&(e.token=null),e.chainSwap&&e.chainSwap.chain!=c.chain&&(e.chainSwap=null)});const x=E[c.dappType].chainList.find(t=>t.chain===c.chain);if(!x)c.netErrorDialogShow=!0,v.push("/");else if(x.deployerIds.length===0)v.push("/");else{const t=E[c.dappType].deployerList.filter(u=>x.deployerIds.some(i=>i==u.deployerId));e.deployerList=t,e.deployerId===-1?(e.deployerId=e.deployerList[0].deployerId,e.deployerName=e.deployerList[0].deployerName):x.deployerIds.some(u=>u==e.deployerId)||(e.deployerId=e.deployerList[0].deployerId,e.deployerName=e.deployerList[0].deployerName,v.push("/createToken/create/detail"))}return(t,u)=>{const i=N("router-view"),r=N("van-action-bar-button"),a=N("van-action-bar"),o=N("van-popup");return O(),V("div",Y,[h(i,{onCreateTokenClick:W,createTokenLoading:_.value},null,8,["createTokenLoading"]),h(o,{show:C.value,"onUpdate:show":u[0]||(u[0]=w=>C.value=w),round:"",closeable:"",class:"van-dialog van-dialog--round-button","close-on-click-overlay":!1},{default:I(()=>[Z,f("div",ee,[f("div",ae,[f("div",null,S(t.$t("createConfirmInfo")),1),te])]),h(a,{class:"van-dialog__footer"},{default:I(()=>[h(r,{type:"danger",loading:T.value,color:"#3F80F7",text:t.$t("confirmAndCreate"),class:"van-dialog__confirm",onClick:M},null,8,["loading","text"])]),_:1})]),_:1},8,["show"]),h($,{show:L.value,"onUpdate:show":u[1]||(u[1]=w=>L.value=w),theme:"round-button",showCancelButton:!1,confirmButtonText:t.$t("enterTokenManagement"),onOnConfirm:u[2]||(u[2]=w=>G(v).push("/createToken"))},{default:I(()=>[f("div",null,[h(J,{name:"createSuccess",style:{width:"48px",height:"48px"}})]),f("div",oe,S(t.$t("createdSubmitted")),1),f("div",se,[X(S(t.$t("inBrowser")),1),f("span",{class:"show",onClick:P},S(t.$t("view")),1)]),f("div",ne,S(t.$t("waitToView")),1)]),_:1},8,["show","confirmButtonText"])])}}};export{me as default};
