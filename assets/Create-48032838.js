import{I as $e}from"./InputQty-cf2b18cf.js";import{O as be,S as Le}from"./OperateSuccessDialog-e141f67f.js";import{_ as se,d as le,W as ce,r as N,o as d,m as P,l as h,b as e,t as n,c as y,j as o,a as i,z as ie,T as B,A as _,q,y as j,I as K,F as I,B as Y,Y as Ae,u as Te,g as m,f as Ve,i as Ie,C as ee,n as k,Z as $,D as Se,p as te,L as De,K as Ee}from"./index-7414fdc7.js";import{B as oe}from"./bignumber-3e8dfdf6.js";import{e as re}from"./ethers-744cf2e4.js";import{a as ne,b as ae,f as Ne}from"./units-f17b14b0.js";const Oe={class:"ave-popup"},Fe={class:"title"},Pe={class:"body"},Be={class:"info"},Ue={class:"key"},Ge={class:"value"},Me={key:0,class:"token"},Re={key:1,class:"token"},We={key:2,class:"token"},Ye={class:"key"},qe={class:"value"},je={class:"item"},He={class:"key"},Ke={class:"value"},Qe={class:"item"},ze={class:"key"},Ze={class:"value"},Je={class:"key"},Xe={class:"value"},xe={class:"key"},et={class:"value"},tt={class:"blue-font"},ot={class:"key"},nt={class:"value"},at={class:"tips"},st={__name:"LockConfirmPopup",props:{show:Boolean,showGas:String,amount:String,unlockDate:Date,isLockV2:Boolean,positions:Object},emits:["update:show","confirm"],setup(A,{emit:w}){const v=A,g=le(),l=ce();function T(){w("confirm")}return(r,b)=>{const R=N("van-button"),f=N("van-popup");return d(),P(f,{show:A.show,"onUpdate:show":b[0]||(b[0]=a=>{w("update:show",a)}),round:"",closeable:"",position:"bottom"},{default:h(()=>[e("div",Oe,[e("div",Fe,n(r.$t("lockConfirm")),1),e("div",Pe,[e("ul",Be,[v.isLockV2?(d(),y(I,{key:0},[e("li",null,[e("div",Ue,n(r.$t("lockAssets")),1),e("div",Ge,[o(l).token?o(l).token.tokenType==0?(d(),y("div",Re,[i(B,{class:"token-icon",tokenIcon:o(l).token.icon,chainIcon:o(ie)(o(l).token.chain)},null,8,["tokenIcon","chainIcon"]),_(" "+n(`${o(l).token.symbol} (${o(q)(o(l).token.address)})`),1)])):o(l).token.tokenType==1?(d(),y("div",We,[i(B,{class:"token-icon",tokenIcon:o(j)(o(l).token.chain,o(l).token.tokenList[0].address)},null,8,["tokenIcon"]),i(B,{class:"token-icon",tokenIcon:o(j)(o(l).token.chain,o(l).token.tokenList[1].address)},null,8,["tokenIcon"]),_(" "+n(`${o(l).token.symbol} (${o(q)(o(l).token.address)})`),1)])):K("",!0):(d(),y("div",Me," -- "))])]),e("li",null,[e("div",Ye,n(r.$t("lockNumber")),1),e("div",qe,n(A.amount),1)])],64)):(d(),y(I,{key:1},[e("li",je,[e("div",He,n(r.$t("transactionPairs")),1),e("div",Ke,n(v.positions?`${v.positions.token0Symbol}/${v.positions.token1Symbol}`:"--/--"),1)]),e("li",Qe,[e("div",ze,n(r.$t("lockQuantity")),1),e("div",Ze,n(v.positions?o(re).formatEther(A.positions.liquidity.toString()):"--"),1)])],64)),e("li",null,[e("div",Je,n(r.$t("contractChian")),1),e("div",Xe,n(o(g).chain.toUpperCase()),1)]),e("li",null,[e("div",xe,n(r.$t("unlockTime2")),1),e("div",et,[e("span",null,n(o(Y)(A.unlockDate).format("YYYY-MM-DD")),1),e("span",null,[_("("),e("span",tt,n(r.$t("dayLeft",{day:o(Ae)(v.unlockDate)})),1),_(")")])])]),e("li",null,[e("div",ot,n(r.$t("gas")),1),e("div",nt,n(A.showGas?`${A.showGas} ${o(g).chainCoinSymbol.toUpperCase()}`:"--"),1)])]),e("div",at,[e("div",null,n(r.$t("createTips1")),1),e("div",null,n(r.$t("createTips2")),1),e("div",null,n(r.$t("createTips3")),1)]),i(R,{class:"btn",type:"primary",block:"",onClick:T},{default:h(()=>[_(n(r.$t("confirmAndLock")),1)]),_:1})])])]),_:1},8,["show"])}}},lt=se(st,[["__scopeId","data-v-5ab12648"]]);const ct={class:"body"},it={class:"tab"},rt={class:"form"},dt={class:"title token-title"},ut={key:0,class:"token-box"},kt={key:1,class:"token"},vt={class:"title token-title"},ft={class:"title token-title"},mt={class:"title token-title"},pt={key:0,class:"info"},wt={class:"item"},ht={class:"key"},yt={class:"value"},_t={class:"item"},gt={class:"key"},Ct={class:"value"},$t={class:"title token-title"},bt={class:"tools"},Lt={__name:"Create",setup(A){const{t:w}=Te(),v=m(!0),g=m(""),l=m(""),T=m(!1),r=m(!1),b=m(!1),R=Ve(),f=le(),a=ce(),de=Y().add(1,"day").endOf("day").toDate(),U=m(de),S=m(""),G=m(!1),Q=m(""),W=m(!1),M=m(""),O=m("");async function ue(){await f.connectWallet()}async function z(){if(a.token==null)return;if(a.token.address==k.wallet.MAIN_COIN_ADDRESS){T.value=!1;return}await k.wallet.isAllowanceEnough(a.tokenLockV2Address,a.token.address,f.walletAddress)?T.value=!1:T.value=!0}async function ke(){if(r.value=!0,v.value)try{let t=await k.wallet.approveMaxAmount(a.token.address,a.tokenLockV2Address);console.log(t),await t.wait(),T.value=!1}catch(t){console.log(t)}finally{r.value=!1}}async function ve(){b.value=!0,M.value="";try{if(!a.token){$(w("pleaseSelectToken"));return}if(!S.value){$(w("enterAmount"));return}let t=Se[f.dappType].chainList.find(s=>s.chain==a.token.chain);if(!t){$(w("tokenChainNotSupport"));return}if(f.chain!=t.chain){$(w("switchTokenChain"));try{await k.wallet.switchNetwork(t.chainId)}catch{$(w("switchTokenChain"));return}return}if(oe(S.value).gt(oe(O.value))){$(w("balanceSlow"));return}if(await z(),T.value){$(w("approveFirst"));return}await Z()}catch(t){console.log(t)}finally{b.value=!1}}async function Z(){const t=await k.wallet.getGasPrice();let s;const c=Y(U.value).endOf("day").unix();if(v.value){const p=a.token.address,D=await(await k.wallet.contractERC20(p)).decimals(),C=a.token.tokenType==1,u=ne(S.value,D);s=await(await k.wallet.contractTokenLockV2(a.tokenLockV2Address)).lock.estimateGas(f.walletAddress,p,C,u.toString(),c,"")}else s=await(await k.wallet.contractTokenLockV3(a.tokenLockV3Address)).lock.estimateGas(f.walletAddress,g.value,l.value,c,"");console.dir(s),Q.value=ae(s*t),G.value=!0}async function fe(){const t=te({message:"Loading...",forbidClick:!0,duration:0}),s=Y(U.value).endOf("day").unix();if(v.value){const c=a.token.address,p=a.token.tokenType==1,D=await(await k.wallet.contractERC20(c)).decimals(),C=ne(S.value,D),u=await k.wallet.contractTokenLockV2(a.tokenLockV2Address);try{let E=await u.lock(f.walletAddress,c,p,C.toString(),s,"");console.dir(E),M.value=E.hash,W.value=!0,G.value=!1}catch(E){console.log(E)}finally{t.close()}}else{const c=await k.wallet.contractTokenLockV3(a.tokenLockV3Address);try{let p=await c.lock(f.walletAddress,g.value,l.value,s,"");console.dir(p),M.value=p.hash,W.value=!0,G.value=!1}catch(p){console.log(p)}finally{t.close()}}}function me(){R.push("/lockMaster/selectToken")}async function pe(){if(!a.token)return;const t=te({message:"Loading...",forbidClick:!0,duration:0});try{if(a.token.address==k.wallet.MAIN_COIN_ADDRESS){const c=await(await k.wallet.getEthersProvider()).getBalance(f.walletAddress);O.value=ae(c)}else{const s=await k.wallet.contractERC20(a.token.address),c=await s.decimals(),p=await s.balanceOf(f.walletAddress);O.value=Ne(p,c)}}catch(s){console.log(s),a.token=null}finally{t.close()}}Ie(()=>{f.chainId>0&&f.isConnectWallet&&a.token&&(z(),pe())});const H=m(!1),V=m(null);async function we(){r.value=!0;try{const t=await k.wallet.contractNFT(g.value);if((await t.ownerOf(l.value)).toLowerCase()!=f.walletAddress){$(w("notOwnToken"));return}await(await t.approve(a.tokenLockV3Address,l.value)).wait(),H.value=!1}catch(t){console.log(t)}finally{r.value=!1}}async function he(){b.value=!0,M.value="";try{if((await(await k.wallet.contractNFT(g.value)).ownerOf(l.value)).toLowerCase()!=f.walletAddress){$(w("notOwnToken"));return}await Z()}catch(t){console.log(t)}finally{b.value=!1}}const F=m(!1),J=m(!1);async function X(){if(F.value=!1,!(!g.value||!Ee(g.value))&&l.value){J.value=!0;try{const t=await k.wallet.contractNFT(g.value);let s;try{s=await t.ownerOf(l.value)}catch(Ce){console.error(Ce),$(w("trueTokenAddressIDFormat"));return}const c=await t.positions(l.value),p=c[2],L=c[3],C=await(await k.wallet.contractERC20(p)).symbol(),E=await(await k.wallet.contractERC20(L)).symbol();V.value={token0:c[2],token0Symbol:C,token1:c[3],token1Symbol:E,liquidity:c[7]};const ge=await t.getApproved(l.value);H.value=ge.toLowerCase()!=a.tokenLockV3Address.toLowerCase(),F.value=!0}catch(t){console.log(t)}finally{J.value=!1}}}function x(t){v.value!=t&&(v.value=t,F.value=!1,V.value=null)}function ye(t){g.value=t,X()}function _e(t){l.value=t,X()}return(t,s)=>{const c=N("van-divider"),p=N("van-cell"),L=N("van-cell-group"),D=N("van-field"),C=N("van-button");return d(),y(I,null,[e("div",ct,[e("ul",it,[e("li",{class:ee({"tab-select":v.value}),onClick:s[0]||(s[0]=u=>x(!0))},n(t.$t("tokenOrLP(V2)")),3),e("li",{class:ee({"tab-select":!v.value}),onClick:s[1]||(s[1]=u=>x(!1))},"LP(uniV3)",2)]),i(c),e("div",rt,[v.value?(d(),y(I,{key:0},[i(L,{inset:"",class:"form-item"},{default:h(()=>[e("div",dt,n(t.$t("selectToken2")),1),i(p,{"is-link":"",class:"token-cell",onClick:me},De({_:2},[o(a).token?{name:"title",fn:h(()=>[o(a).token.tokenType==0?(d(),y("div",ut,[i(B,{class:"token-icon",tokenIcon:o(a).token.icon,chainIcon:o(ie)(o(a).token.chain)},null,8,["tokenIcon","chainIcon"]),_(" "+n(`${o(a).token.symbol} (${o(q)(o(a).token.address)})`),1)])):o(a).token.tokenType==1?(d(),y("div",kt,[i(B,{class:"token-icon",tokenIcon:o(j)(o(a).token.chain,o(a).token.tokenList[0].address)},null,8,["tokenIcon"]),i(B,{class:"token-icon",tokenIcon:o(j)(o(a).token.chain,o(a).token.tokenList[1].address)},null,8,["tokenIcon"]),_(" "+n(`${o(a).token.symbol} (${o(q)(o(a).token.address)})`),1)])):K("",!0)]),key:"0"}:{name:"title",fn:h(()=>[e("div",{class:"token-box",style:{color:"#999999"}},n(t.$t("pleaseSelectToken")),1)]),key:"1"}]),1024)]),_:1}),i(L,{inset:"",class:"form-item"},{default:h(()=>[e("div",vt,[e("div",null,n(o(w)("setNumberOfLock")),1),e("div",null,[_(n(`${o(w)("balance")}: `),1),e("span",null,n(O.value?O.value:"--"),1)])]),e("div",null,[i($e,{amount:S.value,"onUpdate:amount":s[2]||(s[2]=u=>S.value=u),total:O.value,decimals:o(a).token?o(a).token.decimals:0},null,8,["amount","total","decimals"])])]),_:1})],64)):(d(),y(I,{key:1},[i(L,{inset:"",class:"form-item"},{default:h(()=>[e("div",ft,[e("div",null,n(t.$t("enterTokenAddress")),1)]),e("div",null,[i(D,{class:"token-cell","model-value":g.value,"onUpdate:modelValue":s[3]||(s[3]=u=>ye(u)),placeholder:t.$t("contractAddress")},null,8,["model-value","placeholder"])])]),_:1}),i(L,{inset:"",class:"form-item"},{default:h(()=>[e("div",mt,[e("div",null,n(t.$t("enterTokenId")),1)]),e("div",null,[i(D,{class:"token-cell","model-value":l.value,"onUpdate:modelValue":s[4]||(s[4]=u=>_e(u)),placeholder:t.$t("forExample")},null,8,["model-value","placeholder"]),F.value?(d(),y("ul",pt,[e("li",wt,[e("div",ht,n(t.$t("transactionPairs")),1),e("div",yt,n(V.value?`${V.value.token0Symbol}/${V.value.token1Symbol}`:"--/--"),1)]),e("li",_t,[e("div",gt,n(t.$t("lockQuantity")),1),e("div",Ct,n(V.value?o(re).formatEther(V.value.liquidity.toString()):"--"),1)])])):K("",!0)])]),_:1})],64)),i(L,{inset:"",class:"form-item"},{default:h(()=>[e("div",$t,[e("div",null,n(t.$t("setDate")),1)]),e("div",null,[i(Le,{date:U.value,"onUpdate:date":s[5]||(s[5]=u=>U.value=u),showTools:""},null,8,["date"])])]),_:1})]),i(c),e("div",bt,[o(f).isConnectWallet?(d(),y(I,{key:0},[v.value?(d(),y(I,{key:0},[T.value?(d(),P(C,{key:0,class:"btn",type:"danger",onClick:ke,block:"",loading:r.value},{default:h(()=>[_(n(t.$t("approve")),1)]),_:1},8,["loading"])):(d(),P(C,{key:1,class:"btn",color:"#3F80F7",onClick:ve,block:"",loading:b.value},{default:h(()=>[_(n(t.$t("oneKeyLock")),1)]),_:1},8,["loading"]))],64)):(d(),y(I,{key:1},[H.value?(d(),P(C,{key:0,class:"btn",type:"danger",onClick:we,block:"",loading:r.value,disabled:!F.value},{default:h(()=>[_(n(t.$t("approve")),1)]),_:1},8,["loading","disabled"])):(d(),P(C,{key:1,class:"btn",color:"#3F80F7",onClick:he,block:"",loading:b.value,disabled:!F.value},{default:h(()=>[_(n(t.$t("oneKeyLock")),1)]),_:1},8,["loading","disabled"]))],64))],64)):(d(),P(C,{key:1,class:"btn",type:"primary",onClick:ue,block:""},{default:h(()=>[_(n(t.$t("connectWallet")),1)]),_:1}))])]),i(lt,{show:G.value,"onUpdate:show":s[6]||(s[6]=u=>G.value=u),isLockV2:v.value,positions:V.value,unlockDate:U.value,amount:S.value,showGas:Q.value,onConfirm:fe},null,8,["show","isLockV2","positions","unlockDate","amount","showGas"]),i(be,{show:W.value,"onUpdate:show":s[7]||(s[7]=u=>W.value=u),txHash:M.value,onClose:s[8]||(s[8]=u=>o(R).push("/lockMaster"))},null,8,["show","txHash"])],64)}}},Et=se(Lt,[["__scopeId","data-v-d0198a6f"]]);export{Et as default};
