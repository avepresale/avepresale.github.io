import{_ as B,u as Y,d as H,e as O,f as z,g as b,h as P,i as q,r as m,o as d,c as p,b as n,j as s,a as i,t as r,w as L,k as u,l as v,m as I,F as x,s as E,n as N,p as G,q as F,v as S,x as J,T as K,y as Q,z as X,A as C,B as Z,C as ee}from"./index-a6f40eeb.js";import{u as te}from"./create-beabff50.js";import{D as oe}from"./DropDown-27980a3a.js";const ne={class:"token-create"},se={class:"tools-bar"},ae={class:"left"},le={key:0,class:"address"},re={class:"address-text"},ie={style:{"margin-left":"6px"}},ce={class:"tools"},de={class:"token-box"},ue={class:"token"},pe={class:"title"},ve=["onClick"],ge={class:"content"},fe={class:"name"},me={class:"create-time"},ke={key:1,class:"no-data"},ye={class:"text"},he={class:"bottom-operate"},_e={class:"content"},Ce={__name:"Index",setup(we){const{t:W}=Y(),l=H(),T=O(),R=te(),D=z(),g=b(0),k=b(10),a=P({pageNumber:0,tokenList:[],loading:!1,finished:!1,error:!1,refreshing:!1}),y=b(!1);function M(){R.$reset(),D.push("/createToken/create/basicInfo")}async function A(){l.walletAddress||E(W("pleaseConnectWallet"));try{let e=await(await N.wallet.contractTokenFactory(T.tokenFactoryAddress)).totalOwnRecordsForUser(l.walletAddress);g.value=Number(e)}catch(t){console.error(t)}finally{a.refreshing=!1}}async function w(){a.loading=!0;let t=G({duration:0}),e=(a.pageNumber*k.value).toString(),h=(a.pageNumber*k.value+k.value-1).toString();try{let f=await(await N.wallet.contractTokenFactory(T.tokenFactoryAddress)).getOwnRecords(l.walletAddress,e,h);console.log(f);for(let c of f){let $={tokenAddress:c[6].toLowerCase(),createTime:Number(c[0]),symbol:c[4],name:c[3],deployerId:Number(c[5])};a.tokenList.push($)}f.length<k.value||g.value==Number(h)+1?a.finished=!0:a.pageNumber++}catch(_){a.error=!0,console.log(_)}finally{t.close(),a.loading=!1,a.refreshing=!1}}async function U(){a.pageNumber=0,a.tokenList=[],a.finished=!1,await A(),g.value>0&&(console.log(g.value),w())}function V(t,e){D.push("/createToken/manage/"+t+"/"+e)}return q(()=>{let t=setInterval(async()=>{l.isConnectWallet&&(clearInterval(t),await A(),g.value>0&&w())},100)}),(t,e)=>{const h=m("van-list"),_=m("van-image"),f=m("van-pull-refresh"),c=m("van-button"),$=m("van-dialog");return d(),p(x,null,[n("div",ne,[n("div",se,[n("div",ae,[n("div",{onClick:e[0]||(e[0]=o=>s(l).showSelectDapp=!0)},[i(u,{class:"icon",name:"menu"})]),s(l).isConnectWallet?(d(),p("div",le,[i(oe,{class:"switch-chain",onClick:e[1]||(e[1]=o=>s(l).showSelectChainPopup=!0),error:!s(l).chainId,logo:s(l).chainIcon,value:s(l).chain.toUpperCase()},null,8,["error","logo","value"]),n("div",re,r(s(F)(s(l).walletAddress)),1),i(u,{class:"copy-icon",name:"copy",onClick:e[2]||(e[2]=L(o=>s(S)(s(l).walletAddress),["stop"]))})])):(d(),p("div",{key:1,class:"address",onClick:e[3]||(e[3]=(...o)=>s(l).connectWallet&&s(l).connectWallet(...o))},[i(u,{class:"icon",name:"wallet"}),n("div",ie,r(t.$t("pleaseConnectWallet")),1)]))]),n("div",ce,[i(u,{class:"icon",name:"language",onClick:e[4]||(e[4]=o=>s(l).showLanguagePicker=!0)}),i(u,{class:"icon",name:"help",onClick:e[5]||(e[5]=o=>y.value=!0)})])]),n("div",de,[n("div",ue,[n("div",pe,r(t.$t("myToken")),1),i(f,{modelValue:a.refreshing,"onUpdate:modelValue":e[9]||(e[9]=o=>a.refreshing=o),"pulling-text":t.$t("pulling"),"loosing-text":t.$t("loosing"),"loading-text":t.$t("loading"),onRefresh:U},{default:v(()=>[a.tokenList.length>0?(d(),I(h,{key:0,class:"token-list","loading-text":t.$t("loading"),loading:a.loading,"onUpdate:loading":e[6]||(e[6]=o=>a.loading=o),finished:a.finished,"finished-text":t.$t("noMore"),error:a.error,"onUpdate:error":e[7]||(e[7]=o=>a.error=o),"error-text":t.$t("errorText"),onLoad:e[8]||(e[8]=o=>w())},{default:v(()=>[(d(!0),p(x,null,J(a.tokenList,o=>(d(),p("div",{class:"item",onClick:j=>V(o.deployerId,o.tokenAddress)},[n("div",null,[i(K,{class:"token-icon",tokenIcon:s(Q)(s(l).chain.toLowerCase(),o.tokenAddress.toLowerCase()),chainIcon:s(X)(s(l).chain.toLowerCase())},null,8,["tokenIcon","chainIcon"]),n("div",ge,[n("div",fe,[n("span",null,r(o.symbol),1),n("span",null,"（"+r(o.name)+"）",1)]),n("div",null,[C(r(s(F)(o.tokenAddress))+" ",1),i(u,{class:"copy-icon",name:"copy",onClick:L(j=>s(S)(o.tokenAddress),["stop"])},null,8,["onClick"])]),n("div",me,r(s(Z).unix(o.createTime).format("YYYY-MM-DD HH:mm:ss")),1)])]),n("div",null,[i(u,{class:"image",name:"arrow"})])],8,ve))),256))]),_:1},8,["loading-text","loading","finished","finished-text","error","error-text"])):(d(),p("div",ke,[i(_,{class:"image",src:"/assets/images/warn.png"}),n("div",ye,r(t.$t("noToken")),1)]))]),_:1},8,["modelValue","pulling-text","loosing-text","loading-text"])])]),n("div",he,[s(l).isConnectWallet?(d(),I(c,{key:0,type:"primary",round:"",block:"",class:"btn",onClick:M},{default:v(()=>[C(r(t.$t("createToken")),1)]),_:1})):(d(),I(c,{key:1,type:"primary",round:"",block:"",class:"btn",onClick:s(l).connectWallet},{default:v(()=>[C(r(t.$t("connectWallet")),1)]),_:1},8,["onClick"])),i(c,{type:"primary",round:"",block:"",plain:"",class:"btn"},{default:v(()=>[C(r(t.$t("viewTutorial")),1)]),_:1})])]),i($,{class:"help-dialog",show:y.value,title:t.$t("rulesDescription"),"confirm-button-text":t.$t("understand"),onConfirm:e[10]||(e[10]=o=>y.value=!1),onClose:e[11]||(e[11]=o=>y.value=!1),"close-on-click-overlay":""},{default:v(()=>[n("div",_e,[n("div",null,r(t.$t("rulesDescription1",{chains:s(ee)[s(l).dappType].chainList.map(o=>o.chain.toUpperCase()).join("/")})),1),n("div",null,r(t.$t("rulesDescription2")),1),n("div",null,r(t.$t("rulesDescription3")),1),n("div",null,r(t.$t("rulesDescription4")),1),n("div",null,r(t.$t("rulesDescription5")),1)])]),_:1},8,["show","title","confirm-button-text"])],64)}}},Te=B(Ce,[["__scopeId","data-v-4bb227ae"]]);export{Te as default};
