import{_ as E,Q as R,u as j,d as z,g as y,r as k,o as n,c,b as W,F as b,x as B,a as r,l as i,j as m,t as v,J as V,s as l,n as $,M as J,A as _,m as Q,q as T,k as G,w as K,v as P}from"./index-08da7f30.js";import{u as X}from"./manage-f091af6a.js";import{O as Y}from"./OperateSuccessDialog-55e338f0.js";import"./bignumber-3e8dfdf6.js";import"./units-2a23e6b5.js";const Z={class:"name-manage"},x={key:0,class:"err-info has-added"},ee={key:0,class:"operate"},se={key:1,class:"operate"},ae={key:2,class:"name-list"},te={key:0,class:"title"},de={class:"content"},le={__name:"WhitelistV1",emits:["operateSuccess"],setup(oe,{emit:re}){R();const{t:d}=j(),S=z(),t=X(),a=y([{addressAdd:"",isAdded:!1}]),h=y(!1),g=y([]),A=y(!1),L=y(""),w=y(!1);function N(s){return s&&s.trim()}function H(){a.value.push({addressAdd:"",isAdded:!1})}function U(s){a.value.splice(s,1)}async function M(s){a.value[s].addressAdd=a.value[s].addressAdd.trim();let e=a.value[s].addressAdd;if(a.value[s].isAdded=!1,!e)return;if(!/^0x[0-9a-fA-F]{40}(,\d*\.?\d+)?$/.test(e)){a.value[s].addressAdd="",l(d("addressWrong"));return}if(a.value.filter(f=>f.addressAdd.toLowerCase()==e.toLowerCase()).length>1&&(a.value[s].addressAdd="",l(d("addressHasEntered"))),t.deployerId==4){h.value=!0,A.value=!0;const f=await $.wallet.contract(t.tokenAddress,t.abi);console.log(f),await f._feeWhiteList(e)?a.value[s].isAdded=!0:a.value[s].isAdded=!1,h.value=!1,A.value=!1}else t.whiteList.findIndex(f=>f==e.toLowerCase())!=-1?a.value[s].isAdded=!0:a.value[s].isAdded=!1}async function I(){if(!S.isConnectWallet){l(d("pleaseConnectWallet"));return}let s=[];for(let e in a.value)a.value[e].addressAdd&&!a.value[e].isAdded&&s.push(a.value[e].addressAdd);if(s.length==0){l(d("enterAddressLimit"));return}h.value=!0;try{const e=await $.wallet.contract(t.tokenAddress,t.abi);console.log(e);const o=await e.setFeeWhiteList(s,!0);L.value=o.hash,w.value=!0,await o.wait(),t.deployerId!=4&&(await t.getWhiteList(t.tokenAddress),g.value=[]),a.value=[{addressAdd:"",isAdded:!1}],l({type:"success",message:d("addWhiteListSuccess")})}catch(e){e.info&&e.info.error&&e.info.error.code===4001?l(d("userCancelOperate")):e.error&&e.error.message&&e.error.message=="Canceled"?l(d("userCancelOperate")):l(d("addWhiteListFail"))}finally{h.value=!1}}async function F(){if(!S.isConnectWallet){l(d("pleaseConnectWallet"));return}let s=[];if(t.deployerId==4){for(let e in a.value)a.value[e].addressAdd&&a.value[e].isAdded&&s.push(a.value[e].addressAdd);if(s.length==0){l(d("enterRemoveAddressLimit"));return}}else if(s=g.value,s.length==0){l(d("selectAddressLimit"));return}A.value=!0;try{const e=await $.wallet.contract(t.tokenAddress,t.abi);console.log(e);const o=await e.setFeeWhiteList(s,!1);console.log(o),L.value=o.hash,w.value=!0,await o.wait(),t.deployerId!=4&&(await t.getWhiteList(t.tokenAddress),g.value=[]),a.value=[{addressAdd:"",isAdded:!1}],l({type:"success",message:d("removeWhiteListSuccess")})}catch(e){e.info&&e.info.error&&e.info.error.code===4001?l(d("userCancelOperate")):e.error&&e.error.message&&e.error.message=="Canceled"?l(d("userCancelOperate")):l(d("addWhiteListFail"))}finally{A.value=!1}}return(s,e)=>{const o=k("van-button"),f=k("van-field"),O=k("van-cell-group"),q=k("van-checkbox"),D=k("van-checkbox-group");return n(),c(b,null,[W("div",Z,[(n(!0),c(b,null,B(a.value,(p,u)=>(n(),c("div",{class:"address-item",key:u},[r(O,{inset:"",class:"address-input"},{default:i(()=>[r(f,{modelValue:a.value[u].addressAdd,"onUpdate:modelValue":C=>a.value[u].addressAdd=C,onBlur:C=>M(u),center:"",clearable:"",formatter:N,placeholder:m(d)("inputAddress")},J({_:2},[a.value.length>1?{name:"button",fn:i(()=>[r(o,{class:"add-btn",size:"mini",type:"primary",round:"",onClick:C=>U(u)},{default:i(()=>[_(v(s.$t("delete")),1)]),_:2},1032,["onClick"])]),key:"0"}:void 0]),1032,["modelValue","onUpdate:modelValue","onBlur","placeholder"])]),_:2},1024),a.value[u].addressAdd&&a.value[u].isAdded?(n(),c("div",x,v(s.$t("addressAdded")),1)):V("",!0)]))),128)),r(o,{class:"add-address",icon:"plus",type:"default",onClick:H},{default:i(()=>[_(v(s.$t("addAddress")),1)]),_:1}),m(t).deployerId==4?(n(),c("div",ee,[r(o,{type:"primary",class:"remove btn",loading:A.value,onClick:F},{default:i(()=>[_(v(s.$t("remove")),1)]),_:1},8,["loading"]),r(o,{type:"primary",class:"add btn",loading:h.value,onClick:I},{default:i(()=>[_(v(s.$t("add")),1)]),_:1},8,["loading"])])):(n(),c("div",se,[r(o,{type:"primary",class:"add btn",loading:h.value,onClick:I},{default:i(()=>[_(v(s.$t("add")),1)]),_:1},8,["loading"])])),m(t).deployerId!=4?(n(),c("div",ae,[m(t).whiteList.length>0?(n(),c("div",te,[W("span",null,v(s.$t("added")),1),r(o,{class:"remove",type:"primary",loading:A.value,onClick:F},{default:i(()=>[_(v(s.$t("remove")),1)]),_:1},8,["loading"])])):V("",!0),r(D,{class:"white-list",modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=p=>g.value=p),shape:"square"},{default:i(()=>[(n(!0),c(b,null,B(m(t).whiteList,(p,u)=>(n(),Q(q,{class:"item",key:u,name:p},{default:i(()=>[W("div",de,[_(v(m(T)(p))+" ",1),r(G,{class:"copy-icon",name:"copy",onClick:K(C=>m(P)(p),["stop"])},null,8,["onClick"])])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])])):V("",!0)]),r(Y,{show:w.value,"onUpdate:show":e[1]||(e[1]=p=>w.value=p),txHash:L.value},null,8,["show","txHash"])],64)}}},fe=E(le,[["__scopeId","data-v-310954da"]]);export{fe as default};
