import{I as Ce}from"./InputQty-0d85b546.js";import{O as $e,S as be}from"./OperateSuccessDialog-a20d0cd1.js";import{_ as ae,d as se,$ as le,r as F,o as c,m as N,l as h,b as e,t as a,c as w,j as t,a as i,z as ce,T as P,A as _,q as H,y as Y,I as K,F as T,a0 as ie,B as q,a2 as Le,N as Ae,O as Te,u as Ve,g as f,f as Ie,i as Se,M as x,n as k,a4 as b,C as De,G as ee,E as oe,p as te,H as Ee,a5 as Ne,L as Fe}from"./index-7bc3a2f9.js";import{B as ne}from"./bignumber-3e8dfdf6.js";const de=g=>(Ae("data-v-42769c3c"),g=g(),Te(),g),Oe={class:"ave-popup"},Be={class:"title"},Pe={class:"body"},Ue={class:"info"},Ge={class:"key"},Me={class:"value"},Re={key:0,class:"token"},We={key:1,class:"token"},qe={key:2,class:"token"},He={class:"key"},Ye={class:"value"},je={class:"item"},ze=de(()=>e("div",{class:"key"},"交易对",-1)),Ke={class:"value"},Qe={class:"item"},Je=de(()=>e("div",{class:"key"},"锁定数量",-1)),Xe={class:"value"},Ze={class:"key"},xe={class:"value"},eo={class:"key"},oo={class:"value"},to={class:"blue-font"},no={class:"key"},ao={class:"value"},so={class:"tips"},lo={__name:"LockConfirmPopup",props:{show:Boolean,showGas:String,amount:String,unlockDate:Date,isLockV2:Boolean,positions:Object},emits:["update:show","confirm"],setup(g,{emit:p}){const v=g,$=se(),l=le();function V(){p("confirm")}return(u,L)=>{const R=F("van-button"),m=F("van-popup");return c(),N(m,{show:g.show,"onUpdate:show":L[0]||(L[0]=n=>{p("update:show",n)}),round:"",closeable:"",position:"bottom"},{default:h(()=>[e("div",Oe,[e("div",Be,a(u.$t("lockConfirm")),1),e("div",Pe,[e("ul",Ue,[v.isLockV2?(c(),w(T,{key:0},[e("li",null,[e("div",Ge,a(u.$t("lockAssets")),1),e("div",Me,[t(l).token?t(l).token.tokenType==0?(c(),w("div",We,[i(P,{class:"token-icon",tokenIcon:t(l).token.icon,chainIcon:t(ce)(t(l).token.chain)},null,8,["tokenIcon","chainIcon"]),_(" "+a(`${t(l).token.symbol} (${t(H)(t(l).token.address)})`),1)])):t(l).token.tokenType==1?(c(),w("div",qe,[i(P,{class:"token-icon",tokenIcon:t(Y)(t(l).token.chain,t(l).token.tokenList[0].address)},null,8,["tokenIcon"]),i(P,{class:"token-icon",tokenIcon:t(Y)(t(l).token.chain,t(l).token.tokenList[1].address)},null,8,["tokenIcon"]),_(" "+a(`${t(l).token.symbol} (${t(H)(t(l).token.address)})`),1)])):K("",!0):(c(),w("div",Re," -- "))])]),e("li",null,[e("div",He,a(u.$t("lockNumber")),1),e("div",Ye,a(g.amount),1)])],64)):(c(),w(T,{key:1},[e("li",je,[ze,e("div",Ke,a(v.positions?`${v.positions.token0Symbol}/${v.positions.token1Symbol}`:"--/--"),1)]),e("li",Qe,[Je,e("div",Xe,a(v.positions?t(ie).formatEther(g.positions.liquidity.toString()):"--"),1)])],64)),e("li",null,[e("div",Ze,a(u.$t("contractChian")),1),e("div",xe,a(t($).chain.toUpperCase()),1)]),e("li",null,[e("div",eo,a(u.$t("unlockTime2")),1),e("div",oo,[e("span",null,a(t(q)(g.unlockDate).format("YYYY-MM-DD")),1),e("span",null,[_("("),e("span",to,a(u.$t("dayLeft",{day:t(Le)(v.unlockDate)})),1),_(")")])])]),e("li",null,[e("div",no,a(u.$t("gas")),1),e("div",ao,a(g.showGas?`${g.showGas} ${t($).chainCoinSymbol.toUpperCase()}`:"--"),1)])]),e("div",so,[e("div",null,a(u.$t("createTips1")),1),e("div",null,a(u.$t("createTips2")),1),e("div",null,a(u.$t("createTips3")),1)]),i(R,{class:"btn",type:"primary",block:"",onClick:V},{default:h(()=>[_(a(u.$t("confirmAndLock")),1)]),_:1})])])]),_:1},8,["show"])}}},co=ae(lo,[["__scopeId","data-v-42769c3c"]]);const io={class:"body"},ro={class:"tab"},uo={class:"form"},ko={class:"title token-title"},vo={key:0,class:"token-box"},fo={key:1,class:"token"},po={class:"title token-title"},mo={class:"title token-title"},yo={class:"title token-title"},ho={key:0,class:"info"},wo={class:"item"},_o={class:"key"},go={class:"value"},Co={class:"item"},$o={class:"key"},bo={class:"value"},Lo={class:"title token-title"},Ao={class:"tools"},To={__name:"Create",setup(g){const{t:p}=Ve(),v=f(!0),$=f(""),l=f(""),V=f(!1),u=f(!1),L=f(!1),R=Ie(),m=se(),n=le(),re=q().add(1,"day").endOf("day").toDate(),U=f(re),S=f(""),G=f(!1),Q=f(""),W=f(!1),M=f(""),O=f("");async function ue(){await m.connectWallet()}async function J(){if(n.token==null)return;if(n.token.address==k.wallet.MAIN_COIN_ADDRESS){V.value=!1;return}await k.wallet.isAllowanceEnough(n.tokenLockV2Address,n.token.address,m.walletAddress)?V.value=!1:V.value=!0}async function ke(){if(u.value=!0,v.value)try{let o=await k.wallet.approveMaxAmount(n.token.address,n.tokenLockV2Address);console.log(o),await o.wait(),V.value=!1}catch(o){console.log(o)}finally{u.value=!1}}async function ve(){L.value=!0,M.value="";try{if(!n.token){b(p("pleaseSelectToken"));return}if(!S.value){b(p("enterAmount"));return}let o=De[m.dappType].chainList.find(s=>s.chain==n.token.chain);if(!o){b(p("tokenChainNotSupport"));return}if(m.chain!=o.chain){b(p("switchTokenChain"));try{await k.wallet.switchNetwork(o.chainId)}catch{b(p("switchTokenChain"));return}return}if(ne(S.value).gt(ne(O.value))){b(p("balanceSlow"));return}if(await J(),V.value){b(p("approveFirst"));return}await X()}catch(o){console.log(o)}finally{L.value=!1}}async function X(){const o=await k.wallet.getGasPrice();let s;const d=q(U.value).endOf("day").unix();if(v.value){const y=n.token.address,D=await(await k.wallet.contractERC20(y)).decimals(),C=n.token.tokenType==1,r=ee(S.value,D);s=await(await k.wallet.contractTokenLockV2(n.tokenLockV2Address)).lock.estimateGas(m.walletAddress,y,C,r.toString(),d,"")}else s=await(await k.wallet.contractTokenLockV3(n.tokenLockV3Address)).lock.estimateGas(m.walletAddress,$.value,l.value,d,"");console.dir(s),Q.value=oe(s*o),G.value=!0}async function fe(){const o=te({message:"Loading...",forbidClick:!0,duration:0}),s=q(U.value).endOf("day").unix();if(v.value){const d=n.token.address,y=n.token.tokenType==1,D=await(await k.wallet.contractERC20(d)).decimals(),C=ee(S.value,D),r=await k.wallet.contractTokenLockV2(n.tokenLockV2Address);try{let E=await r.lock(m.walletAddress,d,y,C.toString(),s,"");console.dir(E),M.value=E.hash,W.value=!0,G.value=!1}catch(E){console.log(E)}finally{o.close()}}else{const d=await k.wallet.contractTokenLockV3(n.tokenLockV3Address);try{let y=await d.lock(m.walletAddress,$.value,l.value,s,"");console.dir(y),M.value=y.hash,W.value=!0,G.value=!1}catch(y){console.log(y)}finally{o.close()}}}function pe(){R.push("/lockMaster/selectToken")}async function me(){if(!n.token)return;const o=te({message:"Loading...",forbidClick:!0,duration:0});try{if(n.token.address==k.wallet.MAIN_COIN_ADDRESS){const d=await(await k.wallet.getEthersProvider()).getBalance(m.walletAddress);O.value=oe(d)}else{const s=await k.wallet.contractERC20(n.token.address),d=await s.decimals(),y=await s.balanceOf(m.walletAddress);O.value=Ee(y,d)}}catch(s){console.log(s),n.token=null}finally{o.close()}}Se(()=>{console.log("onMounted"),m.chainId>0&&m.isConnectWallet&&n.token&&(J(),me())});const j=f(!1),I=f(null);async function ye(){u.value=!0;try{await(await(await k.wallet.contractNFT($.value)).approve(n.tokenLockV3Address,l.value)).wait(),j.value=!1}catch(o){console.log(o)}finally{u.value=!1}}async function he(){L.value=!0,M.value="";try{await X()}catch(o){console.log(o)}finally{L.value=!1}}const B=f(!1),z=f(!1);async function we(){if(!$.value||!Ne($.value)){b(p("trueTokenFormat"));return}if(!l.value){b(p("trueTokenIDFormat"));return}z.value=!0;try{const o=await k.wallet.contractNFT($.value);let s;try{s=await o.ownerOf(l.value)}catch(ge){console.error(ge),b(p("trueTokenAddressIDFormat"));return}if(s.toLowerCase()!=m.walletAddress){b(p("notOwnToken"));return}const d=await o.positions(l.value),y=d[2],A=d[3],C=await(await k.wallet.contractERC20(y)).symbol(),E=await(await k.wallet.contractERC20(A)).symbol();I.value={token0:d[2],token0Symbol:C,token1:d[3],token1Symbol:E,liquidity:d[7]},B.value=!0;const _e=await o.getApproved(l.value);j.value=_e.toLowerCase()!=n.tokenLockV3Address.toLowerCase()}catch(o){console.log(o)}finally{z.value=!1}}function Z(o){v.value!=o&&(v.value=o,B.value=!1,I.value=null)}return(o,s)=>{const d=F("van-divider"),y=F("van-cell"),A=F("van-cell-group"),D=F("van-field"),C=F("van-button");return c(),w(T,null,[e("div",io,[e("ul",ro,[e("li",{class:x({"tab-select":v.value}),onClick:s[0]||(s[0]=r=>Z(!0))},a(o.$t("tokenOrLP(V2)")),3),e("li",{class:x({"tab-select":!v.value}),onClick:s[1]||(s[1]=r=>Z(!1))},"LP(uniV3)",2)]),i(d),e("div",uo,[v.value?(c(),w(T,{key:0},[i(A,{inset:"",class:"form-item"},{default:h(()=>[e("div",ko,a(o.$t("selectToken2")),1),i(y,{"is-link":"",class:"token-cell",onClick:pe},Fe({_:2},[t(n).token?{name:"title",fn:h(()=>[t(n).token.tokenType==0?(c(),w("div",vo,[i(P,{class:"token-icon",tokenIcon:t(n).token.icon,chainIcon:t(ce)(t(n).token.chain)},null,8,["tokenIcon","chainIcon"]),_(" "+a(`${t(n).token.symbol} (${t(H)(t(n).token.address)})`),1)])):t(n).token.tokenType==1?(c(),w("div",fo,[i(P,{class:"token-icon",tokenIcon:t(Y)(t(n).token.chain,t(n).token.tokenList[0].address)},null,8,["tokenIcon"]),i(P,{class:"token-icon",tokenIcon:t(Y)(t(n).token.chain,t(n).token.tokenList[1].address)},null,8,["tokenIcon"]),_(" "+a(`${t(n).token.symbol} (${t(H)(t(n).token.address)})`),1)])):K("",!0)]),key:"0"}:{name:"title",fn:h(()=>[e("div",{class:"token-box",style:{color:"#999999"}},a(o.$t("pleaseSelectToken")),1)]),key:"1"}]),1024)]),_:1}),i(A,{inset:"",class:"form-item"},{default:h(()=>[e("div",po,[e("div",null,a(t(p)("setNumberOfLock")),1),e("div",null,[_(a(`${t(p)("balance")}: `),1),e("span",null,a(O.value?O.value:"--"),1)])]),e("div",null,[i(Ce,{amount:S.value,"onUpdate:amount":s[2]||(s[2]=r=>S.value=r),total:O.value,decimals:t(n).token?t(n).token.decimals:0},null,8,["amount","total","decimals"])])]),_:1})],64)):(c(),w(T,{key:1},[i(A,{inset:"",class:"form-item"},{default:h(()=>[e("div",mo,[e("div",null,a(o.$t("enterTokenAddress")),1)]),e("div",null,[i(D,{class:"token-cell",modelValue:$.value,"onUpdate:modelValue":s[3]||(s[3]=r=>$.value=r),placeholder:o.$t("contractAddress"),disabled:B.value},null,8,["modelValue","placeholder","disabled"])])]),_:1}),i(A,{inset:"",class:"form-item"},{default:h(()=>[e("div",yo,[e("div",null,a(o.$t("enterTokenId")),1)]),e("div",null,[i(D,{class:"token-cell",modelValue:l.value,"onUpdate:modelValue":s[4]||(s[4]=r=>l.value=r),placeholder:o.$t("forExample"),disabled:B.value},null,8,["modelValue","placeholder","disabled"]),B.value?(c(),w("ul",ho,[e("li",wo,[e("div",_o,a(o.$t("transactionPairs")),1),e("div",go,a(I.value?`${I.value.token0Symbol}/${I.value.token1Symbol}`:"--/--"),1)]),e("li",Co,[e("div",$o,a(o.$t("lockQuantity")),1),e("div",bo,a(I.value?t(ie).formatEther(I.value.liquidity.toString()):"--"),1)])])):K("",!0)])]),_:1})],64)),i(A,{inset:"",class:"form-item"},{default:h(()=>[e("div",Lo,[e("div",null,a(o.$t("setDate")),1)]),e("div",null,[i(be,{date:U.value,"onUpdate:date":s[5]||(s[5]=r=>U.value=r),showTools:""},null,8,["date"])])]),_:1})]),i(d),e("div",Ao,[t(m).isConnectWallet?(c(),w(T,{key:0},[v.value?(c(),w(T,{key:0},[V.value?(c(),N(C,{key:0,class:"btn",type:"danger",onClick:ke,block:"",loading:u.value},{default:h(()=>[_(a(o.$t("approve")),1)]),_:1},8,["loading"])):(c(),N(C,{key:1,class:"btn",color:"#3F80F7",onClick:ve,block:"",loading:L.value},{default:h(()=>[_(a(o.$t("oneKeyLock")),1)]),_:1},8,["loading"]))],64)):(c(),w(T,{key:1},[B.value?(c(),w(T,{key:1},[j.value?(c(),N(C,{key:0,class:"btn",type:"danger",onClick:ye,block:"",loading:u.value},{default:h(()=>[_(a(o.$t("approve")),1)]),_:1},8,["loading"])):(c(),N(C,{key:1,class:"btn",color:"#3F80F7",onClick:he,block:"",loading:L.value},{default:h(()=>[_(a(o.$t("oneKeyLock")),1)]),_:1},8,["loading"]))],64)):(c(),N(C,{key:0,class:"btn",color:"#3F80F7",onClick:we,block:"",loading:z.value},{default:h(()=>[_(a(o.$t("verifyToken")),1)]),_:1},8,["loading"]))],64))],64)):(c(),N(C,{key:1,class:"btn",type:"primary",onClick:ue,block:""},{default:h(()=>[_(a(o.$t("connectWallet")),1)]),_:1}))])]),i(co,{show:G.value,"onUpdate:show":s[6]||(s[6]=r=>G.value=r),isLockV2:v.value,positions:I.value,unlockDate:U.value,amount:S.value,showGas:Q.value,onConfirm:fe},null,8,["show","isLockV2","positions","unlockDate","amount","showGas"]),i($e,{show:W.value,"onUpdate:show":s[7]||(s[7]=r=>W.value=r),txHash:M.value,onClose:s[8]||(s[8]=r=>t(R).push("/lockMaster"))},null,8,["show","txHash"])],64)}}},Eo=ae(To,[["__scopeId","data-v-0a5ae0ba"]]);export{Eo as default};
