import{_ as P,d as E,a0 as M,u as O,g as h,B as u,E as Y,r as T,o as f,c as g,a as r,l as V,b as e,t as n,T as b,j as d,y as S,A as p,q as A,z as U,a3 as j,a1 as q,K as z,F as K,p as x,n as k,s as B,N as C}from"./index-25ac7233.js";import{S as J,O as Q}from"./OperateSuccessDialog-5890cf86.js";const R={class:"ave-popup"},W={class:"title"},X={class:"body"},Z={key:0,class:"info"},oo={class:"key"},eo={class:"value"},ao={key:0,class:"token"},to={key:1,class:"token"},so={class:"key"},no={class:"value"},lo={class:"blue-font"},co={class:"key"},io={class:"value"},uo={class:"key"},ro={class:"value"},ko={class:"select-date"},vo={class:"key"},ho={__name:"DelayPopup",props:{show:Boolean,lockId:String,isLockV2:Boolean,isLpToken:Boolean,unlockDate:Number,tokenList:Array,symbol:String,address:String,chainCoinSymbol:String,amountString:String,chain:String,decimals:Number},emits:["update:show","success"],setup(I,{emit:v}){const o=I,L=E(),m=M(),{t:$}=O(),s=h(0n),y=h(u.unix(o.unlockDate).toDate()),_=h(""),w=h(!1),D=h("");async function F(){console.log("estimateGas");const a=u.unix(o.unlockDate).add(1,"day").unix(),l=await k.wallet.getGasPrice(),c=await k.wallet.getBalance(L.walletAddress);console.log("balance",c);let t;if(o.isLockV2){const i=await k.wallet.contractTokenLockV2(m.tokenLockV2Address);if(s.value=await i.editFee(),c<s.value){B($("balanceSlow2",{chainMianCoin:L.chainCoinSymbol,amount:C(s.value)})),v("update:show",!1);return}t=await i.editLock.estimateGas(o.lockId,0n,a,{value:s.value})}else{const i=await k.wallet.contractTokenLockV3(m.tokenLockV3Address);if(s.value=await i.editFee(),c<s.value){B($("balanceSlow2",{chainMianCoin:L.chainCoinSymbol,amount:C(s.value)})),v("update:show",!1);return}t=await i.editLock.estimateGas(o.lockId,a,{value:s.value})}console.dir(t),_.value=C(t*l).toString(),console.log(_.value)}async function N(){const a=x({message:"Loading...",forbidClick:!0,duration:0}),l=u(y.value).unix();if(o.isLockV2){const c=await k.wallet.contractTokenLockV2(m.tokenLockV2Address);try{s.value=await c.editFee();let t=await c.editLock(o.lockId.toString(),0n,l,{value:s.value});console.dir(t),D.value=t.hash,w.value=!0}catch(t){console.log(t)}finally{a.close()}}else{const c=await k.wallet.contractTokenLockV3(m.tokenLockV3Address);try{s.value=await c.editFee();let t=await c.editLock(o.lockId.toString(),l,{value:s.value});console.dir(t),D.value=t.hash,w.value=!0}catch(t){console.log(t)}finally{a.close()}}}async function G(){const a=x({message:"Loading...",forbidClick:!0,duration:0});y.value=u.unix(o.unlockDate).add(1,"day").endOf("day").toDate(),await F(),a.close()}Y(()=>o.show,(a,l)=>{a&&G()});function H(){v("update:show",!1),v("success")}return(a,l)=>{const c=T("van-button"),t=T("van-popup");return f(),g(K,null,[r(t,{show:I.show,"onUpdate:show":l[1]||(l[1]=i=>{v("update:show",i)}),round:"",closeable:"",position:"bottom"},{default:V(()=>[e("div",R,[e("div",W,n(a.$t("delayLock")),1),e("div",X,[o.chain?(f(),g("ul",Z,[e("li",null,[e("div",oo,n(a.$t("lockAssets")),1),e("div",eo,[o.isLpToken?(f(),g("div",ao,[r(b,{class:"token-icon",tokenIcon:d(S)(o.chain,o.tokenList[0].address)},null,8,["tokenIcon"]),r(b,{class:"token-icon",tokenIcon:d(S)(o.chain,o.tokenList[1].address)},null,8,["tokenIcon"]),p(" "+n(`${o.symbol} (${d(A)(o.address)})`),1)])):(f(),g("div",to,[r(b,{class:"token-icon",tokenIcon:d(S)(o.chain,o.address),chainIcon:d(U)(o.chain)},null,8,["tokenIcon","chainIcon"]),p(" "+n(`${o.symbol} (${d(A)(o.address)})`),1)]))])]),e("li",null,[e("div",so,n(a.$t("unlockTime")),1),e("div",no,[e("span",null,n(d(u).unix(o.unlockDate).format("YYYY-MM-DD HH:mm:ss")),1),e("span",null,[p("("),e("span",lo,n(a.$t("dayLeft",{day:d(j)(d(u).unix(o.unlockDate).toDate())})),1),p(")")])])]),e("li",null,[e("div",co,n(a.$t("editFee")),1),e("div",io,n(`${s.value?d(q).formatEther(s.value):"--"} ${o.chainCoinSymbol}`),1)]),e("li",null,[e("div",uo,n(a.$t("gas")),1),e("div",ro,n(`${_.value?_.value:"--"} ${o.chainCoinSymbol}`),1)])])):z("",!0),e("div",ko,[e("div",vo,n(a.$t("setDelayDate")),1),r(J,{date:y.value,"onUpdate:date":l[0]||(l[0]=i=>y.value=i),"min-date":d(u).unix(o.unlockDate).add(1,"day").endOf("day").toDate()},null,8,["date","min-date"])]),r(c,{class:"btn",type:"primary",block:"",onClick:N},{default:V(()=>[p(n(a.$t("confirmAndLock")),1)]),_:1})])])]),_:1},8,["show"]),r(Q,{show:w.value,"onUpdate:show":l[2]||(l[2]=i=>w.value=i),txHash:D.value,onClose:H},null,8,["show","txHash"])],64)}}},yo=P(ho,[["__scopeId","data-v-1a4d7746"]]);export{yo as D};
