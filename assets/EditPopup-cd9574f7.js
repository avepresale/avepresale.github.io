import{_ as W,d as J,W as K,u as Q,g as m,B as h,G as X,r as B,o as y,c as S,a as v,l as F,b as a,t as l,T as N,j as d,y as E,A as b,q as G,z as Z,Y as oo,I as U,F as ao,s as f,p as H,n as k,M as to,N as eo}from"./index-8e107324.js";import{S as no,O as so}from"./OperateSuccessDialog-071c4cd2.js";import{e as lo}from"./ethers-dca6ae8d.js";import{B as T}from"./bignumber-3e8dfdf6.js";import{a as M,f as co,b as x}from"./units-dd1853ad.js";const io=p=>(to("data-v-b5b46d13"),p=p(),eo(),p),uo={class:"ave-popup"},ro={class:"title"},ko={class:"body"},vo={key:0,class:"info"},mo={class:"key"},ho={class:"value"},po={key:0,class:"token"},wo={key:1,class:"token"},fo={class:"key"},go={class:"value"},_o={class:"blue-font"},yo={class:"key"},So={class:"value"},bo={class:"key"},Co={class:"value"},Lo={class:"select-date"},Do={class:"key"},Io={key:1,class:"change-amount"},Vo=io(()=>a("div",{class:"key"},"New Locked Amount (No less than previous locked amount)",-1)),To={__name:"EditPopup",props:{show:Boolean,lockId:String,isLockV2:Boolean,isLpToken:Boolean,unlockDate:Number,tokenList:Array,symbol:String,address:String,chainCoinSymbol:String,amountString:String,chain:String,decimals:Number},emits:["update:show","success"],setup(p,{emit:w}){const o=p,C=J(),L=K(),{t:g}=Q(),n=m(0n),_=m(h.unix(o.unlockDate).toDate()),c=m(o.amountString),$=m(""),D=m(""),I=m(!1),A=m("");async function O(){const e=await(await k.wallet.contractERC20(o.address)).balanceOf(C.walletAddress);$.value=co(e,o.decimals),console.log("value:"+$.value),e==0n&&(f(g("balanceSlow")),w("update:show",!1))}async function P(){console.log("estimateGas");const t=h.unix(o.unlockDate).add(1,"day").unix(),e=await k.wallet.getGasPrice(),i=await k.wallet.getBalance(C.walletAddress);console.log("balance",i);let s;if(o.isLockV2){const r=await k.wallet.contractTokenLockV2(L.tokenLockV2Address),V=await(await k.wallet.contractERC20(o.address)).decimals(),z=M(o.amountString,V);if(n.value=await r.editFee(),i<n.value){f(g("balanceSlow2",{chainMianCoin:C.chainCoinSymbol,amount:x(n.value)})),w("update:show",!1);return}s=await r.editLock.estimateGas(o.lockId,z.toString(),t,{value:n.value})}else{const r=await k.wallet.contractTokenLockV3(L.tokenLockV3Address);if(n.value=await r.editFee(),i<n.value){f(g("balanceSlow2",{chainMianCoin:C.chainCoinSymbol,amount:x(n.value)})),w("update:show",!1);return}s=await r.editLock.estimateGas(o.lockId,t,{value:n.value})}console.dir(s),D.value=x(s*e).toString(),console.log(D.value)}function Y(){console.log(c.value),(T(c.value).lt(o.amountString)||!c.value)&&(c.value=o.amountString)}async function R(){if(!_.value){f(g("selectUnlockTime"));return}if(T(c.value).lt(o.amountString)||!c.value){f("新的锁定值必须大于之前的锁定值");return}if(T(c.value).minus(o.amountString).gt(T($.value))){f(o.symbol+g("balanceSlow"));return}const t=H({message:"Loading...",forbidClick:!0,duration:0}),e=h(_.value).unix();if(o.isLockV2){const i=await k.wallet.contractTokenLockV2(L.tokenLockV2Address);try{const r=await(await k.wallet.contractERC20(o.address)).decimals(),u=M(c.value,r);console.log(u),n.value=await i.editFee();let V=await i.editLock(o.lockId.toString(),u.toString(),e,{value:n.value});console.dir(V),A.value=V.hash,I.value=!0}catch(s){console.log(s)}finally{t.close()}}else{const i=await k.wallet.contractTokenLockV3(L.tokenLockV3Address);try{n.value=await i.editFee();let s=await i.editLock(o.lockId.toString(),e,{value:n.value});console.dir(s),A.value=s.hash,I.value=!0}catch(s){console.log(s)}finally{t.close()}}}async function j(){const t=H({message:"Loading...",forbidClick:!0,duration:0});_.value=h.unix(o.unlockDate).add(1,"day").endOf("day").toDate(),c.value=o.amountString,await O(),await P(),t.close()}X(()=>o.show,(t,e)=>{t&&j()});function q(){w("update:show",!1),w("success")}return(t,e)=>{const i=B("van-field"),s=B("van-button"),r=B("van-popup");return y(),S(ao,null,[v(r,{show:p.show,"onUpdate:show":e[2]||(e[2]=u=>{w("update:show",u)}),round:"",closeable:"",position:"bottom"},{default:F(()=>[a("div",uo,[a("div",ro,l(t.$t("delayLock")),1),a("div",ko,[o.chain?(y(),S("ul",vo,[a("li",null,[a("div",mo,l(t.$t("lockAssets")),1),a("div",ho,[o.isLpToken?(y(),S("div",po,[v(N,{class:"token-icon",tokenIcon:d(E)(o.chain,o.tokenList[0].address)},null,8,["tokenIcon"]),v(N,{class:"token-icon",tokenIcon:d(E)(o.chain,o.tokenList[1].address)},null,8,["tokenIcon"]),b(" "+l(`${o.symbol} (${d(G)(o.address)})`),1)])):(y(),S("div",wo,[v(N,{class:"token-icon",tokenIcon:d(E)(o.chain,o.address),chainIcon:d(Z)(o.chain)},null,8,["tokenIcon","chainIcon"]),b(" "+l(`${o.symbol} (${d(G)(o.address)})`),1)]))])]),a("li",null,[a("div",fo,l(t.$t("unlockTime")),1),a("div",go,[a("span",null,l(d(h).unix(o.unlockDate).format("YYYY-MM-DD HH:mm:ss")),1),a("span",null,[b("("),a("span",_o,l(t.$t("dayLeft",{day:d(oo)(d(h).unix(o.unlockDate).toDate())})),1),b(")")])])]),a("li",null,[a("div",yo,l(t.$t("editFee")),1),a("div",So,l(`${n.value?d(lo).formatEther(n.value):"--"} ${o.chainCoinSymbol}`),1)]),a("li",null,[a("div",bo,l(t.$t("gas")),1),a("div",Co,l(`${D.value?D.value:"--"} ${o.chainCoinSymbol}`),1)])])):U("",!0),a("div",Lo,[a("div",Do,l(t.$t("setDelayDate")),1),v(no,{date:_.value,"onUpdate:date":e[0]||(e[0]=u=>_.value=u),"min-date":d(h).unix(o.unlockDate).add(1,"day").endOf("day").toDate()},null,8,["date","min-date"])]),o.isLockV2?(y(),S("div",Io,[Vo,v(i,{class:"amount",type:"number",modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=u=>c.value=u),onBlur:Y,placeholder:"请输入"},null,8,["modelValue"])])):U("",!0),v(s,{class:"btn",type:"primary",block:"",onClick:R},{default:F(()=>[b(l(t.$t("confirmAndLock")),1)]),_:1})])])]),_:1},8,["show"]),v(so,{show:I.value,"onUpdate:show":e[3]||(e[3]=u=>I.value=u),txHash:A.value,onClose:q},null,8,["show","txHash"])],64)}}},xo=W(To,[["__scopeId","data-v-b5b46d13"]]);export{xo as E};
