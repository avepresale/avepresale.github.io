import{b as p,O as u,Q as d,C as f}from"./index-6a51b356.js";import{f as n,B as h}from"./dayjs.min-c263b26c.js";const o=p(),N=u("presaleStore",{state:()=>({tokenAddress:"",tokenName:"",presaleData:[{list:[],loading:!1,pageNo:1,finished:!1,error:!1,refreshing:!1},{list:[],loading:!1,pageNo:1,finished:!1,error:!1,refreshing:!1},{list:[],loading:!1,pageNo:1,finished:!1,error:!1,refreshing:!1},{list:[],loading:!1,pageNo:1,finished:!1,error:!1,refreshing:!1}],myPresale:{list:[],loading:!1,pageNo:1,finished:!1,error:!1,refreshing:!1}}),actions:{getJoinedContractAddresses(e){let a=d.get("joinedContractAddressMap",{});return a[e]?a[e]:[]},setJoinedContractAddresses(e,a){let s=d.get("joinedContractAddressMap",{}),t=s[e]?s[e]:[];t.includes(a)||(t.push(a),s[e]=t,d.set("joinedContractAddressMap",s))},async getPresaleList(e){if(o.chainId==-1)throw"chainErr";let a,s=[];if(e==0)a=1;else if(e==1)a=3;else if(e==2){if(a=0,s=this.getJoinedContractAddresses(o.walletAddress),s.length==0)throw"noJoinedContractAddresses"}else e==3&&(a=2);this.presaleData[e].error=!1,this.presaleData[e].loading=!0;let t=10,r={chain:o.chain,pageNo:this.presaleData[e].pageNo,pageSize:t,tokenAddress:this.tokenAddress,tokenName:this.tokenName};r.joinedContractAddresses=s,r.type=a;try{const l=await f.presale.getPresaleList(JSON.stringify(r));if(l.status==1){for(let i of l.data.list){let g=await this.filterPresaleData(i,!1);this.presaleData[e].list.push(g)}l.data.list.length<t?this.presaleData[e].finished=!0:this.presaleData[e].pageNo++}else this.presaleData[e].error=!0}catch(l){console.log(l),this.presaleData[e].error=!0}finally{console.log(111),this.presaleData[e].loading=!1,this.presaleData[e].refreshing=!1}},async getMyCreatedPresaleList(){if(o.chainId==-1)return;let e=10;this.myPresale.error=!1,this.myPresale.loading=!0;let a={chain:o.chain,creator:o.walletAddress,pageNo:this.myPresale.pageNo,pageSize:e};try{const s=await f.presale.getMyCreatedPresaleList(a);if(s.status==1){for(let t of s.data.list){let r=await this.filterPresaleData(t,!0);this.myPresale.list.push(r)}s.data.list.length<e?this.myPresale.finished=!0:this.myPresale.pageNo++}else this.myPresale.error=!0}catch(s){console.log(s),this.myPresale.error=!0}finally{this.myPresale.loading=!1,this.myPresale.refreshing=!1}},async filterPresaleData(e,a){let s=n(e.hardCap,Number(e.baseTokenDecimal)),t=n(e.softCap,Number(e.baseTokenDecimal)),r=h(e.salePrice).div("1000000").toString(),l=n(e.saleAmount,Number(e.baseTokenDecimal)),i=n(await f.wallet.getCumulateAmount(e.contractAddress),Number(e.tokenDecimal));return{isMine:a,isEth:e.isEth,approveStatus:e.approveStatus,chain:o.chain,status:e.status,contractAddress:e.contractAddress,tokenAddress:e.tokenAddress,tokenName:e.tokenName,tokenSymbol:e.tokenSymbol,hardCap:s,softCap:t,baseTokenAddress:e.baseTokenAddress,baseTokenName:e.baseTokenName,contractChain:e.contractChain,baseTokenSymbol:e.baseTokenSymbol,baseTokenDecimal:e.baseTokenDecimal,startTime:e.startTime,endTime:e.endTime,endSaleTime:e.endSaleTime,salePrice:r,saleAmount:l,cumulateAmount:i,progressRate:h(i).div(s).multipliedBy(100).toNumber()}}}});export{N as u};
