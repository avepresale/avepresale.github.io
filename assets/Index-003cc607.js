import{D as P}from"./Dialog-76cc57c6.js";import{u as M,f as R,d as $,e as H,g as A,G as D,H as U,r as x,o as K,c as V,a as y,l as I,j as O,s as i,n as w,b,t as k,k as G,A as J,D as j,I as X,p as q,J as z}from"./index-e2f715e0.js";import{u as Q}from"./create-b01a5eb0.js";import{B as n}from"./bignumber-3e8dfdf6.js";import{p as L,a as d,f as Y}from"./units-b0961abc.js";/* empty css                                                       */const Z={class:"create"},ee=b("div",{class:"van-dialog__header"},null,-1),ae={class:"van-dialog__content"},te={class:"van-dialog__message van-dialog__message--has-title"},se=b("div",{style:{paddingTop:"20px"}},null,-1),ne={class:"create-success-title"},oe={class:"create-success-text"},le={class:"create-success-text"},be={__name:"Index",setup(re){const{t:l}=M(),T=R(),c=$(),S=H(),e=Q(),g=A(!1),N=A(!1),C=A(!1),_=A(!1);D(()=>e.deployerId,s=>{const o=j.createToken.chainList.find(a=>a.chain==c.chain);if(!o){e.baseFee=-1;return}console.dir(o);const r=o.deployerList.find(a=>a.deployerId==e.deployerId);if(!r){e.baseFee=-1;return}e.baseFee=r.baseFee});async function B(){console.log("createTokenClick");const s=/^0x[0-9a-fA-F]{40}(,\d*\.?\d+)?$/;if(c.chainId==-1){c.netErrorDialogShow=!0;return}if(e.deployerId===0||e.deployerId===1||e.deployerId===2){if(!e.name){i(l("pleaseEnterName"));return}if(!e.symbol){i(l("pleaseEnterSymbol"));return}if(!e.totalSupply){i(l("pleaseEnterTotal"));return}if(!e.decimals){i(l("pleaseEnterDecimals"));return}}if(e.deployerId===1||e.deployerId==2){if(!e.token){i(l("pleaseSelectCurrency"));return}if(!e.chainSwap){i(l("pleaseSelectSwap"));return}if(e.deployerId===1){if(n(e.buyFundFee).plus(e.buyBurnFee).plus(e.buyLPFee).plus(e.sellFundFee).plus(e.sellBurnFee).plus(e.sellLPFee).lte(0)){i(l("taxMustGt0"));return}}else if(e.deployerId===2){if(n(e.buyFundFee).plus(e.buyLPFee).plus(e.sellFundFee).plus(e.sellLPFee).lte(0)){i(l("taxlimit2"));return}}else if(e.deployerId===3){if(!e.rewardToken){i(l("dividendTokenError"));return}if(!s.test(e.rewardToken)){i(l("pleaseEnterTrueAddress"));return}if(n(e.buyFundFee).plus(e.buyLPFee).plus(e.buyRewardFee).plus(e.sellFundFee).plus(e.sellLPFee).plus(e.sellRewardFee).lte(0)){i(l("taxMustGt0"));return}}if((Number(e.buyFundFee)>0||Number(e.sellFundFee)>0)&&!e.fundAddress){i(l("pleaseEnterMarketingAddress"));return}if(e.fundAddress&&!s.test(e.fundAddress)){i(l("pleaseEnterTrueAddress"));return}if(e.enableKillBlock&&(!e.killBlock||Number(e.killBlock)<=0)){i(l("pleaseEnterKillBlockNumber"));return}if(e.enableWalletLimit&&(!e.maxWalletAmount||Number(e.maxWalletAmount)<=0)){i(l("pleaseEnterMaxWalletLimit"));return}if(e.enableSwapLimit&&(!e.maxSwapAmount||Number(e.maxSwapAmount)<=0)){i(l("pleaseEnterMaxSwapLimit"));return}}if(C.value=!0,e.baseFee<0)return;const o=L(e.baseFee.toString()),r=await w.wallet.getBalance(c.walletAddress);if(console.log("balance",r),r<o){i(l("balanceSlow2",{chainMianCoin:c.chainCoinSymbol,amount:e.baseFee})),C.value=!1;return}g.value=!0,C.value=!1}async function E(){_.value=!0;try{let s;S.v2?s=await w.wallet.contractTokenFactoryV2(S.tokenFactoryV2Address):s=await w.wallet.contractTokenFactory(S.tokenFactoryAddress);const o=[],r=[],a=[],t=[];if(e.deployerId==0)o[0]=e.name,o[1]=e.symbol,a[0]=parseInt(e.decimals),a[1]=d(e.totalSupply,parseInt(e.decimals)),t[0]=e.canMint;else if(e.deployerId==1){o[0]=e.name,o[1]=e.symbol;let u=e.token.tokenAddress,m=!1;u==="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"&&(u=(await(await w.wallet.contractSwap(e.chainSwap.routerAddress)).WETH()).toLowerCase(),m=!0),r[0]=u,r[1]=e.chainSwap.routerAddress,r[2]=c.walletAddress,r[3]=e.fundAddress?e.fundAddress:"0x0000000000000000000000000000000000000000",a[0]=parseInt(e.decimals),a[1]=d(e.totalSupply,parseInt(e.decimals)),a[2]=n(e.buyFundFee).times(100).toNumber(),a[3]=n(e.buyBurnFee).times(100).toNumber(),a[4]=n(e.buyLPFee).times(100).toNumber(),a[5]=n(e.sellFundFee).times(100).toNumber(),a[6]=n(e.sellBurnFee).times(100).toNumber(),a[7]=n(e.sellLPFee).times(100).toNumber(),a[8]=e.killBlock?n(e.killBlock).toNumber():0,a[9]=e.maxSwapAmount?d(e.maxSwapAmount,parseInt(e.decimals)):0n,a[10]=e.maxWalletAmount?d(e.maxWalletAmount,parseInt(e.decimals)):0n,t[0]=e.canMint,t[1]=m,t[2]=e.enableManualStartTrade,t[3]=e.enableKillBlock,t[4]=e.enableSwapLimit,t[5]=e.enableWalletLimit,t[6]=e.enableChangeTax,t[7]=e.enableWhiteList}else if(e.deployerId==2){o[0]=e.name,o[1]=e.symbol;let u=e.token.tokenAddress,m=!1;u==="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"&&(u=(await(await w.wallet.contractSwap(e.chainSwap.routerAddress)).WETH()).toLowerCase(),m=!0),r[0]=u,r[1]=e.chainSwap.routerAddress,r[2]=c.walletAddress,r[3]=e.fundAddress?e.fundAddress:"0x0000000000000000000000000000000000000000",a[0]=parseInt(e.decimals),a[1]=d(e.totalSupply,parseInt(e.decimals)),a[2]=n(e.buyFundFee).times(100).toNumber(),a[3]=n(e.buyRewardFee).times(100).toNumber(),a[4]=n(e.buyLPFee).times(100).toNumber(),a[5]=n(e.sellFundFee).times(100).toNumber(),a[6]=n(e.sellRewardFee).times(100).toNumber(),a[7]=n(e.sellLPFee).times(100).toNumber(),a[8]=e.killBlock?n(e.killBlock).toNumber():0,a[9]=e.maxSwapAmount?d(e.maxSwapAmount,parseInt(e.decimals)):0n,a[10]=e.maxWalletAmount?d(e.maxWalletAmount,parseInt(e.decimals)):0n,t[0]=m,t[1]=e.enableManualStartTrade,t[2]=e.enableKillBlock,t[3]=e.enableSwapLimit,t[4]=e.enableWalletLimit,t[5]=e.enableChangeTax,t[6]=e.enableWhiteList}else if(e.deployerId==3){o[0]=e.name,o[1]=e.symbol;let u=e.token.tokenAddress,m=!1;u==="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"&&(u=(await(await w.wallet.contractSwap(e.chainSwap.routerAddress)).WETH()).toLowerCase(),m=!0),r[0]=u,r[1]=e.chainSwap.routerAddress,r[2]=c.walletAddress,r[3]=e.fundAddress?e.fundAddress:"0x0000000000000000000000000000000000000000",r[4]=e.rewardToken,a[0]=parseInt(e.decimals),a[1]=d(e.totalSupply,parseInt(e.decimals)),a[2]=n(e.buyFundFee).times(100).toNumber(),a[3]=n(e.buyRewardFee).times(100).toNumber(),a[4]=n(e.buyLPFee).times(100).toNumber(),a[5]=n(e.sellFundFee).times(100).toNumber(),a[6]=n(e.sellRewardFee).times(100).toNumber(),a[7]=n(e.sellLPFee).times(100).toNumber(),a[8]=e.killBlock?n(e.killBlock).toNumber():0,a[9]=e.maxSwapAmount?d(e.maxSwapAmount,parseInt(e.decimals)):0n,a[10]=e.maxWalletAmount?d(e.maxWalletAmount,parseInt(e.decimals)):0n,t[0]=m,t[1]=e.enableManualStartTrade,t[2]=e.enableKillBlock,t[3]=e.enableSwapLimit,t[4]=e.enableWalletLimit,t[5]=e.enableChangeTax,t[6]=e.enableWhiteList,t[7]=e.canMint}else e.deployerId==4&&(o[0]=e.name,o[1]=e.symbol,r[0]=e.fundAddress?e.fundAddress:"0x0000000000000000000000000000000000000000",r[1]=e.rewardToken,r[2]=e.chainSwap.routerAddress,a[0]=e.maxSwapAmount?d(e.maxSwapAmount,parseInt(e.decimals)):0n,a[1]=e.maxWalletAmount?d(e.maxWalletAmount,parseInt(e.decimals)):0n,a[2]=n(e.buyFundFee).times(100).toNumber(),a[3]=n(e.buyLPFee).times(100).toNumber(),a[4]=n(e.buyRewardFee).times(100).toNumber(),a[5]=n(e.buyBurnFee).times(100).toNumber(),a[6]=n(e.sellFundFee).times(100).toNumber(),a[7]=n(e.sellLPFee).times(100).toNumber(),a[8]=n(e.sellRewardFee).times(100).toNumber(),a[9]=n(e.sellBurnFee).times(100).toNumber(),a[10]=d(e.totalSupply,parseInt(e.decimals)),a[11]=e.mustHoldNum?d(e.mustHoldNum,parseInt(e.decimals)):0n,a[12]=e.killBlock?n(e.killBlock).toNumber():0,t[0]=e.enableManualStartTrade,t[1]=e.enableKillBlock,t[2]=e.enableSwapLimit,t[3]=e.enableWalletLimit,t[4]=e.enableChangeTax,t[5]=e.enableWhiteList);const v=L(e.baseFee.toString());let p;if(S.v2){let u="0x0000000000000000000000000000000000000000";c.utm&&X(c.utm)&&(u=c.utm),console.log("create v2"),console.log(s),console.log(e.deployerId,u,o,r,a,t),p=await s.tokenCreate(e.deployerId,u,o,r,a,t,{value:v})}else console.log(e.deployerId,o,r,a,t),p=await s.tokenCreate(e.deployerId,o,r,a,t,{value:v});console.dir(p),e.txHash=p.hash;let h;c.chain=="core"&&(h=q({duration:0,forbidClick:!0,message:l("upChainNow")})),p.wait().then(async u=>{if(console.log("upChainSuccessfully"),console.log(u),u.status===1&&(i({type:"success",message:l("upChainSuccessfully")}),c.chain=="core")){h&&(h.message=l("verityContractNow")),console.log(u.logs);const m=u.logs.find(f=>f.fragment&&f.fragment.name=="TokenCreated");console.log(m);const F=m.args[1];console.log(F);try{const f=await w.coredao.verifysourcecode(e.deployerId,o,r,a,t,F);await z(500),await w.coredao.checkverifystatus(f),i({type:"success",message:l("verityContractSuccess")})}catch{i(l("verityContractFail"))}finally{h&&h.close()}}}),N.value=!0}catch(s){if(console.log(JSON.stringify(s)),s.info&&s.info.error&&s.info.error.code===4001)i(l("userCancelOperate"));else if(s.error&&s.error.message&&s.error.message=="Canceled")i(l("userCancelOperate"));else if(s.data&&s.data.code==-32e3){const o=s.data.message.match(/(\d+) want (\d+)/)[2];i(l("balanceSlow2",{chainMianCoin:lmStore.token.chainCoinSymbol,amount:Y(o)}))}else s.code==="INSUFFICIENT_FUNDS"?i(l("balanceSlow")):s.info&&s.info.error&&s.info.error.code==-32603&&s.info.error.data.message.endsWith("transfer amount exceeds balance")?i(l("balanceSlow2",{chainMianCoin:c.chainCoinSymbol,amount:e.baseFee})):s.code=="CALL_EXCEPTION"&&s.info.error.message.endsWith("transfer amount exceeds balance")?i(l("balanceSlow2",{chainMianCoin:c.chainCoinSymbol,amount:e.baseFee})):i(l("unkonwError"))}finally{g.value=!1,_.value=!1}}function W(){window.open(c.txBlockExplorerUrl+e.txHash,"_blank")}return e.init(),U(()=>{console.log("create before mounted"),e.token&&e.token.chain!=c.chain&&(e.token=null),e.chainSwap&&e.chainSwap.chain!=c.chain&&(e.chainSwap=null)}),(s,o)=>{const r=x("router-view"),a=x("van-action-bar-button"),t=x("van-action-bar"),v=x("van-popup");return K(),V("div",Z,[y(r,{onCreateTokenClick:B,createTokenLoading:C.value},null,8,["createTokenLoading"]),y(v,{show:g.value,"onUpdate:show":o[0]||(o[0]=p=>g.value=p),round:"",closeable:"",class:"van-dialog van-dialog--round-button","close-on-click-overlay":!1},{default:I(()=>[ee,b("div",ae,[b("div",te,[b("div",null,k(s.$t("createConfirmInfo")),1),se])]),y(t,{class:"van-dialog__footer"},{default:I(()=>[y(a,{type:"danger",loading:_.value,color:"#3F80F7",text:s.$t("confirmAndCreate"),class:"van-dialog__confirm",onClick:E},null,8,["loading","text"])]),_:1})]),_:1},8,["show"]),y(P,{show:N.value,"onUpdate:show":o[1]||(o[1]=p=>N.value=p),theme:"round-button",showCancelButton:!1,confirmButtonText:s.$t("enterTokenManagement"),onOnConfirm:o[2]||(o[2]=p=>O(T).push("/createToken"))},{default:I(()=>[b("div",null,[y(G,{name:"createSuccess",style:{width:"48px",height:"48px"}})]),b("div",ne,k(s.$t("createdSubmitted")),1),b("div",oe,[J(k(s.$t("inBrowser")),1),b("span",{class:"show",onClick:W},k(s.$t("view")),1)]),b("div",le,k(s.$t("waitToView")),1)]),_:1},8,["show","confirmButtonText"])])}}};export{be as default};
