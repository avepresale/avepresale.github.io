import{D as to,_ as so}from"./DelayPopup-f94bad9f.js";import{_ as Q,d as J,$ as K,u as W,g as y,I as eo,r as M,o as v,c as $,a as d,l as C,b as t,t as e,T as A,j as l,y as T,A as u,q as D,z as X,F as Z,a2 as H,p as V,n as m,G as x,E as Y,a3 as ao,h as no,i as lo,m as j,H as R,k as q,B as P,v as z,a1 as co,N as io,O as ro}from"./index-df1a018e.js";import{O as uo}from"./OperateSuccessDialog-05a7626a.js";import{I as mo}from"./InputQty-932d7f22.js";import{B as I}from"./bignumber-3e8dfdf6.js";const ko="/assets/images/time.png",po="/assets/images/add.png";const _o={class:"ave-popup"},ho={class:"title"},vo={class:"body"},yo={class:"info"},wo={class:"key"},go={class:"value"},bo={key:0,class:"token"},So={key:1,class:"token"},fo={class:"key"},Co={class:"value"},$o={class:"key"},Lo={class:"value"},Io={class:"key"},Do={class:"value"},Ao={style:{}},To={__name:"AppendLockPopup",props:{show:Boolean,lockId:String,isLpToken:Boolean,unlockDate:Number,tokenList:Array,symbol:String,address:String,chainCoinSymbol:String,amountString:String,chain:String,decimals:Number},emits:["update:show","success"],setup(w,{emit:g}){const s=w,L=J(),B=K(),{t:b}=W(),o=y(""),p=y(""),f=y(""),E=y(!1),U=y("");async function G(){const a=await(await m.wallet.contractERC20(s.address)).balanceOf(L.walletAddress);if(p.value=Y(a,s.decimals),console.log("value:"+p.value),a==0n)throw H(b("balanceSlow")),g("update:show",!1),"Blance Slow"}async function N(){const n=await m.wallet.contractLockMaster(B.lockContractAddress),_=await(await m.wallet.contractERC20(s.address)).decimals(),S=Y("1",_),r=I(s.amountString).plus(I(S)).toString(),F=x(r,_),h=await m.wallet.getGasPrice();let oo=await n.editLock.estimateGas(s.lockId.toString(),F.toString(),s.unlockDate);f.value=ao(oo*h).toString()}async function i(){if(!o.value){H(b("enterAmount"));return}if(I(o.value).gt(I(p.value))){H(b("balanceSlow"));return}const n=V({message:"Loading...",forbidClick:!0,duration:0}),a=await m.wallet.contractLockMaster(B.lockContractAddress),S=await(await m.wallet.contractERC20(s.address)).decimals(),r=I(s.amountString).plus(I(o.value)).toString();console.log(r);const F=x(r,S);try{let h=await a.editLock(s.lockId.toString(),F.toString(),s.unlockDate);console.dir(h),U.value=h.hash,E.value=!0}catch(h){console.log(h)}finally{n.close()}}eo(()=>s.show,(n,a)=>{n&&c()});async function c(){const n=V({message:"Loading...",forbidClick:!0,duration:0});try{await G(),await N()}catch(a){console.log(a)}finally{n.close()}}function k(){g("update:show",!1),g("success")}return(n,a)=>{const _=M("van-button"),S=M("van-popup");return v(),$(Z,null,[d(S,{show:w.show,"onUpdate:show":a[1]||(a[1]=r=>{g("update:show",r)}),round:"",closeable:"",position:"bottom"},{default:C(()=>[t("div",_o,[t("div",ho,e(n.$t("appendLock")),1),t("div",vo,[t("ul",yo,[t("li",null,[t("div",wo,e(n.$t("appendAssets")),1),t("div",go,[s.isLpToken?(v(),$("div",bo,[d(A,{class:"token-icon",tokenIcon:l(T)(s.chain,s.tokenList[0].address)},null,8,["tokenIcon"]),d(A,{class:"token-icon",tokenIcon:l(T)(s.chain,s.tokenList[1].address)},null,8,["tokenIcon"]),u(" "+e(`${s.symbol} (${l(D)(s.address)})`),1)])):(v(),$("div",So,[d(A,{class:"token-icon",tokenIcon:l(T)(s.chain,s.address),chainIcon:l(X)(s.chain)},null,8,["tokenIcon","chainIcon"]),u(" "+e(`${s.symbol} (${l(D)(s.address)})`),1)]))])]),t("li",null,[t("div",fo,e(n.$t("currentAmount")),1),t("div",Co,e(s.amountString),1)]),t("li",null,[t("div",$o,e(n.$t("balance")),1),t("div",Lo,e(`${p.value} ${s.symbol}`),1)]),t("li",null,[t("div",Io,e(n.$t("serviceFee")),1),t("div",Do,e(`${f.value?f.value:"--"} ${s.chainCoinSymbol}`),1)])]),t("div",Ao,[d(mo,{total:p.value,amount:o.value,"onUpdate:amount":a[0]||(a[0]=r=>o.value=r),decimals:s.decimals},null,8,["total","amount","decimals"])]),d(_,{class:"btn",type:"primary",block:"",onClick:i},{default:C(()=>[u(e(n.$t("confirmAndLock")),1)]),_:1})])])]),_:1},8,["show"]),d(uo,{show:E.value,"onUpdate:show":a[2]||(a[2]=r=>E.value=r),txHash:U.value,onClose:k},null,8,["show","txHash"])],64)}}},Eo=Q(To,[["__scopeId","data-v-6305ad40"]]);const O=w=>(io("data-v-0b45b071"),w=w(),ro(),w),Bo={key:0,class:"body"},Uo={key:0,class:"token"},No={key:1,class:"token"},Fo={class:"info"},Po={class:"item"},Ho={class:"key"},Mo={class:"value"},Yo={class:"item"},Go={class:"key"},Ro={class:"value"},Oo={class:"item"},Vo={class:"key"},xo={class:"value"},jo={class:"item"},qo={class:"key"},zo={class:"value"},Qo={class:"blue-font"},Jo={class:"item"},Ko={class:"key"},Wo={class:"value"},Xo={class:"item"},Zo={class:"key"},ot={class:"value"},tt={class:"footer"},st=O(()=>t("img",{src:so,alt:""},null,-1)),et=O(()=>t("img",{src:ko,alt:""},null,-1)),at=O(()=>t("img",{src:po,alt:""},null,-1)),nt={__name:"Detail",props:{lockId:String},setup(w){const g=w,{t:s}=W(),L=J(),B=K(),b=y(!1),o=no({id:g.lockId,address:"",amountString:"",tokenList:[],lockDate:0,unlockDate:0,isLpToken:!1,symbol:"",chain:"",isExpired:!1,chainCoinSymbol:"",decimals:0}),p=y(!1),f=y(!1);async function E(){b.value=!1;const i=await m.wallet.contractLockMaster(B.lockContractAddress);console.dir(i);let c;try{c=await i.getLockById(g.lockId)}catch{H(s("failedToGetDetail"));return}o.lockDate=Number(c[4]),o.unlockDate=Number(c[5]),o.address=c[1],o.owner=c[2],o.isExpired=P().unix()>=o.unlockDate,o.chain=L.chain,o.chainCoinSymbol=L.chainCoinSymbol;try{const k=await m.wallet.contractLP(o.address);let n=await k.decimals();o.decimals=n;let a=await k.token0(),S=await(await m.wallet.contractERC20(a)).symbol(),r=await k.token1(),h=await(await m.wallet.contractERC20(r)).symbol();o.isLpToken=!0,o.tokenList[0]={symbol:S.toUpperCase(),address:a.toLowerCase()},o.tokenList[1]={symbol:h.toUpperCase(),address:r.toLowerCase()},o.amountString=Y(c[3],n),o.symbol=`${S}/${h}`}catch{const n=await m.wallet.contractERC20(o.address);let a=await n.symbol(),_=await n.decimals();o.decimals=_,o.tokenList=[],o.isLpToken=!1,o.symbol=a.toUpperCase(),o.amountString=Y(c[3],_)}b.value=!0,console.log("getDetailDone")}function U(){console.log(o),p.value=!0}function G(){f.value=!0}function N(){window.location.reload()}return lo(()=>{E()}),y(!0),console.log(g.lockId),(i,c)=>{const k=M("van-button"),n=M("van-action-bar");return v(),$(Z,null,[b.value?(v(),$("div",Bo,[o.isLpToken?(v(),$("div",Uo,[d(A,{class:"token-icon",tokenIcon:l(T)(o.chain,o.tokenList[0].address)},null,8,["tokenIcon"]),d(A,{class:"token-icon",tokenIcon:l(T)(o.chain,o.tokenList[1].address)},null,8,["tokenIcon"]),u(" "+e(`${o.symbol} (${l(D)(o.address)})`),1)])):(v(),$("div",No,[o.address?(v(),j(A,{key:0,class:"token-icon",tokenIcon:l(T)(o.chain,o.address.toLowerCase()),chainIcon:l(X)(o.chain)},null,8,["tokenIcon","chainIcon"])):R("",!0),u(" "+e(`${o.symbol} (${l(D)(o.address)})`),1)])),t("ul",Fo,[t("li",Po,[t("div",Ho,e(i.$t("contractAddress")),1),t("div",Mo,[u(e(l(D)(o.address))+" ",1),d(q,{class:"copy-icon",name:"copy",onClick:c[0]||(c[0]=a=>l(z)(o.address))})])]),t("li",Yo,[t("div",Go,e(i.$t("contractChian")),1),t("div",Ro,e(o.chain.toUpperCase()),1)]),t("li",Oo,[t("div",Vo,e(`${o.symbol} ${i.$t("lockNumber")}`),1),t("div",xo,e(o.amountString),1)]),t("li",jo,[t("div",qo,e(i.$t("unlockTime2")),1),t("div",zo,[t("span",null,e(l(P).unix(o.unlockDate).format("YYYY-MM-DD HH:mm:ss")),1),t("span",null,[u("("),t("span",Qo,e(o.isExpired?i.$t("expired"):i.$t("dayLeft",{day:l(co)(l(P).unix(o.unlockDate).toDate())})),1),u(")")])])]),t("li",Jo,[t("div",Ko,e(i.$t("lockUser")),1),t("div",Wo,[u(e(l(D)(o.owner))+" ",1),d(q,{class:"copy-icon",name:"copy",onClick:c[1]||(c[1]=a=>l(z)(o.owner))})])]),t("li",Xo,[t("div",Zo,e(i.$t("lockTime")),1),t("div",ot,e(l(P).unix(o.lockDate).format("YYYY-MM-DD HH:mm:ss")),1)])])])):R("",!0),t("div",tt,[t("span",null,e(`${i.$t("technicalSupport")}:`),1),st]),!o.isExpired&&b.value&&l(L).walletAddress&&o.owner.toLowerCase()==l(L).walletAddress.toLowerCase()?(v(),j(n,{key:1,class:"tools"},{default:C(()=>[d(k,{class:"btn",color:"#9F3FF7",onClick:U},{icon:C(()=>[et]),default:C(()=>[u(e(i.$t("delay")),1)]),_:1}),d(k,{class:"btn",color:"#3F80F7",onClick:G},{icon:C(()=>[at]),default:C(()=>[u(e(i.$t("append")),1)]),_:1}),d(to,{show:p.value,"onUpdate:show":c[2]||(c[2]=a=>p.value=a),onSuccess:N,lockId:o.id,isLpToken:o.isLpToken,chain:o.chain,unlockDate:o.unlockDate,tokenList:o.tokenList,symbol:o.symbol,address:o.address,chainCoinSymbol:o.chainCoinSymbol,amountString:o.amountString,decimals:o.decimals},null,8,["show","lockId","isLpToken","chain","unlockDate","tokenList","symbol","address","chainCoinSymbol","amountString","decimals"]),d(Eo,{show:f.value,"onUpdate:show":c[3]||(c[3]=a=>f.value=a),onSuccess:N,lockId:o.id,isLpToken:o.isLpToken,chain:o.chain,unlockDate:o.unlockDate,tokenList:o.tokenList,symbol:o.symbol,address:o.address,chainCoinSymbol:o.chainCoinSymbol,amountString:o.amountString,decimals:o.decimals},null,8,["show","lockId","isLpToken","chain","unlockDate","tokenList","symbol","address","chainCoinSymbol","amountString","decimals"])]),_:1})):R("",!0)],64)}}},ut=Q(nt,[["__scopeId","data-v-0b45b071"]]);export{ut as default};
