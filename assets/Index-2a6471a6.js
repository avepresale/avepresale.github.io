import{D as M}from"./Dialog-bfffee1c.js";import{u as P,f as $,d as R,e as H,g,D as U,r as A,o as D,c as K,a as h,l as T,j as O,s as n,n as y,E as V,b as f,t as S,k as G,A as j,G as p,p as J,H as X}from"./index-d1e61d08.js";import{u as q}from"./create-5771f766.js";import{B as l}from"./bignumber-3e8dfdf6.js";/* empty css                                                       */const z={class:"create"},Q=f("div",{class:"van-dialog__header"},null,-1),Y={class:"van-dialog__content"},Z={class:"van-dialog__message van-dialog__message--has-title"},ee=f("div",{style:{paddingTop:"20px"}},null,-1),ae={class:"create-success-title"},te={class:"create-success-text"},oe={class:"create-success-text"},ue={__name:"Index",setup(se){const{t:s}=P(),B=$(),u=R(),L=H(),e=q(),v=g(!1),x=g(!1),C=g(!1),N=g(!1),_=g("");async function I(){console.log("createTokenClick");const t=/^0x[0-9a-fA-F]{40}(,\d*\.?\d+)?$/;if(u.chainId==-1){u.netErrorDialogShow=!0;return}if(e.deployerId===0||e.deployerId===1||e.deployerId===2){if(!e.name){n(s("pleaseEnterName"));return}if(!e.symbol){n(s("pleaseEnterSymbol"));return}if(!e.totalSupply){n(s("pleaseEnterTotal"));return}}if(e.deployerId===1||e.deployerId==2){if(!e.token){n(s("pleaseSelectCurrency"));return}if(!e.chainSwap){n(s("pleaseSelectSwap"));return}if(e.deployerId===1){if(l(e.buyFundFee).plus(e.buyBurnFee).plus(e.buyLPFee).plus(e.sellFundFee).plus(e.sellBurnFee).plus(e.sellLPFee).lte(0)){n(s("taxMustGt0"));return}}else if(e.deployerId===2){if(l(e.buyFundFee).plus(e.buyLPFee).plus(e.sellFundFee).plus(e.sellLPFee).lte(0)){n(s("taxlimit2"));return}}else if(e.deployerId===3){if(!e.rewardToken){n(s("dividendTokenError"));return}if(!t.test(e.rewardToken)){n(s("pleaseEnterTrueAddress"));return}if(l(e.buyFundFee).plus(e.buyLPFee).plus(e.buyRewardFee).plus(e.sellFundFee).plus(e.sellLPFee).plus(e.sellRewardFee).lte(0)){n(s("taxMustGt0"));return}}if((Number(e.buyFundFee)>0||Number(e.sellFundFee)>0)&&!e.fundAddress){n(s("pleaseEnterMarketingAddress"));return}if(e.fundAddress&&!t.test(e.fundAddress)){n(s("pleaseEnterTrueAddress"));return}if(e.enableKillBlock&&(!e.killBlock||Number(e.killBlock)<=0)){n(s("pleaseEnterKillBlockNumber"));return}if(e.enableWalletLimit&&(!e.maxWalletAmount||Number(e.maxWalletAmount)<=0)){n(s("pleaseEnterMaxWalletLimit"));return}if(e.enableSwapLimit&&(!e.maxSwapAmount||Number(e.maxSwapAmount)<=0)){n(s("pleaseEnterMaxSwapLimit"));return}}C.value=!0;let i=await(await y.wallet.contractTokenFactory(L.tokenFactoryAddress)).baseFee();console.log("baseFee",i),_.value=V(i);const r=await y.wallet.getBalance(u.walletAddress);if(console.log("balance",r),r<i){n(s("balanceSlow2",{chainMianCoin:u.chainCoinSymbol,amount:_.value})),C.value=!1;return}v.value=!0,C.value=!1}async function E(){N.value=!0;try{const t=await y.wallet.contractTokenFactory(L.tokenFactoryAddress);let d=await t.baseFee();const i=[],r=[],a=[],o=[];if(e.deployerId==0)i[0]=e.name,i[1]=e.symbol,a[0]=e.decimals,a[1]=p(e.totalSupply,e.decimals),o[0]=e.canMint;else if(e.deployerId==1){i[0]=e.name,i[1]=e.symbol;let c=e.token.tokenAddress,m=!1;c==="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"&&(c=(await(await y.wallet.contractSwap(e.chainSwap.routerAddress)).WETH()).toLowerCase(),m=!0),r[0]=c,r[1]=e.chainSwap.routerAddress,r[2]=u.walletAddress,r[3]=e.fundAddress?e.fundAddress:"0x0000000000000000000000000000000000000000",a[0]=e.decimals,a[1]=p(e.totalSupply,e.decimals),a[2]=l(e.buyFundFee).times(100).toNumber(),a[3]=l(e.buyBurnFee).times(100).toNumber(),a[4]=l(e.buyLPFee).times(100).toNumber(),a[5]=l(e.sellFundFee).times(100).toNumber(),a[6]=l(e.sellBurnFee).times(100).toNumber(),a[7]=l(e.sellLPFee).times(100).toNumber(),a[8]=e.killBlock?l(e.killBlock).toNumber():0,a[9]=e.maxSwapAmount?p(e.maxSwapAmount,e.decimals):0n,a[10]=e.maxWalletAmount?p(e.maxWalletAmount,e.decimals):0n,o[0]=e.canMint,o[1]=m,o[2]=e.enableManualStartTrade,o[3]=e.enableKillBlock,o[4]=e.enableSwapLimit,o[5]=e.enableWalletLimit,o[6]=e.enableChangeTax,o[7]=e.enableWhiteList}else if(e.deployerId==2){i[0]=e.name,i[1]=e.symbol;let c=e.token.tokenAddress,m=!1;c==="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"&&(c=(await(await y.wallet.contractSwap(e.chainSwap.routerAddress)).WETH()).toLowerCase(),m=!0),r[0]=c,r[1]=e.chainSwap.routerAddress,r[2]=u.walletAddress,r[3]=e.fundAddress?e.fundAddress:"0x0000000000000000000000000000000000000000",a[0]=e.decimals,a[1]=p(e.totalSupply,e.decimals),a[2]=l(e.buyFundFee).times(100).toNumber(),a[3]=l(e.buyRewardFee).times(100).toNumber(),a[4]=l(e.buyLPFee).times(100).toNumber(),a[5]=l(e.sellFundFee).times(100).toNumber(),a[6]=l(e.sellRewardFee).times(100).toNumber(),a[7]=l(e.sellLPFee).times(100).toNumber(),a[8]=e.killBlock?l(e.killBlock).toNumber():0,a[9]=e.maxSwapAmount?p(e.maxSwapAmount,e.decimals):0n,a[10]=e.maxWalletAmount?p(e.maxWalletAmount,e.decimals):0n,o[0]=m,o[1]=e.enableManualStartTrade,o[2]=e.enableKillBlock,o[3]=e.enableSwapLimit,o[4]=e.enableWalletLimit,o[5]=e.enableChangeTax,o[6]=e.enableWhiteList}else if(e.deployerId==3){i[0]=e.name,i[1]=e.symbol;let c=e.token.tokenAddress,m=!1;c==="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"&&(c=(await(await y.wallet.contractSwap(e.chainSwap.routerAddress)).WETH()).toLowerCase(),m=!0),r[0]=c,r[1]=e.chainSwap.routerAddress,r[2]=u.walletAddress,r[3]=e.fundAddress?e.fundAddress:"0x0000000000000000000000000000000000000000",r[4]=e.rewardToken,a[0]=e.decimals,a[1]=p(e.totalSupply,e.decimals),a[2]=l(e.buyFundFee).times(100).toNumber(),a[3]=l(e.buyRewardFee).times(100).toNumber(),a[4]=l(e.buyLPFee).times(100).toNumber(),a[5]=l(e.sellFundFee).times(100).toNumber(),a[6]=l(e.sellRewardFee).times(100).toNumber(),a[7]=l(e.sellLPFee).times(100).toNumber(),a[8]=e.killBlock?l(e.killBlock).toNumber():0,a[9]=e.maxSwapAmount?p(e.maxSwapAmount,e.decimals):0n,a[10]=e.maxWalletAmount?p(e.maxWalletAmount,e.decimals):0n,o[0]=m,o[1]=e.enableManualStartTrade,o[2]=e.enableKillBlock,o[3]=e.enableSwapLimit,o[4]=e.enableWalletLimit,o[5]=e.enableChangeTax,o[6]=e.enableWhiteList,o[7]=e.canMint}console.log(e.deployerId,i,r,a,o);const b=await t.tokenCreate(e.deployerId,i,r,a,o,{value:d});console.dir(b),e.txHash=b.hash;let F;u.chain=="core"&&(F=J({duration:0,forbidClick:!0,message:s("upChainNow")})),b.wait().then(async c=>{if(console.log("upChainSuccessfully"),console.log(c),c.status===1&&(n({type:"success",message:s("upChainSuccessfully")}),u.chain=="core")){F&&(F.message=s("verityContractNow")),console.log(c.logs);const m=c.logs.find(w=>w.fragment&&w.fragment.name=="TokenCreated");console.log(m);const k=m.args[1];console.log(k);try{const w=await y.coredao.verifysourcecode(e.deployerId,i,r,a,o,k);await y.coredao.checkverifystatus(w),n({type:"success",message:s("verityContractSuccess")})}catch{n(s("verityContractFail"))}finally{F&&F.close()}}}),x.value=!0}catch(t){if(console.log(JSON.stringify(t)),t.info&&t.info.error&&t.info.error.code===4001)n(s("userCancelOperate"));else if(t.error&&t.error.message&&t.error.message=="Canceled")n(s("userCancelOperate"));else if(t.data&&t.data.code==-32e3){const d=t.data.message.match(/(\d+) want (\d+)/)[2];n(s("balanceSlow2",{chainMianCoin:lmStore.token.chainCoinSymbol,amount:X(d)}))}else t.code==="INSUFFICIENT_FUNDS"?n(s("balanceSlow")):t.info&&t.info.error&&t.info.error.code==-32603&&t.info.error.data.message.endsWith("transfer amount exceeds balance")?n(s("balanceSlow2",{chainMianCoin:u.chainCoinSymbol,amount:_.value})):t.code=="CALL_EXCEPTION"&&t.info.error.message.endsWith("transfer amount exceeds balance")?n(s("balanceSlow2",{chainMianCoin:u.chainCoinSymbol,amount:_.value})):n(s("unkonwError"))}finally{v.value=!1,N.value=!1}}function W(){window.open(u.txBlockExplorerUrl+e.txHash,"_blank")}return U(()=>{console.log("create before mounted")}),(t,d)=>{const i=A("router-view"),r=A("van-action-bar-button"),a=A("van-action-bar"),o=A("van-popup");return D(),K("div",z,[h(i,{onCreateTokenClick:I,createTokenLoading:C.value},null,8,["createTokenLoading"]),h(o,{show:v.value,"onUpdate:show":d[0]||(d[0]=b=>v.value=b),round:"",closeable:"",class:"van-dialog van-dialog--round-button","close-on-click-overlay":!1},{default:T(()=>[Q,f("div",Y,[f("div",Z,[f("div",null,S(t.$t("createConfirmInfo")),1),ee])]),h(a,{class:"van-dialog__footer"},{default:T(()=>[h(r,{type:"danger",loading:N.value,color:"#3F80F7",text:t.$t("confirmAndCreate"),class:"van-dialog__confirm",onClick:E},null,8,["loading","text"])]),_:1})]),_:1},8,["show"]),h(M,{show:x.value,"onUpdate:show":d[1]||(d[1]=b=>x.value=b),theme:"round-button",showCancelButton:!1,confirmButtonText:t.$t("enterTokenManagement"),onOnConfirm:d[2]||(d[2]=b=>O(B).push("/createToken"))},{default:T(()=>[f("div",null,[h(G,{name:"createSuccess",style:{width:"48px",height:"48px"}})]),f("div",ae,S(t.$t("createdSubmitted")),1),f("div",te,[j(S(t.$t("inBrowser")),1),f("span",{class:"show",onClick:W},S(t.$t("view")),1)]),f("div",oe,S(t.$t("waitToView")),1)]),_:1},8,["show","confirmButtonText"])])}}};export{ue as default};
