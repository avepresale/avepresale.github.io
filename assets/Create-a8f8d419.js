import{I as $e}from"./InputQty-2ed7c9e9.js";import{O as be,S as Le}from"./OperateSuccessDialog-650b3f53.js";import{_ as se,d as le,a1 as ce,r as N,o as r,g as F,w as h,b as e,t as n,c as y,f as o,a as i,B as ie,T as B,C as _,i as Y,A as q,N as j,F as S,a2 as de,D as Q,a4 as Ae,u as Te,e as p,l as Ve,n as Se,E as ee,v as k,a6 as $,G as Ie,L as te,Q as oe,x as ne,M as De,P as Ee,a7 as Ne}from"./index-a59c7a36.js";import{B as ae}from"./bignumber-3e8dfdf6.js";const Oe={class:"ave-popup"},Pe={class:"title"},Fe={class:"body"},Be={class:"info"},Ue={class:"key"},Ge={class:"value"},Me={key:0,class:"token"},Re={key:1,class:"token"},We={key:2,class:"token"},Qe={class:"key"},Ye={class:"value"},qe={class:"item"},He={class:"key"},je={class:"value"},Ke={class:"item"},ze={class:"key"},Je={class:"value"},Xe={class:"key"},Ze={class:"value"},xe={class:"key"},et={class:"value"},tt={class:"blue-font"},ot={class:"key"},nt={class:"value"},at={class:"tips"},st={__name:"LockConfirmPopup",props:{show:Boolean,showGas:String,amount:String,unlockDate:Date,isLockV2:Boolean,positions:Object},emits:["update:show","confirm"],setup(A,{emit:w}){const v=A,g=le(),l=ce();function T(){w("confirm")}return(d,b)=>{const R=N("van-button"),f=N("van-popup");return r(),F(f,{show:A.show,"onUpdate:show":b[0]||(b[0]=a=>{w("update:show",a)}),round:"",closeable:"",position:"bottom"},{default:h(()=>[e("div",Oe,[e("div",Pe,n(d.$t("lockConfirm")),1),e("div",Fe,[e("ul",Be,[v.isLockV2?(r(),y(S,{key:0},[e("li",null,[e("div",Ue,n(d.$t("lockAssets")),1),e("div",Ge,[o(l).token?o(l).token.tokenType==0?(r(),y("div",Re,[i(B,{class:"token-icon",tokenIcon:o(l).token.icon,chainIcon:o(ie)(o(l).token.chain)},null,8,["tokenIcon","chainIcon"]),_(" "+n(`${o(l).token.symbol} (${o(Y)(o(l).token.address)})`),1)])):o(l).token.tokenType==1?(r(),y("div",We,[i(B,{class:"token-icon",tokenIcon:o(q)(o(l).token.chain,o(l).token.tokenList[0].address)},null,8,["tokenIcon"]),i(B,{class:"token-icon",tokenIcon:o(q)(o(l).token.chain,o(l).token.tokenList[1].address)},null,8,["tokenIcon"]),_(" "+n(`${o(l).token.symbol} (${o(Y)(o(l).token.address)})`),1)])):j("",!0):(r(),y("div",Me," -- "))])]),e("li",null,[e("div",Qe,n(d.$t("lockNumber")),1),e("div",Ye,n(A.amount),1)])],64)):(r(),y(S,{key:1},[e("li",qe,[e("div",He,n(d.$t("transactionPairs")),1),e("div",je,n(v.positions?`${v.positions.token0Symbol}/${v.positions.token1Symbol}`:"--/--"),1)]),e("li",Ke,[e("div",ze,n(d.$t("lockQuantity")),1),e("div",Je,n(v.positions?o(de).formatEther(A.positions.liquidity.toString()):"--"),1)])],64)),e("li",null,[e("div",Xe,n(d.$t("contractChian")),1),e("div",Ze,n(o(g).chain.toUpperCase()),1)]),e("li",null,[e("div",xe,n(d.$t("unlockTime2")),1),e("div",et,[e("span",null,n(o(Q)(A.unlockDate).format("YYYY-MM-DD")),1),e("span",null,[_("("),e("span",tt,n(d.$t("dayLeft",{day:o(Ae)(v.unlockDate)})),1),_(")")])])]),e("li",null,[e("div",ot,n(d.$t("gas")),1),e("div",nt,n(A.showGas?`${A.showGas} ${o(g).chainCoinSymbol.toUpperCase()}`:"--"),1)])]),e("div",at,[e("div",null,n(d.$t("createTips1")),1),e("div",null,n(d.$t("createTips2")),1),e("div",null,n(d.$t("createTips3")),1)]),i(R,{class:"btn",type:"primary",block:"",onClick:T},{default:h(()=>[_(n(d.$t("confirmAndLock")),1)]),_:1})])])]),_:1},8,["show"])}}},lt=se(st,[["__scopeId","data-v-5ab12648"]]);const ct={class:"body"},it={class:"tab"},dt={class:"form"},rt={class:"title token-title"},ut={key:0,class:"token-box"},kt={key:1,class:"token"},vt={class:"title token-title"},ft={class:"title token-title"},pt={class:"title token-title"},mt={key:0,class:"info"},wt={class:"item"},ht={class:"key"},yt={class:"value"},_t={class:"item"},gt={class:"key"},Ct={class:"value"},$t={class:"title token-title"},bt={class:"tools"},Lt={__name:"Create",setup(A){const{t:w}=Te(),v=p(!0),g=p(""),l=p(""),T=p(!1),d=p(!1),b=p(!1),R=Ve(),f=le(),a=ce(),re=Q().add(1,"day").endOf("day").toDate(),U=p(re),I=p(""),G=p(!1),K=p(""),W=p(!1),M=p(""),O=p("");async function ue(){await f.connectWallet()}async function z(){if(a.token==null)return;if(a.token.address==k.wallet.MAIN_COIN_ADDRESS){T.value=!1;return}await k.wallet.isAllowanceEnough(a.tokenLockV2Address,a.token.address,f.walletAddress)?T.value=!1:T.value=!0}async function ke(){if(d.value=!0,v.value)try{let t=await k.wallet.approveMaxAmount(a.token.address,a.tokenLockV2Address);console.log(t),await t.wait(),T.value=!1}catch(t){console.log(t)}finally{d.value=!1}}async function ve(){b.value=!0,M.value="";try{if(!a.token){$(w("pleaseSelectToken"));return}if(!I.value){$(w("enterAmount"));return}let t=Ie[f.dappType].chainList.find(s=>s.chain==a.token.chain);if(!t){$(w("tokenChainNotSupport"));return}if(f.chain!=t.chain){$(w("switchTokenChain"));try{await k.wallet.switchNetwork(t.chainId)}catch{$(w("switchTokenChain"));return}return}if(ae(I.value).gt(ae(O.value))){$(w("balanceSlow"));return}if(await z(),T.value){$(w("approveFirst"));return}await J()}catch(t){console.log(t)}finally{b.value=!1}}async function J(){const t=await k.wallet.getGasPrice();let s;const c=Q(U.value).endOf("day").unix();if(v.value){const m=a.token.address,D=await(await k.wallet.contractERC20(m)).decimals(),C=a.token.tokenType==1,u=te(I.value,D);s=await(await k.wallet.contractTokenLockV2(a.tokenLockV2Address)).lock.estimateGas(f.walletAddress,m,C,u.toString(),c,"")}else s=await(await k.wallet.contractTokenLockV3(a.tokenLockV3Address)).lock.estimateGas(f.walletAddress,g.value,l.value,c,"");console.dir(s),K.value=oe(s*t),G.value=!0}async function fe(){const t=ne({message:"Loading...",forbidClick:!0,duration:0}),s=Q(U.value).endOf("day").unix();if(v.value){const c=a.token.address,m=a.token.tokenType==1,D=await(await k.wallet.contractERC20(c)).decimals(),C=te(I.value,D),u=await k.wallet.contractTokenLockV2(a.tokenLockV2Address);try{let E=await u.lock(f.walletAddress,c,m,C.toString(),s,"");console.dir(E),M.value=E.hash,W.value=!0,G.value=!1}catch(E){console.log(E)}finally{t.close()}}else{const c=await k.wallet.contractTokenLockV3(a.tokenLockV3Address);try{let m=await c.lock(f.walletAddress,g.value,l.value,s,"");console.dir(m),M.value=m.hash,W.value=!0,G.value=!1}catch(m){console.log(m)}finally{t.close()}}}function pe(){R.push("/lockMaster/selectToken")}async function me(){if(!a.token)return;const t=ne({message:"Loading...",forbidClick:!0,duration:0});try{if(a.token.address==k.wallet.MAIN_COIN_ADDRESS){const c=await(await k.wallet.getEthersProvider()).getBalance(f.walletAddress);O.value=oe(c)}else{const s=await k.wallet.contractERC20(a.token.address),c=await s.decimals(),m=await s.balanceOf(f.walletAddress);O.value=De(m,c)}}catch(s){console.log(s),a.token=null}finally{t.close()}}Se(()=>{f.chainId>0&&f.isConnectWallet&&a.token&&(z(),me())});const H=p(!1),V=p(null);async function we(){d.value=!0;try{const t=await k.wallet.contractNFT(g.value);if((await t.ownerOf(l.value)).toLowerCase()!=f.walletAddress){$(w("notOwnToken"));return}await(await t.approve(a.tokenLockV3Address,l.value)).wait(),H.value=!1}catch(t){console.log(t)}finally{d.value=!1}}async function he(){b.value=!0,M.value="";try{if((await(await k.wallet.contractNFT(g.value)).ownerOf(l.value)).toLowerCase()!=f.walletAddress){$(w("notOwnToken"));return}await J()}catch(t){console.log(t)}finally{b.value=!1}}const P=p(!1),X=p(!1);async function Z(){if(P.value=!1,!(!g.value||!Ne(g.value))&&l.value){X.value=!0;try{const t=await k.wallet.contractNFT(g.value);let s;try{s=await t.ownerOf(l.value)}catch(Ce){console.error(Ce),$(w("trueTokenAddressIDFormat"));return}const c=await t.positions(l.value),m=c[2],L=c[3],C=await(await k.wallet.contractERC20(m)).symbol(),E=await(await k.wallet.contractERC20(L)).symbol();V.value={token0:c[2],token0Symbol:C,token1:c[3],token1Symbol:E,liquidity:c[7]};const ge=await t.getApproved(l.value);H.value=ge.toLowerCase()!=a.tokenLockV3Address.toLowerCase(),P.value=!0}catch(t){console.log(t)}finally{X.value=!1}}}function x(t){v.value!=t&&(v.value=t,P.value=!1,V.value=null)}function ye(t){g.value=t,Z()}function _e(t){l.value=t,Z()}return(t,s)=>{const c=N("van-divider"),m=N("van-cell"),L=N("van-cell-group"),D=N("van-field"),C=N("van-button");return r(),y(S,null,[e("div",ct,[e("ul",it,[e("li",{class:ee({"tab-select":v.value}),onClick:s[0]||(s[0]=u=>x(!0))},n(t.$t("tokenOrLP(V2)")),3),e("li",{class:ee({"tab-select":!v.value}),onClick:s[1]||(s[1]=u=>x(!1))},"LP(uniV3)",2)]),i(c),e("div",dt,[v.value?(r(),y(S,{key:0},[i(L,{inset:"",class:"form-item"},{default:h(()=>[e("div",rt,n(t.$t("selectToken2")),1),i(m,{"is-link":"",class:"token-cell",onClick:pe},Ee({_:2},[o(a).token?{name:"title",fn:h(()=>[o(a).token.tokenType==0?(r(),y("div",ut,[i(B,{class:"token-icon",tokenIcon:o(a).token.icon,chainIcon:o(ie)(o(a).token.chain)},null,8,["tokenIcon","chainIcon"]),_(" "+n(`${o(a).token.symbol} (${o(Y)(o(a).token.address)})`),1)])):o(a).token.tokenType==1?(r(),y("div",kt,[i(B,{class:"token-icon",tokenIcon:o(q)(o(a).token.chain,o(a).token.tokenList[0].address)},null,8,["tokenIcon"]),i(B,{class:"token-icon",tokenIcon:o(q)(o(a).token.chain,o(a).token.tokenList[1].address)},null,8,["tokenIcon"]),_(" "+n(`${o(a).token.symbol} (${o(Y)(o(a).token.address)})`),1)])):j("",!0)]),key:"0"}:{name:"title",fn:h(()=>[e("div",{class:"token-box",style:{color:"#999999"}},n(t.$t("pleaseSelectToken")),1)]),key:"1"}]),1024)]),_:1}),i(L,{inset:"",class:"form-item"},{default:h(()=>[e("div",vt,[e("div",null,n(o(w)("setNumberOfLock")),1),e("div",null,[_(n(`${o(w)("balance")}: `),1),e("span",null,n(O.value?O.value:"--"),1)])]),e("div",null,[i($e,{amount:I.value,"onUpdate:amount":s[2]||(s[2]=u=>I.value=u),total:O.value,decimals:o(a).token?o(a).token.decimals:0},null,8,["amount","total","decimals"])])]),_:1})],64)):(r(),y(S,{key:1},[i(L,{inset:"",class:"form-item"},{default:h(()=>[e("div",ft,[e("div",null,n(t.$t("enterTokenAddress")),1)]),e("div",null,[i(D,{class:"token-cell","model-value":g.value,"onUpdate:modelValue":s[3]||(s[3]=u=>ye(u)),placeholder:t.$t("contractAddress")},null,8,["model-value","placeholder"])])]),_:1}),i(L,{inset:"",class:"form-item"},{default:h(()=>[e("div",pt,[e("div",null,n(t.$t("enterTokenId")),1)]),e("div",null,[i(D,{class:"token-cell","model-value":l.value,"onUpdate:modelValue":s[4]||(s[4]=u=>_e(u)),placeholder:t.$t("forExample")},null,8,["model-value","placeholder"]),P.value?(r(),y("ul",mt,[e("li",wt,[e("div",ht,n(t.$t("transactionPairs")),1),e("div",yt,n(V.value?`${V.value.token0Symbol}/${V.value.token1Symbol}`:"--/--"),1)]),e("li",_t,[e("div",gt,n(t.$t("lockQuantity")),1),e("div",Ct,n(V.value?o(de).formatEther(V.value.liquidity.toString()):"--"),1)])])):j("",!0)])]),_:1})],64)),i(L,{inset:"",class:"form-item"},{default:h(()=>[e("div",$t,[e("div",null,n(t.$t("setDate")),1)]),e("div",null,[i(Le,{date:U.value,"onUpdate:date":s[5]||(s[5]=u=>U.value=u),showTools:""},null,8,["date"])])]),_:1})]),i(c),e("div",bt,[o(f).isConnectWallet?(r(),y(S,{key:0},[v.value?(r(),y(S,{key:0},[T.value?(r(),F(C,{key:0,class:"btn",type:"danger",onClick:ke,block:"",loading:d.value},{default:h(()=>[_(n(t.$t("approve")),1)]),_:1},8,["loading"])):(r(),F(C,{key:1,class:"btn",color:"#3F80F7",onClick:ve,block:"",loading:b.value},{default:h(()=>[_(n(t.$t("oneKeyLock")),1)]),_:1},8,["loading"]))],64)):(r(),y(S,{key:1},[H.value?(r(),F(C,{key:0,class:"btn",type:"danger",onClick:we,block:"",loading:d.value,disabled:!P.value},{default:h(()=>[_(n(t.$t("approve")),1)]),_:1},8,["loading","disabled"])):(r(),F(C,{key:1,class:"btn",color:"#3F80F7",onClick:he,block:"",loading:b.value,disabled:!P.value},{default:h(()=>[_(n(t.$t("oneKeyLock")),1)]),_:1},8,["loading","disabled"]))],64))],64)):(r(),F(C,{key:1,class:"btn",type:"primary",onClick:ue,block:""},{default:h(()=>[_(n(t.$t("connectWallet")),1)]),_:1}))])]),i(lt,{show:G.value,"onUpdate:show":s[6]||(s[6]=u=>G.value=u),isLockV2:v.value,positions:V.value,unlockDate:U.value,amount:I.value,showGas:K.value,onConfirm:fe},null,8,["show","isLockV2","positions","unlockDate","amount","showGas"]),i(be,{show:W.value,"onUpdate:show":s[7]||(s[7]=u=>W.value=u),txHash:M.value,onClose:s[8]||(s[8]=u=>o(R).push("/lockMaster"))},null,8,["show","txHash"])],64)}}},It=se(Lt,[["__scopeId","data-v-d0198a6f"]]);export{It as default};
