import{_ as W,d as J,W as K,u as Q,g as v,B as h,G as X,r as T,o as y,c as _,a as m,l as x,b as e,t as l,T as B,j as i,y as E,A as S,q as G,z as Z,Y as aa,I as U,F as ta,s as f,p as H,n as k}from"./index-55cc332b.js";import{S as ea,O as oa}from"./OperateSuccessDialog-2803b2e8.js";import{e as na}from"./ethers-72e13c17.js";import{B as V}from"./bignumber-3e8dfdf6.js";import{a as O,f as sa,b as F}from"./units-40866964.js";const la={class:"ave-popup"},ca={class:"title"},ia={class:"body"},ua={key:0,class:"info"},da={class:"key"},ra={class:"value"},ka={key:0,class:"token"},ma={key:1,class:"token"},va={class:"key"},ha={class:"value"},pa={class:"blue-font"},wa={class:"key"},fa={class:"value"},ga={class:"key"},ya={class:"value"},_a={class:"select-date"},Sa={class:"key"},ba={key:1,class:"change-amount"},La={class:"key"},Ca={__name:"EditPopup",props:{show:Boolean,lockId:String,isLockV2:Boolean,isLpToken:Boolean,unlockDate:Number,tokenList:Array,symbol:String,address:String,chainCoinSymbol:String,amountString:String,chain:String,decimals:Number},emits:["update:show","success"],setup(N,{emit:p}){const a=N,b=J(),L=K(),{t:w}=Q(),n=v(0n),g=v(h.unix(a.unlockDate).toDate()),u=v(a.amountString),$=v(""),C=v(""),D=v(!1),A=v("");async function P(){const o=await(await k.wallet.contractERC20(a.address)).balanceOf(b.walletAddress);$.value=sa(o,a.decimals),console.log("value:"+$.value),o==0n&&(f(w("balanceSlow")),p("update:show",!1))}async function Y(){console.log("estimateGas");const t=h.unix(a.unlockDate).add(1,"day").unix(),o=await k.wallet.getGasPrice(),c=await k.wallet.getBalance(b.walletAddress);console.log("balance",c);let s;if(a.isLockV2){const r=await k.wallet.contractTokenLockV2(L.tokenLockV2Address),I=await(await k.wallet.contractERC20(a.address)).decimals(),z=O(a.amountString,I);if(n.value=await r.editFee(),c<n.value){f(w("balanceSlow2",{chainMianCoin:b.chainCoinSymbol,amount:F(n.value)})),p("update:show",!1);return}s=await r.editLock.estimateGas(a.lockId,z.toString(),t,{value:n.value})}else{const r=await k.wallet.contractTokenLockV3(L.tokenLockV3Address);if(n.value=await r.editFee(),c<n.value){f(w("balanceSlow2",{chainMianCoin:b.chainCoinSymbol,amount:F(n.value)})),p("update:show",!1);return}s=await r.editLock.estimateGas(a.lockId,t,{value:n.value})}console.dir(s),C.value=F(s*o).toString(),console.log(C.value)}function M(){(V(u.value).lt(a.amountString)||!u.value)&&(u.value=a.amountString)}async function R(){if(!g.value){f(w("selectUnlockTime"));return}if(V(u.value).lt(a.amountString)||!u.value){f(w("newLockedAmountLimit"));return}if(V(u.value).minus(a.amountString).gt(V($.value))){f(a.symbol+w("balanceSlow"));return}const t=H({message:"Loading...",forbidClick:!0,duration:0}),o=h(g.value).unix();if(a.isLockV2){const c=await k.wallet.contractTokenLockV2(L.tokenLockV2Address);try{const r=await(await k.wallet.contractERC20(a.address)).decimals(),d=O(u.value,r);n.value=await c.editFee();let I=await c.editLock(a.lockId.toString(),d.toString(),o,{value:n.value});console.dir(I),A.value=I.hash,D.value=!0}catch(s){console.log(s)}finally{t.close()}}else{const c=await k.wallet.contractTokenLockV3(L.tokenLockV3Address);try{n.value=await c.editFee();let s=await c.editLock(a.lockId.toString(),o,{value:n.value});console.dir(s),A.value=s.hash,D.value=!0}catch(s){console.log(s)}finally{t.close()}}}async function j(){const t=H({message:"Loading...",forbidClick:!0,duration:0});g.value=h.unix(a.unlockDate).add(1,"day").endOf("day").toDate(),u.value=a.amountString,await P(),await Y(),t.close()}X(()=>a.show,(t,o)=>{t&&j()});function q(){p("update:show",!1),p("success")}return(t,o)=>{const c=T("van-field"),s=T("van-button"),r=T("van-popup");return y(),_(ta,null,[m(r,{show:N.show,"onUpdate:show":o[2]||(o[2]=d=>{p("update:show",d)}),round:"",closeable:"",position:"bottom"},{default:x(()=>[e("div",la,[e("div",ca,l(t.$t("delayLock")),1),e("div",ia,[a.chain?(y(),_("ul",ua,[e("li",null,[e("div",da,l(t.$t("lockAssets")),1),e("div",ra,[a.isLpToken?(y(),_("div",ka,[m(B,{class:"token-icon",tokenIcon:i(E)(a.chain,a.tokenList[0].address)},null,8,["tokenIcon"]),m(B,{class:"token-icon",tokenIcon:i(E)(a.chain,a.tokenList[1].address)},null,8,["tokenIcon"]),S(" "+l(`${a.symbol} (${i(G)(a.address)})`),1)])):(y(),_("div",ma,[m(B,{class:"token-icon",tokenIcon:i(E)(a.chain,a.address),chainIcon:i(Z)(a.chain)},null,8,["tokenIcon","chainIcon"]),S(" "+l(`${a.symbol} (${i(G)(a.address)})`),1)]))])]),e("li",null,[e("div",va,l(t.$t("unlockTime")),1),e("div",ha,[e("span",null,l(i(h).unix(a.unlockDate).format("YYYY-MM-DD HH:mm:ss")),1),e("span",null,[S("("),e("span",pa,l(t.$t("dayLeft",{day:i(aa)(i(h).unix(a.unlockDate).toDate())})),1),S(")")])])]),e("li",null,[e("div",wa,l(t.$t("editFee")),1),e("div",fa,l(`${n.value?i(na).formatEther(n.value):"--"} ${a.chainCoinSymbol}`),1)]),e("li",null,[e("div",ga,l(t.$t("gas")),1),e("div",ya,l(`${C.value?C.value:"--"} ${a.chainCoinSymbol}`),1)])])):U("",!0),e("div",_a,[e("div",Sa,l(t.$t("setDelayDate")),1),m(ea,{date:g.value,"onUpdate:date":o[0]||(o[0]=d=>g.value=d),"min-date":i(h).unix(a.unlockDate).add(1,"day").endOf("day").toDate()},null,8,["date","min-date"])]),a.isLockV2?(y(),_("div",ba,[e("div",La,l(t.$t("newLockedAmount")),1),m(c,{class:"amount",type:"number",modelValue:u.value,"onUpdate:modelValue":o[1]||(o[1]=d=>u.value=d),onBlur:M,placeholder:t.$t("pleaseEnter")},null,8,["modelValue","placeholder"])])):U("",!0),m(s,{class:"btn",type:"primary",block:"",onClick:R},{default:x(()=>[S(l(t.$t("confirmAndLock")),1)]),_:1})])])]),_:1},8,["show"]),m(oa,{show:D.value,"onUpdate:show":o[3]||(o[3]=d=>D.value=d),txHash:A.value,onClose:q},null,8,["show","txHash"])],64)}}},Ta=W(Ca,[["__scopeId","data-v-63ad81b3"]]);export{Ta as E};
