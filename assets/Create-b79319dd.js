import{I as ge}from"./InputQty-ee7006b1.js";import{O as Ce,S as $e}from"./OperateSuccessDialog-bc4ad138.js";import{_ as ne,d as se,$ as le,r as F,o as c,m as N,l as h,b as e,t as n,c as w,j as t,a as i,z as ce,T as P,A as _,q as H,y as Y,I as K,F as T,B as q,a2 as be,N as Le,O as Ae,u as Te,g as f,f as Ve,i as Ie,M as x,n as k,a4 as b,C as Se,G as ee,E as oe,p as te,H as De,a5 as Ee,L as Ne,a0 as Fe}from"./index-9e41773b.js";import{B as ae}from"./bignumber-3e8dfdf6.js";const ie=g=>(Le("data-v-31d73eea"),g=g(),Ae(),g),Oe={class:"ave-popup"},Be={class:"title"},Pe={class:"body"},Ue={class:"info"},Ge={class:"key"},Me={class:"value"},Re={key:0,class:"token"},We={key:1,class:"token"},qe={key:2,class:"token"},He={class:"key"},Ye={class:"value"},je={class:"item"},ze=ie(()=>e("div",{class:"key"},"交易对",-1)),Ke={class:"value"},Qe={class:"item"},Je=ie(()=>e("div",{class:"key"},"锁定数量",-1)),Xe={class:"value"},Ze={class:"key"},xe={class:"value"},eo={class:"key"},oo={class:"value"},to={class:"blue-font"},ao={class:"key"},no={class:"value"},so={class:"tips"},lo={__name:"LockConfirmPopup",props:{show:Boolean,showGas:String,amount:String,unlockDate:Date,isLockV2:Boolean,positions:Object},emits:["update:show","confirm"],setup(g,{emit:p}){const v=g,$=se(),l=le();function V(){p("confirm")}return(r,L)=>{const R=F("van-button"),m=F("van-popup");return c(),N(m,{show:g.show,"onUpdate:show":L[0]||(L[0]=a=>{p("update:show",a)}),round:"",closeable:"",position:"bottom"},{default:h(()=>[e("div",Oe,[e("div",Be,n(r.$t("lockConfirm")),1),e("div",Pe,[e("ul",Ue,[v.isLockV2?(c(),w(T,{key:0},[e("li",null,[e("div",Ge,n(r.$t("lockAssets")),1),e("div",Me,[t(l).token?t(l).token.tokenType==0?(c(),w("div",We,[i(P,{class:"token-icon",tokenIcon:t(l).token.icon,chainIcon:t(ce)(t(l).token.chain)},null,8,["tokenIcon","chainIcon"]),_(" "+n(`${t(l).token.symbol} (${t(H)(t(l).token.address)})`),1)])):t(l).token.tokenType==1?(c(),w("div",qe,[i(P,{class:"token-icon",tokenIcon:t(Y)(t(l).token.chain,t(l).token.tokenList[0].address)},null,8,["tokenIcon"]),i(P,{class:"token-icon",tokenIcon:t(Y)(t(l).token.chain,t(l).token.tokenList[1].address)},null,8,["tokenIcon"]),_(" "+n(`${t(l).token.symbol} (${t(H)(t(l).token.address)})`),1)])):K("",!0):(c(),w("div",Re," -- "))])]),e("li",null,[e("div",He,n(r.$t("lockNumber")),1),e("div",Ye,n(g.amount),1)])],64)):(c(),w(T,{key:1},[e("li",je,[ze,e("div",Ke,n(v.positions?`${v.positions.token0Symbol}/${v.positions.token1Symbol}`:"--/--"),1)]),e("li",Qe,[Je,e("div",Xe,n(v.positions?r.ethers.formatEther(g.positions.liquidity.toString()):"--"),1)])],64)),e("li",null,[e("div",Ze,n(r.$t("contractChian")),1),e("div",xe,n(t($).chain.toUpperCase()),1)]),e("li",null,[e("div",eo,n(r.$t("unlockTime2")),1),e("div",oo,[e("span",null,n(t(q)(g.unlockDate).format("YYYY-MM-DD")),1),e("span",null,[_("("),e("span",to,n(r.$t("dayLeft",{day:t(be)(v.unlockDate)})),1),_(")")])])]),e("li",null,[e("div",ao,n(r.$t("gas")),1),e("div",no,n(g.showGas?`${g.showGas} ${t($).chainCoinSymbol.toUpperCase()}`:"--"),1)])]),e("div",so,[e("div",null,n(r.$t("createTips1")),1),e("div",null,n(r.$t("createTips2")),1),e("div",null,n(r.$t("createTips3")),1)]),i(R,{class:"btn",type:"primary",block:"",onClick:V},{default:h(()=>[_(n(r.$t("confirmAndLock")),1)]),_:1})])])]),_:1},8,["show"])}}},co=ne(lo,[["__scopeId","data-v-31d73eea"]]);const io={class:"body"},ro={class:"tab"},uo={class:"form"},ko={class:"title token-title"},vo={key:0,class:"token-box"},fo={key:1,class:"token"},po={class:"title token-title"},mo={class:"title token-title"},yo={class:"title token-title"},ho={key:0,class:"info"},wo={class:"item"},_o={class:"key"},go={class:"value"},Co={class:"item"},$o={class:"key"},bo={class:"value"},Lo={class:"title token-title"},Ao={class:"tools"},To={__name:"Create",setup(g){const{t:p}=Te(),v=f(!0),$=f(""),l=f(""),V=f(!1),r=f(!1),L=f(!1),R=Ve(),m=se(),a=le(),de=q().add(1,"day").endOf("day").toDate(),U=f(de),S=f(""),G=f(!1),Q=f(""),W=f(!1),M=f(""),O=f("");async function re(){await m.connectWallet()}async function J(){if(a.token==null)return;if(a.token.address==k.wallet.MAIN_COIN_ADDRESS){V.value=!1;return}await k.wallet.isAllowanceEnough(a.tokenLockV2Address,a.token.address,m.walletAddress)?V.value=!1:V.value=!0}async function ue(){if(r.value=!0,v.value)try{let o=await k.wallet.approveMaxAmount(a.token.address,a.tokenLockV2Address);console.log(o),await o.wait(),V.value=!1}catch(o){console.log(o)}finally{r.value=!1}}async function ke(){L.value=!0,M.value="";try{if(!a.token){b(p("pleaseSelectToken"));return}if(!S.value){b(p("enterAmount"));return}let o=Se[m.dappType].chainList.find(s=>s.chain==a.token.chain);if(!o){b(p("tokenChainNotSupport"));return}if(m.chain!=o.chain){b(p("switchTokenChain"));try{await k.wallet.switchNetwork(o.chainId)}catch{b(p("switchTokenChain"));return}return}if(ae(S.value).gt(ae(O.value))){b(p("balanceSlow"));return}if(await J(),V.value){b(p("approveFirst"));return}await X()}catch(o){console.log(o)}finally{L.value=!1}}async function X(){const o=await k.wallet.getGasPrice();let s;const d=q(U.value).endOf("day").unix();if(v.value){const y=a.token.address,D=await(await k.wallet.contractERC20(y)).decimals(),C=a.token.tokenType==1,u=ee(S.value,D);s=await(await k.wallet.contractTokenLockV2(a.tokenLockV2Address)).lock.estimateGas(m.walletAddress,y,C,u.toString(),d,"")}else s=await(await k.wallet.contractTokenLockV3(a.tokenLockV3Address)).lock.estimateGas(m.walletAddress,$.value,l.value,d,"");console.dir(s),Q.value=oe(s*o),G.value=!0}async function ve(){const o=te({message:"Loading...",forbidClick:!0,duration:0}),s=q(U.value).endOf("day").unix();if(v.value){const d=a.token.address,y=a.token.tokenType==1,D=await(await k.wallet.contractERC20(d)).decimals(),C=ee(S.value,D),u=await k.wallet.contractTokenLockV2(a.tokenLockV2Address);try{let E=await u.lock(m.walletAddress,d,y,C.toString(),s,"");console.dir(E),M.value=E.hash,W.value=!0,G.value=!1}catch(E){console.log(E)}finally{o.close()}}else{const d=await k.wallet.contractTokenLockV3(a.tokenLockV3Address);try{let y=await d.lock(m.walletAddress,$.value,l.value,s,"");console.dir(y),M.value=y.hash,W.value=!0,G.value=!1}catch(y){console.log(y)}finally{o.close()}}}function fe(){R.push("/lockMaster/selectToken")}async function pe(){if(!a.token)return;const o=te({message:"Loading...",forbidClick:!0,duration:0});try{if(a.token.address==k.wallet.MAIN_COIN_ADDRESS){const d=await(await k.wallet.getEthersProvider()).getBalance(m.walletAddress);O.value=oe(d)}else{const s=await k.wallet.contractERC20(a.token.address),d=await s.decimals(),y=await s.balanceOf(m.walletAddress);O.value=De(y,d)}}catch(s){console.log(s),a.token=null}finally{o.close()}}Ie(()=>{console.log("onMounted"),m.chainId>0&&m.isConnectWallet&&a.token&&(J(),pe())});const j=f(!1),I=f(null);async function me(){r.value=!0;try{await(await(await k.wallet.contractNFT($.value)).approve(a.tokenLockV3Address,l.value)).wait(),j.value=!1}catch(o){console.log(o)}finally{r.value=!1}}async function ye(){L.value=!0,M.value="";try{await X()}catch(o){console.log(o)}finally{L.value=!1}}const B=f(!1),z=f(!1);async function he(){if(!$.value||!Ee($.value)){b(p("trueTokenFormat"));return}if(!l.value){b(p("trueTokenIDFormat"));return}z.value=!0;try{const o=await k.wallet.contractNFT($.value);let s;try{s=await o.ownerOf(l.value)}catch(_e){console.error(_e),b(p("trueTokenAddressIDFormat"));return}if(s.toLowerCase()!=m.walletAddress){b(p("notOwnToken"));return}const d=await o.positions(l.value),y=d[2],A=d[3],C=await(await k.wallet.contractERC20(y)).symbol(),E=await(await k.wallet.contractERC20(A)).symbol();I.value={token0:d[2],token0Symbol:C,token1:d[3],token1Symbol:E,liquidity:d[7]},B.value=!0;const we=await o.getApproved(l.value);j.value=we.toLowerCase()!=a.tokenLockV3Address.toLowerCase()}catch(o){console.log(o)}finally{z.value=!1}}function Z(o){v.value!=o&&(v.value=o,B.value=!1,I.value=null)}return(o,s)=>{const d=F("van-divider"),y=F("van-cell"),A=F("van-cell-group"),D=F("van-field"),C=F("van-button");return c(),w(T,null,[e("div",io,[e("ul",ro,[e("li",{class:x({"tab-select":v.value}),onClick:s[0]||(s[0]=u=>Z(!0))},n(o.$t("tokenOrLP(V2)")),3),e("li",{class:x({"tab-select":!v.value}),onClick:s[1]||(s[1]=u=>Z(!1))},"LP(uniV3)",2)]),i(d),e("div",uo,[v.value?(c(),w(T,{key:0},[i(A,{inset:"",class:"form-item"},{default:h(()=>[e("div",ko,n(o.$t("selectToken2")),1),i(y,{"is-link":"",class:"token-cell",onClick:fe},Ne({_:2},[t(a).token?{name:"title",fn:h(()=>[t(a).token.tokenType==0?(c(),w("div",vo,[i(P,{class:"token-icon",tokenIcon:t(a).token.icon,chainIcon:t(ce)(t(a).token.chain)},null,8,["tokenIcon","chainIcon"]),_(" "+n(`${t(a).token.symbol} (${t(H)(t(a).token.address)})`),1)])):t(a).token.tokenType==1?(c(),w("div",fo,[i(P,{class:"token-icon",tokenIcon:t(Y)(t(a).token.chain,t(a).token.tokenList[0].address)},null,8,["tokenIcon"]),i(P,{class:"token-icon",tokenIcon:t(Y)(t(a).token.chain,t(a).token.tokenList[1].address)},null,8,["tokenIcon"]),_(" "+n(`${t(a).token.symbol} (${t(H)(t(a).token.address)})`),1)])):K("",!0)]),key:"0"}:{name:"title",fn:h(()=>[e("div",{class:"token-box",style:{color:"#999999"}},n(o.$t("pleaseSelectToken")),1)]),key:"1"}]),1024)]),_:1}),i(A,{inset:"",class:"form-item"},{default:h(()=>[e("div",po,[e("div",null,n(t(p)("setNumberOfLock")),1),e("div",null,[_(n(`${t(p)("balance")}: `),1),e("span",null,n(O.value?O.value:"--"),1)])]),e("div",null,[i(ge,{amount:S.value,"onUpdate:amount":s[2]||(s[2]=u=>S.value=u),total:O.value,decimals:t(a).token?t(a).token.decimals:0},null,8,["amount","total","decimals"])])]),_:1})],64)):(c(),w(T,{key:1},[i(A,{inset:"",class:"form-item"},{default:h(()=>[e("div",mo,[e("div",null,n(o.$t("enterTokenAddress")),1)]),e("div",null,[i(D,{class:"token-cell",modelValue:$.value,"onUpdate:modelValue":s[3]||(s[3]=u=>$.value=u),placeholder:o.$t("contractAddress"),disabled:B.value},null,8,["modelValue","placeholder","disabled"])])]),_:1}),i(A,{inset:"",class:"form-item"},{default:h(()=>[e("div",yo,[e("div",null,n(o.$t("enterTokenId")),1)]),e("div",null,[i(D,{class:"token-cell",modelValue:l.value,"onUpdate:modelValue":s[4]||(s[4]=u=>l.value=u),placeholder:o.$t("forExample"),disabled:B.value},null,8,["modelValue","placeholder","disabled"]),B.value?(c(),w("ul",ho,[e("li",wo,[e("div",_o,n(o.$t("transactionPairs")),1),e("div",go,n(I.value?`${I.value.token0Symbol}/${I.value.token1Symbol}`:"--/--"),1)]),e("li",Co,[e("div",$o,n(o.$t("lockQuantity")),1),e("div",bo,n(I.value?t(Fe).formatEther(I.value.liquidity.toString()):"--"),1)])])):K("",!0)])]),_:1})],64)),i(A,{inset:"",class:"form-item"},{default:h(()=>[e("div",Lo,[e("div",null,n(o.$t("setDate")),1)]),e("div",null,[i($e,{date:U.value,"onUpdate:date":s[5]||(s[5]=u=>U.value=u),showTools:""},null,8,["date"])])]),_:1})]),i(d),e("div",Ao,[t(m).isConnectWallet?(c(),w(T,{key:0},[v.value?(c(),w(T,{key:0},[V.value?(c(),N(C,{key:0,class:"btn",type:"danger",onClick:ue,block:"",loading:r.value},{default:h(()=>[_(n(o.$t("approve")),1)]),_:1},8,["loading"])):(c(),N(C,{key:1,class:"btn",color:"#3F80F7",onClick:ke,block:"",loading:L.value},{default:h(()=>[_(n(o.$t("oneKeyLock")),1)]),_:1},8,["loading"]))],64)):(c(),w(T,{key:1},[B.value?(c(),w(T,{key:1},[j.value?(c(),N(C,{key:0,class:"btn",type:"danger",onClick:me,block:"",loading:r.value},{default:h(()=>[_(n(o.$t("approve")),1)]),_:1},8,["loading"])):(c(),N(C,{key:1,class:"btn",color:"#3F80F7",onClick:ye,block:"",loading:L.value},{default:h(()=>[_(n(o.$t("oneKeyLock")),1)]),_:1},8,["loading"]))],64)):(c(),N(C,{key:0,class:"btn",color:"#3F80F7",onClick:he,block:"",loading:z.value},{default:h(()=>[_(n(o.$t("verifyToken")),1)]),_:1},8,["loading"]))],64))],64)):(c(),N(C,{key:1,class:"btn",type:"primary",onClick:re,block:""},{default:h(()=>[_(n(o.$t("connectWallet")),1)]),_:1}))])]),i(co,{show:G.value,"onUpdate:show":s[6]||(s[6]=u=>G.value=u),isLockV2:v.value,positions:I.value,unlockDate:U.value,amount:S.value,showGas:Q.value,onConfirm:ve},null,8,["show","isLockV2","positions","unlockDate","amount","showGas"]),i(Ce,{show:W.value,"onUpdate:show":s[7]||(s[7]=u=>W.value=u),txHash:M.value,onClose:s[8]||(s[8]=u=>t(R).push("/lockMaster"))},null,8,["show","txHash"])],64)}}},Eo=ne(To,[["__scopeId","data-v-0a5ae0ba"]]);export{Eo as default};
